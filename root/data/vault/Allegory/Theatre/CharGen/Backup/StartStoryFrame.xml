<object clone="/obj/properties" owner="jominey">
  <Core:PropertyContainer>
    <Ur:UrObject urobject="OBJ(Allegory:Theatre:CharGen:ChoicesAppearance)"/>
    <Core:PCProperties>
      <Core:Property property="export:autoendpage">
         "end"
      </Core:Property>
      <Core:Property property="export:characterslots">
         3
      </Core:Property>
      <Core:Property property="export:html:choices">
         X[S] \<p\>
[height] in height and [build] in build, you are a \$(body.trait:sex) of [skin] complexion with a head of [hairlength] [hairtype] [haircolor] hair that is worn [hairstyle].
\</p\>
\<p\>
Your [eyeshape] [eyecolor] eyes are accentuated by [eyebrowshape] eyebrows beneath a [browshape] forehead. A [noseshape] nose, [mouthshape] mouth with [lipshape] lips, [earshape] ears, and [jawshape] \{? equal \| \$(body.base:gender) \| 1 \| covered in a [faciallength] [facialhair] \} complete the appearance.
\</p\>
\<sbr/\>\<sbr/\>
[submit]
      </Core:Property>
      <Core:Property property="export:html:intro">
         X[S] \<style\>
    #cont_btn \\\{
        visibility: visible;
    \\\}
\</style\>
\<z dat="\$(UDat.Dat)" name="\$(UDat.Name)"\>
\$[/* run some initial code */                 
   ::initialize();                 
   ::figureState();]
\$["\<!DOCTYPE HTML PUBLIC \\"-//W3C//DTD HTML 4.01 Transitional//EN\\" \\"http://www.w3.org/TR/html4/loose.dtd\\"/\>"]
\<html lang="en"\>
\<head\>
    \<title\>\$(title)\</title\>
    \<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"\>\</script\>
    \<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/\>
    \$(Allegory:Theatre:CharGen:CreateCharacter.xtra:javascript)
    \$(Allegory:Theatre:CharGen:CreateCharacter.xtra:stylesheet)
\</head\>
\<div class="main-wrapper"\>
    \<div class="header"\>
          \<img class="logo" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/logo2.png"/\>
          \<img alt="Character Generation" class="chargen" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/character-generation.png"/\>
    \</div\>
    \<div class="main"\>
          \<div class="content"\>\<br/\>
              \<img alt="Introduction" class="heading" id="intro" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/introduction.png"/\>\<br/\>
\<div id="textarea"\>Welcome to the world of Allegory of the Empires. A world full of intrigue and opportunity, danger and excitement, thrill and travail. Prepare yourself to dive into the story, bringing this new character to life and weave their story into the stories of others as you join the adventure, finding love, loss, mystery and success. The story is already being told. How will your presence affect it?\<br/\>It begins now. Are you ready?\</div\>
          \</div\>
    \</div\>
\</div\>
\<div class="footer"\>
    \<div id="restart_btn"\>\<img alt="Return to character selection" class="button" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/startover.png"/\>\</div\>
    \<a href="http://ironclaw.skotos.net/SAM/Prop/Allegory%3ATheatre%3ACharGen%3ACreateCharacter/Index"\>\<div id="cont_btn"\>\<img alt="Continue" class="button" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/continue.png"/\>\</div\>\</a\>
\</div\>
\</html\>
\</z\>
      </Core:Property>
      <Core:Property property="export:premium_bonus_characterslots">
         2
      </Core:Property>
      <Core:Property property="export:startpage">
         "appearance"
      </Core:Property>
      <Core:Property property="export:title">
         "Allegory of Empires: Character Generator"
      </Core:Property>
      <Core:Property property="export:xtra:javascript">
         X[S] \<script language="javascript"\>
  function wrapper_onload() \\\{
      if (this.body_onload) \\\{
          body_onload();
      \\\}
  \\\}
  function toggle_note(note) \\\{
      content = document.getElementById(note + "_content");
      if (!this["NoteStatus"])
          this["NoteStatus"] = new Object();
      if (!this["NoteStatus"][note])
          this["NoteStatus"][note] = "off";
      if (this["NoteStatus"][note] == "on") \\\{
          this["NoteStatus"][note] = "off";
          content.innerHTML = '';
      \\\} else \\\{
          this["NoteStatus"][note] = "on";
          content.innerHTML = document.getElementById(note).innerHTML;
      \\\}
  \\\}
  function update_span(id) \\\{
    var span, optval;
    if(document.getElementById("span_" + id))
    \\\{
      span = document.getElementById("span_" + id);
      optval = document.getElementById("select_" + id);
      optval = optval.options[optval.selectedIndex].value.substring(0, 1);
      if (optval == 'a' \\\|\\\| optval == 'e' \\\|\\\| optval == 'i' \\\|\\\| optval == 'o' \\\|\\\|
        optval == 'u') \\\{
        span.innerHTML = 'an';
      \\\} else \\\{
        span.innerHTML = 'a';
      \\\}
    \\\}
  \\\}
  function reset_span(id, tosave) \\\{
      // Hack to work around FireFox blanking potentially hidden selects under
      // certain conditions.
      var span = document.getElementById("span_" + id);
      var list = tosave.split("\\\|");
      for (var i = 0; i \\\< list.length; i++) \\\{
          var optvals, optval;
          optvals = document.getElementsByName("input_" + list[i]);
          optval = optvals[optvals.length - 1];
          // alert("Saving select value for '" + list[i] + "': " + optval.options[optval.selectedIndex].value);
          this["SelectStatus"][list[i]] =
              optval.options[optval.selectedIndex].value;
      \\\}
      // Refresh contents.
      span.innerHTML = document.getElementById(id).innerHTML;
      for (var i = 0; i \\\< list.length; i++) \\\{
          var selval = this["SelectStatus"][list[i]];
          var optvals, optval;
          optvals = document.getElementsByName("input_" + list[i]);
          optval = optvals[optvals.length - 1];
          // alert("Restoring select value: " + selval);
          for (var j = 0; j \\\< optval.options.length; j++) \\\{
              if (optval.options[j].value == selval) \\\{
                  optval.selectedIndex = j;
                  // alert("SelectedIndex is now set to: " + j);
                  optval.options[j].selected = true;
              \\\}
          \\\}
      \\\}
  \\\}
  function hide_span(id, id_select, id_value, tosave, tosave_text) \\\{
      // This script uses the last instance of each select it finds to rescue/restore
      // the tosave values, to work around the misfeature that getElementById
      // only returns one object even when there is more than one and it might be the
      // placeholder select instead of the actual one, meaning it has the wrong value.
      var span, optval;
      span = document.getElementById("span_" + id);
      optval = document.getElementById("select_" + id_select);
      optval = optval.options[optval.selectedIndex].value;
      if (!this["SelectStatus"]) \\\{
          this["SelectStatus"] = new Object();
      \\\}
      if (!this["SavedSpans"]) \\\{
          this["SavedSpans"] = new Object();
      \\\}
      if (optval == id_value) \\\{
         if (span.innerHTML != '') \\\{
            if (tosave.length \\\> 0) \\\{
                var list = tosave.split("\\\|");
                for (var i = 0; i \\\< list.length; i++) \\\{
                    var optvals, optval;
                    optvals = document.getElementsByName("input_" + list[i]);
                    optval = optvals[optvals.length - 1];
                    // alert("Saving select value for '" + list[i] + "': " + optval.options[optval.selectedIndex].value);
                    this["SelectStatus"][list[i]] =
                        optval.options[optval.selectedIndex].value;
                \\\}
            \\\}
            this["SavedSpans"][id] = span.innerHTML;
            span.innerHTML = '';
         \\\}
      \\\} else \\\{
        if (span.innerHTML == '') \\\{
            span.innerHTML = this["SavedSpans"][id];
            if (tosave.length \\\> 0) \\\{
                var list = tosave.split("\\\|");
                for (var i = 0; i \\\< list.length; i++) \\\{
                    var selval = this["SelectStatus"][list[i]];
                    var optvals, optval;
                    optvals = document.getElementsByName("input_" + list[i]);
                    optval = optvals[optvals.length - 1];
                    // alert("Restoring select value: " + selval);
                    for (var j = 0; j \\\< optval.options.length; j++) \\\{
                        if (optval.options[j].value == selval) \\\{
                            optval.selectedIndex = j;
                            // alert("SelectedIndex is now set to: " + j);
                            optval.options[j].selected = true;
                        \\\}
                    \\\}
                \\\}
            \\\}
        \\\}
      \\\}
  \\\}
  function barewin(url, title) \\\{
      open(url, title, 'width=800,height=600,hotkeys=no');
  \\\}
  function popupwin(url, title) \\\{
      open(url, title, 'width=800,height=600,hotkeys=no,resizable=yes');
  \\\}
  function showDesc(el) \\\{
      var id = el.id;
      var classDesc = document.getElementById("classes-description");
      var fighterDesc = document.getElementById("fighter-description");
      var rangerDesc = document.getElementById('ranger-description');
      var rogueDesc = document.getElementById('rogue-description');
      var academicDesc = document.getElementById('academic-description');
      var tradesmanDesc = document.getElementById('tradesman-description');
      var fighterImg = document.getElementById("fighter-image");
      var rangerImg = document.getElementById('ranger-image');
      var rogueImg = document.getElementById('rogue-image');
      var academicImg = document.getElementById('academic-image');
      var tradesmanImg = document.getElementById('tradesman-image');
     if((id === "fighter" \\\&\\\& fighterDesc.style.display === "block") \\\|\\\| (id === "ranger" \\\&\\\& rangerDesc.style.display === "block") \\\|\\\| (id === "rogue" \\\&\\\& rogueDesc.style.display === "block") \\\|\\\| (id === "academic" \\\&\\\& academicDesc.style.display === "block") \\\|\\\| (id === "tradesman" \\\&\\\& tradesmanDesc.style.display === "block")) \\\{
          classDesc.style.display = "block";
          fighterDesc.style.display = "none";
          fighterImg.style.backgroundImage = null;
          rangerDesc.style.display = "none";
          rangerImg.style.backgroundImage = null;
          rogueDesc.style.display = "none";
          rogueImg.style.backgroundImage = null;
          academicDesc.style.display = "none";
          academicImg.style.backgroundImage = null;
          tradesmanDesc.style.display = "none";
          tradesmanImg.style.backgroundImage = null;
     \\\} else \\\{
      if(id === "fighter") \\\{
          classDesc.style.display = "none";
          fighterDesc.style.display = "block";
          fighterImg.style.backgroundImage = "url('http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-fighter-color.png')";
          rangerDesc.style.display = "none";
          rangerImg.style.backgroundImage = null;
          rogueDesc.style.display = "none";
          rogueImg.style.backgroundImage = null;
          academicDesc.style.display = "none";
          academicImg.style.backgroundImage = null;
          tradesmanDesc.style.display = "none";
          tradesmanImg.style.backgroundImage = null;
      \\\}
      if(id === "ranger") \\\{
          classDesc.style.display = "none";
          fighterDesc.style.display = "none";
          fighterImg.style.backgroundImage = null;
          rangerDesc.style.display = "block";
          rangerImg.style.backgroundImage = "url('http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-ranger-color.png')";
          rogueDesc.style.display = "none";
          rogueImg.style.backgroundImage = null;
          academicDesc.style.display = "none";
          academicImg.style.backgroundImage = null;
          tradesmanDesc.style.display = "none";
          tradesmanImg.style.backgroundImage = null;
      \\\}
      if(id === "rogue") \\\{
          classDesc.style.display = "none";
          fighterDesc.style.display = "none";
          fighterImg.style.backgroundImage = null;
          rangerDesc.style.display = "none";
          rangerImg.style.backgroundImage = null;
          rogueDesc.style.display = "block";
          rogueImg.style.backgroundImage = "url('http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-rogue-color.png')";
          academicDesc.style.display = "none";
          academicImg.style.backgroundImage = null;
          tradesmanDesc.style.display = "none";
          tradesmanImg.style.backgroundImage = null;
      \\\}
      if(id === "academic") \\\{
          classDesc.style.display = "none";
          fighterDesc.style.display = "none";
          fighterImg.style.backgroundImage = null;
          rangerDesc.style.display = "none";
          rangerImg.style.backgroundImage = null;
          rogueDesc.style.display = "none";
          rogueImg.style.backgroundImage = null;
          academicDesc.style.display = "block";
          academicImg.style.backgroundImage = "url('http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-academic-color.png')";
          tradesmanDesc.style.display = "none";
          tradesmanImg.style.backgroundImage = null;
      \\\}
      if(id === "tradesman") \\\{
          classDesc.style.display = "none";
          fighterDesc.style.display = "none";
          fighterImg.style.backgroundImage = null;
          rangerDesc.style.display = "none";
          rangerImg.style.backgroundImage = null;
          rogueDesc.style.display = "none";
          rogueImg.style.backgroundImage = null;
          academicDesc.style.display = "none";
          academicImg.style.backgroundImage = null;
          tradesmanDesc.style.display = "block";
          tradesmanImg.style.backgroundImage = "url('http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-tradesman-color.png')";
      \\\}
    \\\}
  \\\}
  function chooseClass(el) \\\{
      var id = el.id;
      var i, temp, btn;
      var divs = [ "one-handed-fighter-class", "two-handed-fighter-class", "dual-wielding-fighter-class", "unarmed-fighter-class", "ranger-class", "assassin-class", "spy-class", "thief-class", "body-servant-class", "healer-class", "socialite-class", "blacksmith-class", "bookbinder-class", "carpenter-class", "dyer-class", "jeweler-class", "miner-class", "seamstress-class", "stonemason-class", "weaver-class", "woodcutter-class" ];
      for(i = 0; i \\\< divs.length; i++) \\\{
          temp = document.getElementById(divs[i]);
          if(divs[i] != id) \\\{
              temp.checked = false;
          \\\}
      \\\}
      btn = "0";
      for(i = 0; i \\\< divs.length; i++) \\\{
          temp = document.getElementById(divs[i]);
          if(temp.checked) \\\{
              this["CharClass"] = divs[i];
              btn = "1";
          \\\}
      \\\}
      if(btn === "1") \\\{
          document.getElementById("cont_btn").style.visibility = "visible";
      \\\} else \\\{
          document.getElementById("cont_btn").style.visibility = "hidden";
      \\\}
  \\\}
  function forceClick() \\\{
      document.getElementById("hidden-btn").click();
  \\\}
\</script\>
      </Core:Property>
      <Core:Property property="export:xtra:state:appearance">
         X[S] \<style\>
    #cont_btn \\\{
        visibility: visible;
    \\\}
    #back_btn \\\{
        visibility: hidden;
    \\\}
\</style\>
\\\<!-- This is where the user selects their height, build, and details for their fur or skin --\\\>
\\\<!-- find which autopage the player is at. get the choices for this page, as well as the page description --\\\>
\$[\$autoNumber = 1;        
  \$autoChoices = Get(this, "html:choices");        
  \$body = Obj(\$characterref);       
  if(!\$body) \$body = Obj(\$characterref);]
\<br/\>
\<p id="textarea" style="text-align: justify"\>
Time passes as your mind continues to wander, not paying attention all too much to the changing surroundings. You happen to catch a glimpse of yourself in a nearby \{ mirror \| stranger's shield \| metallic surface \} noting the familiar reflection that greets your meandering eye:\<sbr/\>\<sbr/\>
\<span id="choices"\>
  \$[\$counter = 0; \$choices = Call(\$this, "list-choices", \$choices: \$autoChoices);]
  \<zform style="display:inline" actbody="\$(body)" actchoices="\$(choices)" actnumber="\$(autoNumber)"\>
  \<p style="text-align:justify" class="appearance"\>
    \<for var="thisChoiceLine" val="\$(choices)"\>
      \$(thisChoiceLine.0)
      \$[if(sizeof(\$thisChoiceLine) \> 1)\{ \$myVar = TRUE; \$counter++; \} else \{ \$myVar = FALSE; \}]
      \{? \| \$[sizeof(\$thisChoiceLine) \> 1] \|
        \$[\$choicearray = Call(this, "grabchoices", \$choice: \$thisChoiceLine[1], \$gender: \$body."base:genderstring");]
        \<select style="display:linline" ID="select_counter\$[Str(\$counter)]" NAME="counter\$[Str(\$counter)]" SIZE="1" onChange="update_span('counter\$[Str(\$counter)]');"\>
          \{? \| \$[Get(\$body, "appearance:" + \$thisChoiceLine[1])] \|
            \<option SELECTED="1" value="\$[Get(\$body, "appearance:" + \$thisChoiceLine[1])]"\>\$[Get(\$body, "appearance:" + \$thisChoiceLine[1])]\</option\>
          \|
            \<option value="ordinary"\>ordinary\</option\>
          \}
          \<for var="thisvar" val="\$(choicearray)"\>
            \<option value="\$(thisvar)"\>\$(thisvar)\</option\>
          \</for\>
        \</select\>
      \|\}
    \</for\>
    You are wearing
    \<select id="clothing" name="clothing" style="display:inline"\>
        \<option value="feminine_attire"\>simple feminine travel attire\</option\>
        \<option value="masculine_attire"\>simple masculine travel attire\</option\>
        \<option value="primitive_attire"\>primitive travel attire\</option\>
        \<option value="religious_attire"\>religious vestments\</option\>
        \<option value="martial_uniform"\>a martial uniform\</option\>
        \<option value="work_clothes"\>work clothes\</option\>
    \</select\>.
  \</p\>
    \<action\>
      \$[\$list = (\{ \});        
for(\$i = 0; \$i \< sizeof(\$actchoices); \$i++)        
\{        
  if(sizeof(\$actchoices[\$i])\>=2)        
  \{        
    \$list += (\{ \$actchoices[\$i][1] \});        
  \}        
\}        
                  
for(\$i = 0; \$i \< sizeof(\$list); \$i++) \{        
    Set(\$actbody, "appearance:" + \$list[\$i], lower_case(GetVar("counter" + Str(\$i+1))));        
\}        
    Set(\$actbody, "export:trait:examine", nil);        
    Set(\$actbody, "trait:examine", nil);        
    Set(\$actbody, "export:trait:look", nil);        
    Set(\$actbody, "trait:look", nil);        
    Set(\$actbody, "chargen:humanized", "1");     
    \$actbody."chargen:clothing" = \$clothing;  
    Set(\$actbody, "chargen:state", "attributes");]
      \<redirect propob="\$(this)" characterref="\$(actbody)" dat="\$(dat)" body="\$(body)"/\>
    \</action\>
\<script language="javascript"\>
    function body_onload() \\\{
        update_span('counter1');
        update_span('counter2');
        update_span('counter3');
        update_span('counter4');
        update_span('counter5');
        update_span('counter6');
        update_span('counter7');
        update_span('counter8');
        update_span('counter9');
        update_span('counter10');
        update_span('counter11');
        update_span('counter12');
        update_span('counter13');
        update_span('counter14');
        update_span('counter15');
        update_span('counter16');
        update_span('counter17');
        update_span('counter18');
        update_span('counter19');
        update_span('counter20');
    \\\}
\</script\>
  \</zform\>
\</span\>
\</p\>
      </Core:Property>
      <Core:Property property="export:xtra:state:appearance:goback">
         X[S] \$[\$actbody."chargen:state" = nil;]
\<redirect propob="\$(this)" characterref="\$(characterref)"/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:attributes">
         X[S] \<style\>
    #cont_btn \\\{
        visibility: visible;
    \\\}
\</style\>
\{? \| \$(error) \|
    \$[if(\$error == "no_selection") \$str = "You cannot leave an attribute selection blank.";    
          if(\$error == "duplicate_selection") \$str = "You cannot select an attribute twice.";    
          return ParseXML(\$str);]
\}
\$[if(\$body."temp:attr1") \$attr1_v = \$body."temp:attr1";    
    if(\$body."temp:attr2") \$attr2_v = \$body."temp:attr2";    
    if(\$body."temp:attr3") \$attr3_v = \$body."temp:attr3";    
    if(\$body."temp:attr4") \$attr4_v = \$body."temp:attr4";]
\<br/\>\<br/\>
\<div id="textarea"\>
\<zform actname="\$(name)" actbody="\$(body)" actdat="\$(dat)"\>
    \<p style="text-align:justify"\>
        The swaying of the ship becomes a monotonous motion as you daydream about the opportunities and unknowns that lie before you. A particularly large wave jolts your from your thoughts as a \{ young \| elderly \| middle-aged \} \{ man \| woman \} halts your fall with a laugh. After you recover your composure, a comfortable conversation fills the void.\<br/\>
"Good thing I'm fast enough to catch you!" your companion laughs. "How about you? What's your bragging rights?"
         \$[\$str = "\<select id='attr1' name='attr1' style='display:inline' onchange='updatelist1();'\>";    
            \$str += "\<option value='' selected='1'\>--\</option\>";    
    
            \$str += "\<option value='strength'";    
            if(\$attr1_v == "strength") \$str += "selected='1'";    
            \$str += "\>strength\</option\>";    
    
            \$str += "\<option value='speed'";    
            if(\$attr1_v == "speed") \$str += "selected='1'";    
            \$str += "\>speed\</option\>";    
    
            \$str += "\<option value='resilience'";    
            if(\$attr1_v == "resilience") \$str += "selected='1'";    
            \$str += "\>resilience\</option\>";    
    
            \$str += "\<option value='perception'";    
            if(\$attr1_v == "perception") \$str += "selected='1'";    
            \$str += "\>perception\</option\>";    
    
            \$str += "\<option value='intelligence'";    
            if(\$attr1_v == "intelligence") \$str += "selected='1'";    
            \$str += "\>intelligence\</option\>";    
    
            \$str += "\<option value='charisma'";    
            if(\$attr1_v == "charisma") \$str += "selected='1'";    
            \$str += "\>charisma\</option\>";    
    
            \$str += "\</select\>";    
            return ParseXML(\$str);]. You are also
        \$[\$str = "\<select id='attr2' name='attr2' style='display:inline' onchange='updatelist2();'\>";    
            \$str += "\<option value='' selected='1'\>--\</option\>";    
    
            \$str += "\<option value='strength'";    
            if(\$attr2_v == "strength") \$str += "selected='1'";    
            if(\$attr1_v == "strength") \$str += "disabled";    
            \$str += "\>strength\</option\>";    
    
            \$str += "\<option value='speed'";    
            if(\$attr2_v == "speed") \$str += "selected='1'";    
            if(\$attr1_v == "speed") \$str += "disabled";    
            \$str += "\>speed\</option\>";    
    
            \$str += "\<option value='resilience'";    
            if(\$attr2_v == "resilience") \$str += "selected='1'";    
            if(\$attr1_v == "resilience") \$str += "disabled";    
            \$str += "\>resilience\</option\>";    
    
            \$str += "\<option value='perception'";    
            if(\$attr2_v == "perception") \$str += "selected='1'";    
            if(\$attr1_v == "perception") \$str += "disabled";    
            \$str += "\>perception\</option\>";    
    
            \$str += "\<option value='intelligence'";    
            if(\$attr2_v == "intelligence") \$str += "selected='1'";    
            if(\$attr1_v == "intelligence") \$str += "disabled";    
            \$str += "\>intelligence\</option\>";    
    
            \$str += "\<option value='charisma'";    
            if(\$attr2_v == "charisma") \$str += "selected='1'";    
            if(\$attr1_v == "charisma") \$str += "disabled";    
            \$str += "\>charisma\</option\>";    
    
            \$str += "\</select\>";    
            return ParseXML(\$str);]. However, you are not very
        \$[\$str = "\<select id='attr3' name='attr3' style='display:inline' onchange='updatelist3();'\>";    
            \$str += "\<option value='' selected='1'\>--\</option\>";    
    
            \$str += "\<option value='strength'";    
            if(\$attr3_v == "strength") \$str += "selected='1'";    
            if(\$attr1_v == "strength" \|\| \$attr2_v == "strength") \$str += "disabled";    
            \$str += "\>strength\</option\>";    
    
            \$str += "\<option value='speed'";    
            if(\$attr3_v == "speed") \$str += "selected='1'";    
            if(\$attr1_v == "speed" \|\| \$attr2_v == "speed") \$str += "disabled";    
            \$str += "\>speed\</option\>";    
    
            \$str += "\<option value='resilience'";    
            if(\$attr3_v == "resilience") \$str += "selected='1'";    
            if(\$attr1_v == "resilience" \|\| \$attr2_v == "resilience") \$str += "disabled";    
            \$str += "\>resilience\</option\>";    
    
            \$str += "\<option value='perception'";    
            if(\$attr3_v == "perception") \$str += "selected='1'";    
            if(\$attr1_v == "perception" \|\| \$attr2_v == "perception") \$str += "disabled";    
            \$str += "\>perception\</option\>";    
    
            \$str += "\<option value='intelligence'";    
            if(\$attr3_v == "intelligence") \$str += "selected='1'";    
            if(\$attr1_v == "intelligence" \|\| \$attr2_v == "intelligence") \$str += "disabled";    
            \$str += "\>intelligence\</option\>";    
    
            \$str += "\<option value='charisma'";    
            if(\$attr3_v == "charisma") \$str += "selected='1'";    
            if(\$attr1_v == "charisma" \|\| \$attr2_v == "charisma") \$str += "disabled";    
            \$str += "\>charisma\</option\>";    
    
            \$str += "\</select\>";    
            return ParseXML(\$str);] or
        \$[\$str = "\<select id='attr4' name='attr4' style='display:inline'\>";    
            \$str += "\<option value='' selected='1'\>--\</option\>";    
    
            \$str += "\<option value='strength'";    
            if(\$attr4_v == "strength") \$str += "selected='1'";    
            if(\$attr1_v == "strength" \|\| \$attr2_v == "strength" \|\| \$attr3_v == "strength") \$str += "disabled";    
            \$str += "\>strength\</option\>";    
    
            \$str += "\<option value='speed'";    
            if(\$attr4_v == "speed") \$str += "selected='1'";    
            if(\$attr1_v == "speed" \|\| \$attr2_v == "speed" \|\| \$attr3_v == "speed") \$str += "disabled";    
            \$str += "\>speed\</option\>";    
    
            \$str += "\<option value='resilience'";    
            if(\$attr4_v == "resilience") \$str += "selected='1'";    
            if(\$attr1_v == "resilience" \|\| \$attr2_v == "resilience" \|\| \$attr3_v == "resilience") \$str += "disabled";    
            \$str += "\>resilience\</option\>";    
    
            \$str += "\<option value='perception'";    
            if(\$attr4_v == "perception") \$str += "selected='1'";    
            if(\$attr1_v == "perception" \|\| \$attr2_v == "perception" \|\| \$attr3_v == "perception") \$str += "disabled";    
            \$str += "\>perception\</option\>";    
    
            \$str += "\<option value='intelligence'";    
            if(\$attr4_v == "intelligence") \$str += "selected='1'";    
            if(\$attr1_v == "intelligence" \|\| \$attr2_v == "intelligence" \|\| \$attr3_v == "intelligence") \$str += "disabled";    
            \$str += "\>intelligence\</option\>";    
    
            \$str += "\<option value='charisma'";    
            if(\$attr4_v == "charisma") \$str += "selected='1'";    
            if(\$attr1_v == "charisma" \|\| \$attr2_v == "charisma" \|\| \$attr3_v == "charisma") \$str += "disabled";    
            \$str += "\>charisma\</option\>";    
    
            \$str += "\</select\>";    
            return ParseXML(\$str);]
        .
    \</p\> \<sbr/\>\<sbr/\>
    \<p style="text-align:justify"\>\<input style="float:right" type="submit" id="hidden-btn" value="Continue" class="submit-button"/\>\</p\>
    \<action\>
      \$[if(\$attr1 == "" \|\| \$attr2 == "" \|\| \$attr3 == "" \|\| \$attr4 == "") \{    
            \$no_selection = 1;    
            return 0;    
        \}    
            
        if(\$attr1 == \$attr2 \|\| \$attr1 == \$attr3 \|\| \$attr1 == \$attr4 \|\|    
           \$attr2 == \$attr3 \|\| \$attr2 == \$attr4 \|\|    
           \$attr3 == \$attr4) \{    
            \$duplicate_selection = 1;    
            return 0;    
        \}    
    
        \$actbody."temp:attr1" = \$attr1;    
        \$actbody."temp:attr2" = \$attr2;    
        \$actbody."temp:attr3" = \$attr3;    
        \$actbody."temp:attr4" = \$attr4;    
    
        \$actbody."chargen:state" = "runscripts";]
        \{? \| \$(no_selection) \| \<redirect propob="\$(this)" characterref="\$(actbody)" error="no_selection"/\> \|
          \{? \| \$(duplicate_selection) \| \<redirect propob="\$(this)" characterref="\$(actbody)" error="duplicate_selection"/\> \|
               \<redirect propob="\$(this)" characterref="\$(actbody)"/\> \}\}
    \</action\>
\<script\>
    function updatelist1() \\\{
        var e1 = document.getElementById("attr1");
        var i1 = e1.selectedIndex;
        var e2 = document.getElementById("attr2");
        var i2 = e2.selectedIndex;
        var e3 = document.getElementById("attr3");
        var i3 = e3.selectedIndex;
        var e4 = document.getElementById("attr4");
        var i4 = e4.selectedIndex;
        if(i1 == i2) e2.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e2.options[i].disabled = false;
        \\\}
        if(i1 == i3) e3.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e3.options[i].disabled = false;
        \\\}
        if(i1 == i4) e4.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e4.options[i].disabled = false;
        \\\}
        e2.options[i1].disabled = true;
        e2.options[i3].disabled = true;
        e2.options[i4].disabled = true;
        e3.options[i1].disabled = true;
        e3.options[i2].disabled = true;
        e3.options[i4].disabled = true;
        e4.options[i1].disabled = true;
        e4.options[i2].disabled = true;
        e4.options[i3].disabled = true;
    \\\}
    function updatelist2() \\\{
        var e1 = document.getElementById("attr1");
        var i1 = e1.selectedIndex;
        var e2 = document.getElementById("attr2");
        var i2 = e2.selectedIndex;
        var e3 = document.getElementById("attr3");
        var i3 = e3.selectedIndex;
        var e4 = document.getElementById("attr4");
        var i4 = e4.selectedIndex;
        if(i2 == i1) e1.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e1.options[i].disabled = false;
        \\\}
        if(i2 == i3) e3.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e3.options[i].disabled = false;
        \\\}
        if(i2 == i4) e4.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e4.options[i].disabled = false;
        \\\}
        e3.options[i1].disabled = true;
        e3.options[i2].disabled = true;
        e3.options[i4].disabled = true;
        e4.options[i1].disabled = true;
        e4.options[i2].disabled = true;
        e4.options[i3].disabled = true;
    \\\}
    function updatelist3() \\\{
        var e1 = document.getElementById("attr1");
        var i1 = e1.selectedIndex;
        var e2 = document.getElementById("attr2");
        var i2 = e2.selectedIndex;
        var e3 = document.getElementById("attr3");
        var i3 = e3.selectedIndex;
        var e4 = document.getElementById("attr4");
        var i4 = e4.selectedIndex;
        if(i3 == i1) e1.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e1.options[i].disabled = false;
        \\\}
        if(i3 == i2) e2.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e2.options[i].disabled = false;
        \\\}
        if(i3 == i4) e4.value = "";
        for(var i = 0; i \\\< 7; i++) \\\{
            e4.options[i].disabled = false;
        \\\}
        e4.options[i1].disabled = true;
        e4.options[i2].disabled = true;
        e4.options[i3].disabled = true;
    \\\}
\</script\>
\</zform\>\</div\>\<br/\>\<br/\>\<br/\>\<br/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:attributes:goback">
         X[S] \$[\$actbody."chargen:state" = nil;]
\<redirect propob="\$(this)" characterref="\$(actbody)"/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:auto">
         X[S] \\\<!-- This is where the user selects their height, build, and details for their fur or skin --\\\>
\\\<!-- find which autopage the player is at. get the choices for this page, as well as the page description --\\\>
\$[\$autoNumber = 1;            
  \$autoChoices = Get(this, "auto:" + Str(\$autoNumber) + ":choices");]
\<h4\>Create Character: Appearance\</h4\>\<sbr/\>
(\<a href="http://ironclaw.skotos.net/SAM/Prop/Allegory:Theatre:CharGen:CreateCharacter/helppopup#3" target="_blank"\>help\</a\>)
\<p style="text-align: justify"\>
Time passes as your mind continues to wander, not paying attention all too much to the changing surroundings. You happen to catch a glimpse of yourself in a nearby \{ mirror \| stranger's shield \| metallic surface \} noting the familiar reflection that greets your meandering eye:\<sbr/\>\<sbr/\>
\<span id="choices"\>
  \$[\$counter = 0; \$choices = Call(\$this, "list-choices", \$choices: \$autoChoices);]
  \<zform style="display:inline" actbody="\$(body)" actchoices="\$(choices)" actnumber="\$(autoNumber)"\>
  \<p style="text-align:justify"\>
    \<for var="thisChoiceLine" val="\$(choices)"\>
      \$(thisChoiceLine.0)
      \$[if(sizeof(\$thisChoiceLine) \> 1)\{ \$myVar = TRUE; \$counter++; \} else \{ \$myVar = FALSE; \}]
      \{? \| \$[sizeof(\$thisChoiceLine) \> 1] \|
        \$[\$choicearray = Call(this, "grabchoices", \$choice: \$thisChoiceLine[1], \$gender: \$body."base:genderstring", \$animaltype: \$body."trait:animaltype", \$animalbreed: \$body."trait:animal");]
        \<select style="display:linline" ID="select_counter\$[Str(\$counter)]" NAME="counter\$[Str(\$counter)]" SIZE="1" onChange="update_span('counter\$[Str(\$counter)]');"\>
          \{? \| \$[Get(\$body, "appearance:" + \$thisChoiceLine[1])] \|
            \<option SELECTED="1" value="\$[Get(\$body, "appearance:" + \$thisChoiceLine[1])]"\>\$[Get(\$body, "appearance:" + \$thisChoiceLine[1])]\</option\>
          \|
            \<option value="ordinary"\>ordinary\</option\>
          \}
          \<for var="thisvar" val="\$(choicearray)"\>
            \<option value="\$(thisvar)"\>\$(thisvar)\</option\>
          \</for\>
        \</select\>
      \|\}
    \</for\>
  \</p\>
    \<action\>
      \$[\$list = (\{ \});            
for(\$i = 0; \$i \< sizeof(\$actchoices); \$i++)            
\{            
  if(sizeof(\$actchoices[\$i])\>=2)            
  \{            
    \$list += (\{ \$actchoices[\$i][1] \});            
  \}            
\}          
      
for(\$i = 0; \$i \< sizeof(\$list); \$i++) \{      
    Set(\$actbody, "appearance:" + \$list[\$i], GetVar("counter" + Str(\$i+1)));      
\}         
         
    Set(\$actbody, "chargen:state", "attributes");]
      \<redirect propob="\$(this)" characterref="\$(actbody)"/\>
    \</action\>
\<script language="javascript"\>
    function body_onload() \\\{
        update_span('counter1');
        update_span('counter2');
        update_span('counter3');
        update_span('counter4');
        update_span('counter5');
        update_span('counter6');
        update_span('counter7');
        update_span('counter8');
        update_span('counter9');
        update_span('counter10');
        update_span('counter11');
        update_span('counter12');
        update_span('counter13');
        update_span('counter14');
        update_span('counter15');
        update_span('counter16');
        update_span('counter17');
        update_span('counter18');
        update_span('counter19');
        update_span('counter20');
    \\\}
\</script\>
  \</zform\>
\</span\>
\<h4\>\</h4\>
\<zact actbody="\$(body)"\>
\<p style="text-align:justify"\>\<font size="3"\>Wait, I don't want to be a \$(body.trait:animal)\</font\>\</p\>
  \<action\>
    \$[\$actbody."chargen:state" = nil;]
    \<redirect propob="\$(this)" characterref="\$(actbody)"/\>
  \</action\>
\</zact\>
\<zact actbody="\$(body)"\>
\<p style="text-align:justify"\>\<font size="3"\>I want to start over.\</font\>\</p\>
  \<action\>
    \$[Slay(\$actbody);]
    \<redirect propob="\$(this)"/\>
  \</action\>
\</zact\>
\{? \| \$(autoDescl) \|
\<span id="bottombox"\>
\$(autoDescl)
\</span\>
\}
\</p\>
      </Core:Property>
      <Core:Property property="export:xtra:state:careers">
         X[S]
      </Core:Property>
      <Core:Property property="export:xtra:state:char-bio">
         X[S] \<script\>
  function toggleRanks(nation) \\\{
    var selected = nation.value;
    var nations = [ [ "France", "france_rank_div" ], [ "Germany", "germany_rank_div" ], [ "Italy", "italy_rank_div" ], [ "Spain", "spain_rank_div" ], [ "England", "england_rank_div" ], [ "Scotland", "scotland_rank_div" ] ];
    var i, tempNation, tempDiv;
    for(i = 0; i \\\< nations.length; i++) \\\{
        tempNation = nations[i][0];
        tempDiv = nations[i][1];
        if(selected === tempNation) \\\{
            document.getElementById(tempDiv).style.display = 'block';
        \\\} else \\\{
            document.getElementById(tempDiv).style.display = 'none';
        \\\}
    \\\}
  \\\}
\</script\>
\<style\>
    #cont_btn \\\{
        visibility: visible;
    \\\}
\</style\>
\\\<!-- confirm user is cast; offer chance to cancel --\\\>
\<div id="textarea"\>
\\\<!-- Check if the player has remaining character slots --\\\>
\<p\>
\$[/* Check how many characters we have already */           
\$bodies = Udat::query_bodies_in_roster(\$user: \$name);           
for(\$i = 0; \$i \< sizeof(\$bodies);)           
\{           
  if((\$bodies[\$i]."theatre:id" != Get(\$this, "theatre_id")) \|\| \$bodies[\$i].nocharcost)           
  \{           
    \$bodies -= (\{ \$bodies[\$i] \});           
  \} else \{           
    \$i++;           
  \}           
\}           
                                      
if (!\$bodies) \{           
  \$number = 0;           
\} else \{           
  \$number = sizeof(\$bodies);           
\}           
                                      
/* Check if we are allowed to add more */           
\$allowed = Get(\$this, "characterslots");           
/* If we are premium players */           
if(\$dat."skotos:flags:premium") \{           
  \$allowed += Get(\$this, "premium_bonus_characterslots");           
\}           
/* If we have our own extra slots */           
if(Get(\$dat, "roster:extra")) \{           
  \$allowed += Get(\$dat, "roster:extra");           
\}           
                            
if(\$number \>= \$allowed) \{           
  \$message = "You have "+Str(\$number)+" characters, and are allowed "+Str(\$allowed)+".";           
  \$full_roster = TRUE;           
\}           
\$message = "You have "+Str(\$number)+" characters, and are allowed "+Str(\$allowed)+".";           
return nil;]
\\\<!-- Check that we are allowed to create new characters --\\\>
\{? \| \$(full_roster) \| I'm sorry, you have already used up all your character slots. You will need to remove one of your current characters before creating a new one.\<sbr/\>
\| \<div style="color: red; font-weight: bold"\>
\$[\$str = "";           
   if(\$firstname_error) \{           
       if(contains(\$firstname_error, "taken_name")) \$str += "I'm sorry, but that name has already been used. Please choose another one.\<sbr/\>";           
       if(contains(\$firstname_error, "single_name")) \$str += "I'm sorry, you may only use single-word names.\<sbr/\>";           
       if(contains(\$firstname_error, "special_char")) \$str += "I'm sorry, but your name cannot contain any special characters.\<sbr/\>";           
       if(contains(\$firstname_error, "long_name")) \$str += "I'm sorry, but your name cannot be longer than 12 characters.\<sbr/\>";           
       if(contains(\$firstname_error, "no_name")) \$str += "You must enter a first name.\<sbr/\>";           
   \}           
                            
   if(\$lastname_error) \{           
       if(contains(\$lastname_error, "special_char")) \$str += "I'm sorry, but your name cannot contain any special characters.\<sbr/\>";           
       if(contains(\$lastname_error, "long_name")) \$str += "I'm sorry, but your name cannot be longer than 15 characters.\<sbr/\>";           
   \}           
                            
 return ParseXML(\$str);]
\{? \| \$(age_error) \| I'm sorry, please choose an age between 18 and 80. \}
\{? \| \$(rank_error) \| I'm sorry, that rank is no longer available to you. \} \</div\>
\<zform charclass="\$(charclass)" weapon="\$(weapon)" actname="\$(name)" actdat="\$(dat)"\>
\<table style="margin:auto;" width="90%"\>
  \<tr\>
    \<td\>
      \<p style="text-align: justify"\>
        The sun cresting the horizon casts a cool golden hue on your surroundings as you wait your turn in the slow-moving line. Travel papers in hand, you take one last look to ensure everything is in order.\</p\>
    \</td\>
  \</tr\>
\</table\>
\<br/\>
\<div style="margin:auto; background-image: url('http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/scroll.png'); background-size: 100%; background-repeat: no-repeat; width:550px; height:382px"\>
\<center\>\<table style="font-family:papyrus; font-size:15px; font-weight:700;" border="0"\>
  \<tr\>\<td\>\<br/\>\</td\>\</tr\>
  \<tr\>\<td colspan="2"\>\<font size="5"\>\<center\>\<b\>Laissez Passer\</b\>\</center\>\</font\>\<br/\>\</td\>\</tr\>
  \<tr\>
    \<td\>Name:\</td\>
    \<td\>
         \<select style="text-align:left" name="gender" class="form"\>\<option value="female" selected="1"\>Miss\</option\>\<option value="male"\>Mister\</option\>\</select\>
         \<input type="text" name="firstname" onfocus="this.value=''" value="First Name" class="form" size="10"/\>
         \<input type="text" name="lastname" onfocus="this.value=''" value="Last Name (optional)" class="form" size="20"/\>
    \</td\>
  \</tr\>
  \<tr\>
    \<td\>Age:\</td\>
    \<td\>\<input style="width:40px" type="number" name="age" min="18" max="80" value="20" class="form"/\>\</td\>
  \</tr\>
  \<tr\>
    \<td\>Birthplace:\</td\>
    \<td\>
        \<input type="text" onfocus="this.value=''" value="Village (optional)" style="width:100px" name="village" class="form"/\>
        \<select style="text-align:left" name="nation" id="nation" class="form" onchange="toggleRanks(this);"\>
          \<option value="France" selected="1"\>France\</option\>
          \<option value="Italy"\>Italy\</option\>
          \<option value="Scotland"\>Scotland\</option\>
          \<option value="Germany"\>Germany\</option\>
          \<option value="Spain"\>Spain\</option\>
          \<option value="England"\>England\</option\>
          \$[if(\$actdat."skotos:extra:regions") \{           
                \$accountType = general::getAccountType(\$udat: \$dat);           
                if(\$dat."testing:account-type") \$accountType = \$dat."testing:account-type";           
                \$regions = \$actdat."skotos:extra:regions";           
                if(sizeof(\$regions) \&\& member("africa", \$regions) \&\& \$accountType != "free") \{           
                    return ParseXML("\<option value='africa'\>Africa\</option\>");           
                \}           
           \}]
        \</select\>
    \</td\>
  \</tr\>
  \<tr\>
    \<td valign="top"\>Rank:\</td\>
    \<td\>\<div id="france_rank_div" style="display:block"\> \$[\$str = "\<select style='text-align:left' id='france_rank' name='france_rank' class='form'\>" +           
          "\<optgroup label='Commoner'\>\<option value='none::Rank 03' selected\>Freedman\</option\>\</optgroup\>";           
                            
          \$accountType = general::getAccountType(\$udat: \$dat);           
          if(\$dat."testing:account-type") \$accountType = \$dat."testing:account-type";           
                            
          \$purchasedRanks = ([ ]);           
          if(Get(\$actdat, "roster:noble-slots") \&\& \$accountType != "free") \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
          \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
          for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
              if(\$roster[\$i]."chargen:rank") \{           
                 \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
              \}           
          \}           
          if(!map_sizeof(\$purchasedRanks)) return ParseXML(\$str + "\</select\>");           
          \$options = map_indices(\$purchasedRanks);           
          \$rankMap = Get(\$this, "choices:rank");           
          \$loyalties = map_indices(\$rankMap) - (\{ "council", "constabulary" \});           
          for(\$i = 0; \$i \< sizeof(\$loyalties); \$i++) \{           
              \$str += "\<optgroup label='" + replace_strings(\$loyalties[\$i], "council", "Council", "church:social", "Church Social", "church:military", "Church Military", "social", "France Social", "military", "France Military", "underworld", "Undisclosed (Underworld)", "constabulary", "Constabulary") + "'\>";           
              for(\$j = 0; \$j \< sizeof(\$options); \$j++) \{           
                  \$str += "\<option value='" + \$loyalties[\$i] + "::" + \$options[\$j] + "'";           
    if(Int(\$purchasedRanks[\$options[\$j]]) \<= 0) \$str += "disabled";           
                  \$str += "\>" + \$rankMap[\$loyalties[\$i]][\$options[\$j]] + "\</option\>";           
              \}           
              \$str += "\</optgroup\>";           
          \}           
          \$str += "\</select\>";           
          return ParseXML(\$str);] \</div\>
          \<div id="scotland_rank_div" style="display:none"\> \$[\$str = "\<select style='text-align:left' name='scotland_rank' id='scotland_rank' class='form'\>" +           
          "\<optgroup label='Commoner'\>\<option value='none::Rank 03' selected\>Freedman\</option\>\</optgroup\>";           
          \$purchasedRanks = ([ ]);           
          if(Get(\$actdat, "roster:noble-slots")) \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
   \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
          for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
              if(\$roster[\$i]."chargen:rank") \{           
                 \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
              \}           
          \}           
          if(!map_sizeof(\$purchasedRanks)) return ParseXML(\$str + "\</select\>");           
          \$options = map_indices(\$purchasedRanks);           
          \$rankMap = Get(\$this, "choices:rank");           
          \$loyalties = map_indices(\$rankMap) - (\{ "council", "constabulary" \});           
          for(\$i = 0; \$i \< sizeof(\$loyalties); \$i++) \{           
              \$str += "\<optgroup label='" + replace_strings(\$loyalties[\$i], "church:social", "Church Social", "church:military", "Church Military", "social", "Scotland Social", "military", "Scotland Military", "underworld", "Undisclosed (Underworld)", "constabulary", "Constabulary") + "'\>";           
              for(\$j = 0; \$j \< sizeof(\$options); \$j++) \{           
                  \$str += "\<option value='" + \$loyalties[\$i] + "::" + \$options[\$j] + "'";           
    if(Int(\$purchasedRanks[\$options[\$j]]) \<= 0) \$str += "disabled";           
                  \$str += "\>" + \$rankMap[\$loyalties[\$i]][\$options[\$j]] + "\</option\>";           
              \}           
              \$str += "\</optgroup\>";           
          \}           
          \$str += "\</select\>";           
          return ParseXML(\$str);] \</div\>
          \<div id="germany_rank_div" style="display:none"\> \$[\$str = "\<select style='text-align:left' name='germany_rank' id='germany_rank' class='form'\>" +           
          "\<optgroup label='Commoner'\>\<option value='none::Rank 03' selected\>Freedman\</option\>\</optgroup\>";           
          \$purchasedRanks = ([ ]);           
          if(Get(\$actdat, "roster:noble-slots")) \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
   \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
          for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
              if(\$roster[\$i]."chargen:rank") \{           
                 \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
              \}           
          \}           
          if(!map_sizeof(\$purchasedRanks)) return ParseXML(\$str + "\</select\>");           
          \$options = map_indices(\$purchasedRanks);           
          \$rankMap = Get(\$this, "choices:rank");           
          \$loyalties = map_indices(\$rankMap) - (\{ "council", "church:social", "church:military", "constabulary" \});           
          for(\$i = 0; \$i \< sizeof(\$loyalties); \$i++) \{           
              \$str += "\<optgroup label='" + replace_strings(\$loyalties[\$i], "church:social", "Church Social", "church:military", "Church Military", "social", "Germany Social", "military", "Germany Military", "underworld", "Undisclosed (Underworld)", "constabulary", "Constabulary") + "'\>";           
              for(\$j = 0; \$j \< sizeof(\$options); \$j++) \{           
                  \$str += "\<option value='" + \$loyalties[\$i] + "::" + \$options[\$j] + "'";           
    if(Int(\$purchasedRanks[\$options[\$j]]) \<= 0) \$str += "disabled";           
                  \$str += "\>" + \$rankMap[\$loyalties[\$i]][\$options[\$j]] + "\</option\>";           
              \}           
              \$str += "\</optgroup\>";           
          \}           
          \$str += "\</select\>";           
          return ParseXML(\$str);] \</div\>
          \<div id="italy_rank_div" style="display:none;"\> \$[\$str = "\<select style='text-align:left' name='italy_rank' id='italy_rank' class='form'\>" +           
          "\<optgroup label='Commoner'\>\<option value='none::Rank 03' selected\>Freedman\</option\>\</optgroup\>";           
          \$purchasedRanks = ([ ]);           
          if(Get(\$actdat, "roster:noble-slots")) \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
   \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
          for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
              if(\$roster[\$i]."chargen:rank") \{           
                 \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
              \}           
          \}           
          if(!map_sizeof(\$purchasedRanks)) return ParseXML(\$str + "\</select\>");           
          \$options = map_indices(\$purchasedRanks);           
          \$rankMap = Get(\$this, "choices:rank");           
          \$loyalties = map_indices(\$rankMap);           
          for(\$i = 0; \$i \< sizeof(\$loyalties); \$i++) \{           
              \$str += "\<optgroup label='" + replace_strings(\$loyalties[\$i], "church:social", "Church Social", "church:military", "Church Military", "social", "Italy Social", "military", "Italy Military", "underworld", "Undisclosed (Underworld)", "constabulary", "Constabulary", "council", "Guild Council") + "'\>";           
              for(\$j = 0; \$j \< sizeof(\$options); \$j++) \{           
                  \$str += "\<option value='" + \$loyalties[\$i] + "::" + \$options[\$j] + "'";           
    if(Int(\$purchasedRanks[\$options[\$j]]) \<= 0) \$str += "disabled";           
                  \$str += "\>" + \$rankMap[\$loyalties[\$i]][\$options[\$j]] + "\</option\>";           
              \}           
              \$str += "\</optgroup\>";           
          \}           
                                      
          \$str += "\</select\>";           
          return ParseXML(\$str);] \</div\>
          \<div id="spain_rank_div" style="display:none"\> \$[\$str = "\<select style='text-align:left' name='spain_rank' id='spain_rank' class='form'\>" +           
          "\<optgroup label='Commoner'\>\<option value='none::Rank 03' selected\>Freedman\</option\>\</optgroup\>";           
          \$purchasedRanks = ([ ]);           
          if(Get(\$actdat, "roster:noble-slots")) \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
   \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
          for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
              if(\$roster[\$i]."chargen:rank") \{           
                 \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
              \}           
          \}           
          if(!map_sizeof(\$purchasedRanks)) return ParseXML(\$str + "\</select\>");           
          \$options = map_indices(\$purchasedRanks);           
          \$rankMap = Get(\$this, "choices:rank");           
          \$loyalties = map_indices(\$rankMap) - (\{ "council", "constabulary" \});           
          for(\$i = 0; \$i \< sizeof(\$loyalties); \$i++) \{           
              \$str += "\<optgroup label='" + replace_strings(\$loyalties[\$i], "church:social", "Church Social", "church:military", "Church Military", "social", "Spain Social", "military", "Spain Military", "underworld", "Undisclosed (Underworld)", "constabulary", "Constabulary") + "'\>";           
              for(\$j = 0; \$j \< sizeof(\$options); \$j++) \{           
                  \$str += "\<option value='" + \$loyalties[\$i] + "::" + \$options[\$j] + "'";           
    if(Int(\$purchasedRanks[\$options[\$j]]) \<= 0) \$str += "disabled";           
                  \$str += "\>" + \$rankMap[\$loyalties[\$i]][\$options[\$j]] + "\</option\>";           
              \}           
              \$str += "\</optgroup\>";           
          \}           
          \$str += "\</select\>";           
          return ParseXML(\$str);] \</div\>
          \<div id="england_rank_div" style="display:none"\> \$[\$str = "\<select style='text-align:left' name='england_rank' id='england_rank' class='form'\>" +           
          "\<optgroup label='Commoner'\>\<option value='none::Rank 03' selected\>Freedman\</option\>\</optgroup\>";           
          \$purchasedRanks = ([ ]);           
          if(Get(\$actdat, "roster:noble-slots")) \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
   \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
          for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
              if(\$roster[\$i]."chargen:rank") \{           
                 \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
              \}           
          \}           
          if(!map_sizeof(\$purchasedRanks)) return ParseXML(\$str + "\</select\>");           
          \$options = map_indices(\$purchasedRanks);           
          \$rankMap = Get(\$this, "choices:rank");           
          \$loyalties = map_indices(\$rankMap) - (\{ "council", "constabulary" \});           
          for(\$i = 0; \$i \< sizeof(\$loyalties); \$i++) \{           
              \$str += "\<optgroup label='" + replace_strings(\$loyalties[\$i], "church:social", "Church Social", "church:military", "Church Military", "social", "England Social", "military", "England Military", "underworld", "Undisclosed (Underworld)", "constabulary", "Constabulary") + "'\>";           
              for(\$j = 0; \$j \< sizeof(\$options); \$j++) \{           
                  \$str += "\<option value='" + \$loyalties[\$i] + "::" + \$options[\$j] + "'";           
    if(Int(\$purchasedRanks[\$options[\$j]]) \<= 0) \$str += "disabled";           
                  \$str += "\>" + \$rankMap[\$loyalties[\$i]][\$options[\$j]] + "\</option\>";           
              \}           
              \$str += "\</optgroup\>";           
          \}           
          \$str += "\</select\>";           
          return ParseXML(\$str);] \</div\>
          \<div id="akoma_rank_div" style="display:none;"\> \$[\$str = "\<select style='text-align:left' name='akoma_rank' id='akoma_rank' class='form'\>" +           
          "\<optgroup label='Commoner'\>\<option value='none::Rank 03' selected\>Freedman\</option\>\</optgroup\>";           
          \$purchasedRanks = ([ ]);           
          if(Get(\$actdat, "roster:noble-slots")) \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
   \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
          for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
              if(\$roster[\$i]."chargen:rank") \{           
                 \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
              \}           
          \}           
          if(!map_sizeof(\$purchasedRanks)) return ParseXML(\$str + "\</select\>");           
          \$options = map_indices(\$purchasedRanks);           
          \$rankMap = Get(\$this, "choices:rank");           
          \$loyalties = map_indices(\$rankMap) - (\{ "council", "church:social", "church:military", "constabulary", "social", "military" \});           
          for(\$i = 0; \$i \< sizeof(\$loyalties); \$i++) \{           
              \$str += "\<optgroup label='" + replace_strings(\$loyalties[\$i], "church:social", "Church Social", "church:military", "Church Military", "social", "Italy Social", "military", "Italy Military", "underworld", "Undisclosed (Underworld)", "constabulary", "Constabulary") + "'\>";           
              for(\$j = 0; \$j \< sizeof(\$options); \$j++) \{           
                  \$str += "\<option value='" + \$loyalties[\$i] + "::" + \$options[\$j] + "'";           
    if(Int(\$purchasedRanks[\$options[\$j]]) \<= 0) \$str += "disabled";           
                  \$str += "\>" + \$rankMap[\$loyalties[\$i]][\$options[\$j]] + "\</option\>";           
              \}           
              \$str += "\</optgroup\>";           
          \}           
                                      
          \$str += "\</select\>";           
          return ParseXML(\$str);] \</div\>
    \</td\>
  \</tr\>
  \<tr\>\<td\>\<br/\>\<br/\>\</td\>\</tr\>
\</table\>\</center\>
\</div\>
\<table style="margin:auto;" width="90%"\>
\<tr\>\<td\>\<p style="text-align: justify"\> At long last, you step forward and present your papers to the outstretched hand before you. The elderly man squints at the parchment in the dim light of the cool dawn, muttering softly under his breath. "Yes, everything seems to be in order here... very good. Move along now."\</p\>
\</td\>\</tr\>
\</table\>\<sbr/\>
  \<p\>\<input style="float:right" id="hidden-btn" type="submit" value="Proceed through the line." class="submit-button"/\>\</p\>
  \<action\>
 \$[/* Check how many characters we have already */           
  \$bodies = Udat::query_bodies_in_roster(\$user: \$actname);           
  for(\$i = 0; \$i \< sizeof(\$bodies);) \{           
     if((\$bodies[\$i]."theatre:id" != Get(\$this, "theatre_id")) \|\| \$bodies[\$i].nocharcost) \{           
        \$bodies -= (\{ \$bodies[\$i] \});           
     \} else \{           
        \$i++;           
     \}           
  \}           
                                      
  if (!\$bodies) \{           
     \$number = 0;           
  \} else \{           
     \$number = sizeof(\$bodies);           
  \}           
                            
  /* Check if we are allowed to add more */           
  \$allowed = Get(\$this, "characterslots");           
                                
  /* If we are premium players */           
  if(\$actdat."skotos:flags:premium") \{           
     \$allowed += Get(\$this, "premium_bonus_characterslots");           
  \}           
                                  
  /* If we have our own extra slots */           
  if(Get(\$actdat, "roster:extra")) \{           
     \$allowed += Get(\$actdat, "roster:extra");           
  \}           
                            
  if(\$number \>= \$allowed) \{           
     \$full_roster = "true";           
   return 0;           
  \}           
                            
  if(\$firstname) \{           
   \$firstname_error = "";           
   if(strlen(\$firstname) \> 12) \$firstname_error += "long_name ";           
   if(contains(\$firstname, " ") \|\| contains(\$firstname, "'")) \$firstname_error += "single_name ";           
                 if(contains(\$firstname, "-") \|\| contains(\$firstname, "1") \|\| contains(\$firstname, "2") \|\| contains(\$firstname, "3") \|\| contains(\$firstname, "4") \|\| contains(\$firstname, "5") \|\| contains(\$firstname, "6") \|\| contains(\$firstname, "7") \|\| contains(\$firstname, "8") \|\| contains(\$firstname, "9") \|\| contains(\$firstname, "0") \|\| contains(\$firstname, "_") \|\| contains(\$firstname, "`") \|\| contains(\$firstname, "~") \|\| contains(\$firstname, "!") \|\| contains(\$firstname, "@") \|\| contains(\$firstname, "#") \|\| contains(\$firstname, "\\\$") \|\| contains(\$firstname, "^") \|\| contains(\$firstname, "\&") \|\| contains(\$firstname, "*")\|\| contains(\$firstname, "(") \|\| contains(\$firstname, ")") \|\| contains(\$firstname, "+") \|\| contains(\$firstname, "\\=") \|\| contains(\$firstname, "\\\{") \|\| contains(\$firstname, "[") \|\| contains(\$firstname, "]") \|\| contains(\$firstname, "\\\}") \|\| contains(\$firstname, "\\\\") \|\| contains(\$firstname, "\|") \|\| contains(\$firstname, ":") \|\| contains(\$firstname, ";") \|\| contains(\$firstname, "\\\<") \|\| contains(\$firstname, "\\\>") \|\| contains(\$firstname, ",") \|\| contains(\$firstname, "//") \|\| contains(\$firstname, "?")) \$firstname_error += "special_char ";           
  \} else \{           
   \$firstname_error = "no_name";           
  \}           
  if(\$firstname_error != "") \{           
   return 0;           
  \} else \{           
   \$firstname_error = nil;           
  \}           
  \$firstname = lower_case(\$firstname);           
                if(Obj("Chatters:IC:" + \$firstname[0..1] + ":" + \$firstname) \&\& Get(\$\{UserAPI:UDatD\}, "bodies:" + \$firstname)) \{           
          if(Obj("Chatters:IC:" + \$firstname[0..1] + ":" + \$firstname) \&\& \$actname == Obj("Chatters:IC:" + \$firstname[0..1] + ":" + \$firstname)."skotos:creator" \&\& !Obj("Chatters:IC:" + \$firstname[0..1] + ":" + \$firstname)."chargen:finished") \{           
    \$continue_chargen = "true";           
    return 0;           
      \} else \{           
    \$firstname_error = "taken_name";           
    return 0;           
   \}           
  \}           
  if(Get(\$\{Ironclaw:Neoct:Verbs:Staff:reservedb\}, "chatters:"+this.theatre_id+":"+\$firstname[0..1]+":"+\$firstname)) \{           
   if(Get(\$\{Ironclaw:Neoct:Verbs:Staff:reservedb\}, "chatters:"+this.theatre_id+":"+\$firstname[0..1]+":"+\$firstname)[0] == \$actname) \{           
    \$create_reserved = "true";           
    return 0;           
              \} else \{           
             \$firstname_error = "taken_name";           
   \}           
         \}           
  if(\$lastname \&\& \$lastname != "" \&\& \$lastname != "Last Name (optional)") \{           
                            
   \$lastname_error = "";           
   if(strlen(\$lastname) \> 15) \$lastname_error += "long_name ";           
                 if(contains(\$lastname, "-") \|\| contains(\$lastname, "1") \|\| contains(\$lastname, "2") \|\| contains(\$lastname, "3") \|\| contains(\$lastname, "4") \|\| contains(\$lastname, "5") \|\| contains(\$lastname, "6") \|\| contains(\$lastname, "7") \|\| contains(\$lastname, "8") \|\| contains(\$lastname, "9") \|\| contains(\$lastname, "0") \|\| contains(\$lastname, "_") \|\| contains(\$lastname, "`") \|\| contains(\$lastname, "~") \|\| contains(\$lastname, "!") \|\| contains(\$lastname, "@") \|\| contains(\$lastname, "#") \|\| contains(\$lastname, "\\\$") \|\| contains(\$lastname, "^") \|\| contains(\$lastname, "\&") \|\| contains(\$lastname, "*")\|\| contains(\$lastname, "(") \|\| contains(\$lastname, ")") \|\| contains(\$lastname, "+") \|\| contains(\$lastname, "\\=") \|\| contains(\$lastname, "\\\{") \|\| contains(\$lastname, "[") \|\| contains(\$lastname, "]") \|\| contains(\$lastname, "\\\}") \|\| contains(\$lastname, "\\\\") \|\| contains(\$lastname, "\|") \|\| contains(\$lastname, ":") \|\| contains(\$lastname, ";") \|\| contains(\$lastname, "\\\<") \|\| contains(\$lastname, "\\\>") \|\| contains(\$lastname, ",") \|\| contains(\$lastname, "//") \|\| contains(\$lastname, "?")) \$lastname_error += "special_char ";           
  \} else \{           
    /* \$lastname_error = "no_name"; */           
    \$lastname = nil;           
  \}           
                            
  if(\$lastname_error \&\& \$lastname_error != "") \{           
   return 0;           
  \} else \{           
                        \$lastname_error = nil;           
                \}           
                            
  if(\$lastname) \$lastname = lower_case(\$lastname);           
                            
  if(Int(\$age) \< 18 \|\| Int(\$age) \> 80) \{           
   \$age_error = "true";           
   return 0;           
  \}           
                            
    if(\$nation == "France") \{           
         if(!\$france_rank) \$france_rank = "none::Rank 03";           
         \$loyalty = explode(\$france_rank, "::")[0];           
        \$rank = explode(\$france_rank, "::")[1];           
         switch(\$loyalty) \{           
             case "social":           
     \$group = "france";           
     \$lang = "french";           
     break;           
      case "military":           
     \$group = "france_mil";           
     \$lang = "french";           
     break;           
      case "church:social":           
     \$group = "church";           
     \$lang = "latin";           
     break;           
      case "church:military":           
     \$group = "church_mil";           
     \$lang = "latin";           
     break;           
      case "underworld":           
     \$group = "underworld";           
     \$lang = "dusky";           
     break;           
                            
     case "none":           
         \$lang = "france";           
         break;           
                            
     default:           
     \$lang = "france";           
     break;           
                \}           
           \}           
                            
     if(\$nation == "Scotland") \{           
         if(!\$scotland_rank) \$scotland_rank = "none::Rank 03";           
         \$loyalty = explode(\$scotland_rank, "::")[0];           
         \$rank = explode(\$scotland_rank, "::")[1];           
         switch(\$loyalty) \{           
            case "social":           
     \$group = "scotland";           
     \$lang = "scottish";           
     break;           
      case "military":           
     \$group = "scotland_mil";           
     \$lang = "scottish";           
     break;           
      case "church:social":           
     \$group = "church";           
     \$lang = "latin";           
     break;           
      case "church:military":           
     \$group = "church_mil";           
     \$lang = "latin";           
     break;           
     case "underworld":           
     \$group = "underworld";           
     \$lang = "dusky";           
     break;           
                            
     case "none":           
         \$lang = "scottish";           
         break;           
                    default:           
     \$lang = "scottish";           
     break;           
                \}           
           \}           
                            
           if(\$nation == "Germany") \{           
         if(!\$germany_rank) \$germany_rank = "none::Rank 03";           
         \$loyalty = explode(\$germany_rank, "::")[0];           
         \$rank = explode(\$germany_rank, "::")[1];           
         switch(\$loyalty) \{           
             case "social":           
     \$group = "germany";           
     \$lang = "german";           
     break;           
      case "military":           
     \$group = "germany_mil";           
     \$lang = "german";           
     break;           
      case "underworld":           
     \$group = "underworld";           
     \$lang = "dusky";           
     break;           
                            
     case "none":           
         \$lang = "german";           
         break;           
                            
     default:           
     \$lang = "german";           
     break;           
                \}           
           \}           
                            
           if(\$nation == "Italy") \{           
         if(!\$italy_rank) \$italy_rank = "none::Rank 03";           
         \$loyalty = explode(\$italy_rank, "::")[0];           
         \$rank = explode(\$italy_rank, "::")[1];           
         switch(\$loyalty) \{           
             case "social":           
     \$group = "italy";           
     \$lang = "italian";           
     break;           
      case "military":           
     \$group = "italy_mil";           
     \$lang = "italian";           
     break;           
      case "church:social":           
     \$group = "church";           
     \$lang = "latin";           
     break;           
      case "church:military":           
     \$group = "church_mil";           
     \$lang = "latin";           
     break;           
      case "underworld":           
     \$group = "underworld";           
     \$lang = "dusky";           
     break;           
          
     case "none":           
         \$lang = "italian";           
         break;           
                    default:           
     \$lang = "italian";           
     break;           
                \}           
           \}           
                            
  if(\$rank != "Rank 03") \{           
   \$purchasedRanks = ([ ]);           
            if(Get(\$actdat, "roster:noble-slots")) \$purchasedRanks = copy(Get(\$actdat, "roster:noble-slots"));           
     \$roster = udat::query_bodies_in_roster(\$user: \$actname);           
            for(\$i = 0; \$i \< sizeof(\$roster); \$i++) \{           
                 if(\$roster[\$i]."chargen:rank") \{           
                    \$purchasedRanks[\$roster[\$i]."chargen:rank"] = Int(\$purchasedRanks[\$roster[\$i]."chargen:rank"]) - 1;           
                 \}           
            \}           
                            
   if(\$purchasedRanks[\$rank] \<= 0) \{           
    \$rank_error = "true";           
    return 0;           
   \}           
  \}           
                            
  return 1;]
 \{? \| \$(full_roster) \| \<redirect propob="\$(this)" full_roster="true"/\> \|
  \{? \| \$(firstname_error) \| \<redirect propob="\$(this)" firstname_error="\$(firstname_error)"/\> \|
   \{? \| \$(continue_chargen) \| \<redirect propob="\$(this)" characterref="\$[Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname)]"/\> \|
    \{? \| \$(lastname_error) \| \<redirect propob="\$(this)" lastnme_error="\$(lastname_error)"/\> \|
     \{? \| \$(rank_error) \| \<redirect propob="\$(this)" rank_error="true"/\> \|
      \{? \| \$(create_reserved) \|
       \<create-chatter gender="\$(gender)" char="\$(firstname)"/\>
                  \$[Set(Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname), "trait:animal", Get(\$\{Ironclaw:Neoct:Verbs:Staff:reservedb\}, "chatters:"+this.theatre_id+":"+\$firstname[0..1]+":"+\$firstname)[1]);]
                  \$[Set(Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname), "trait:animaltype", Get(\$\{Ironclaw:Neoct:Verbs:Staff:reservedb\}, "chatters:"+this.theatre_id+":"+\$firstname[0..1]+":"+\$firstname)[2]);]
                  \$[Set(Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname), "chargen:state", "auto");]
                  \$[/* find the parent object */           
                   \$list = Get(\$this, "choices:animallist");           
                   for(\$i=0;\$i\<sizeof(\$list);\$i++)\{           
                      if(\$list[\$i][1] == Get(Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname), "trait:animaltype")) \{           
                        Set(Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname), "core:ur:parent", \$list[\$i][2]);           
                        return TRUE;           
                      \}           
                   \}           
                   return TRUE;]
                  \<redirect propob="\$(this)" characterref="\$[Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname)]"/\>
         \|
         \<create-chatter gender="\$(gender)" char="\$(firstname)"/\>
       \$[\$chatter = Obj("Chatters:IC:" + \$firstname[0..1] + ":" + \$firstname);        
         \$chatter."base:urparent" = \$\{Allegory:Bodies:Mainbody\};        
         \$chatter."core:urparent" = \$\{Allegory:Bodies:Mainbody\};        
         \$chatter."core:ur:parent" = \$\{Allegory:Bodies:Mainbody\};        
     
         \$newname = replace_strings(\$chatter."base:objectname", ":IC:", ":AE:");     
     
         \$chatter."base:objectname" = \$newname;     
         \$chatter."core:objectname" = \$newname;     
          
         \$chatter."chargen:age" = Int(\$age);           
         \$chatter."trait:age" = Int(\$age);           
         \$chatter."chargen:village" = Str(\$village);           
         \$chatter."chargen:region" = Str(\$nation);           
                           
         if(\$lang) Set(\$chatter, "chargen:lang", \$lang);           
         if(\$lang2) Set(\$chatter, "chargen:lang2", \$lang2); else Set(\$chatter, "chargen:lang2", nil);           
         if(\$lastname \&\& \$lastname != "" \&\& \$lastname != "Last Name (optional)") \{           
            \$chatter."chargen:lastname" = capitalize(\$lastname);           
            \$chatter."trait:lastname" = capitalize(\$lastname);          
            \$temp = explode(\$lastname, " ");           
            for(\$i = 0; \$i \< sizeof(\$temp); \$i++) \{           
                if(\$i \< (sizeof(\$temp) - 1)) \{           
                    Set(\$chatter, "details:default:adjective:" + \$temp[\$i], TRUE);           
                \} else \{           
                    Set(\$chatter, "details:default:sname:" + \$temp[\$i], TRUE);           
                \}           
            \}          
         \}           
                   
         \$inventory = \$chatter."base:inventory";           
         for(\$i = 0; \$i \< sizeof(\$inventory); \$i++) \{           
             Slay(\$inventory[\$i]);           
         \}   
   
         \$chatter."chargen:class" = \$charclass;   
         \$chatter."chargen:weapon" = \$weapon;   
                   
         if(\$rank != "Rank 03") \{           
             Set(\$chatter, "chargen:rank", \$rank);           
             \$rank = Int(replace_strings(\$rank, "Rank 0", "", "Rank ", ""));           
                                    
     /*                       
             if(\$loyalty == "social") \{           
                 \$tmp = Call(\$\{Ironclaw:Lib:Characters:Rank\}, "get_rank_names_noble", \$char: \$chatter, \$groupname: \$nation, \$level: \$rank);           
             \} else if(\$loyalty == "military") \{           
                 \$tmp = Call(\$\{Ironclaw:Lib:Characters:Rank\}, "get_rank_names_military", \$char: \$chatter, \$groupname: \$nation, \$level: \$rank);           
             \} else if(\$loyalty == "constabulary") \{           
                 \$tmp = Call(\$\{Ironclaw:Lib:Characters:Rank\}, "get_rank_names_costables", \$char: \$chatter, \$groupname: "constables", \$level: \$rank);           
             \} else if(\$loyalty == "church:social") \{           
                 \$tmp = Call(\$\{Ironclaw:Lib:Characters:Rank\}, "get_rank_names_church", \$char: \$chatter, \$groupname: "church", \$level: \$rank);           
             \} else if(\$loyalty == "church:military") \{           
                 \$tmp = Call(\$\{Ironclaw:Lib:Characters:Rank\}, "get_rank_names_church_mil", \$char: \$chatter, \$groupname: "church", \$level: \$rank);           
             \} else if(\$loyalty == "underworld") \{           
                 \$tmp = Call(\$\{Ironclaw:Lib:Characters:Rank\}, "get_rank_names_underworld", \$char: \$chatter, \$groupname: "underworld", \$level: \$rank);           
             \}          
                            
             \$rankname = \$tmp["rankname"];           
             \$title = \$tmp["title"];           
             \$path = "status:" + \$group;           
             Call(\$\{Ironclaw:Lib:Characters:Rank\}, "set_rank", \$path: \$path, \$char: \$chatter, \$rank: \$rank, \$rankname: \$rankname); */    
         \}]
       \<redirect propob="\$(this)" characterref="\$[Obj("Chatters:" + this.theatre_id + ":" + \$firstname[0..1] + ":" + \$firstname)]"/\>
      \}
     \}
    \}
   \}
  \}
 \}
  \</action\>
\</zform\>\<br/\>
\}
\</p\>
\</div\>
      </Core:Property>
      <Core:Property property="export:xtra:state:char-bio:goback">
         X[S] \<redirect propob="\$(this)"/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:end">
         X[S] \<style\>
    #cont_btn \\\{
        visibility: visible;
    \\\}
\</style\>\\\<!-- This is the final page of the character generator --\\\>
\<p\>
\<strong\>Confirm Character\</strong\>\<br/\>
\</p\>
\<p style="text-align:justify"\>
\<i\>[Below is your character stat sheet. Please review it thoroughly before entering the game world.]\</i\>
\<div style="width: 500px; background: white; text-align:middle"\>
    \<zform actbody="\$(body)" actfeatures="\$(careerarray)"\>
  \<b\>Name:\</b\>
  \$[capitalize(\$body."skotos:charname")] \$(body.chargen:lastname) \<br/\>
                \<b\>Gender:\</b\>
                \$(body.base:genderstring) \<br/\>
                \<b\>Age:\</b\>
                \$(body.trait:age) \<br/\>
                \<b\>Birthplace:\</b\>
                \$(body.chargen:village) in \$(body.chargen:region) territory \<br/\>
                \<b\>Rank:\</b\>
                \$(body.rank:rankname) \<br/\>
                \<b\>Attributes:\</b\>
                        \<b\>\<i\>\\\&nbsp;\\\&nbsp;\\\&nbsp;\\\&nbsp;Strength\</i\>\</b\>\\\&nbsp;d\$(body.trait:strength)
                        \<b\>\<i\>\\\&nbsp;\\\&nbsp;\\\|\\\&nbsp;\\\&nbsp;Speed\</i\>\</b\>\\\&nbsp;d\$(body.trait:speed)
                        \<b\>\<i\>\\\&nbsp;\\\&nbsp;\\\|\\\&nbsp;\\\&nbsp;Resilience\</i\>\</b\>\\\&nbsp;d\$(body.trait:resilience)
                        \<b\>\<i\>\\\&nbsp;\\\&nbsp;\\\|\\\&nbsp;\\\&nbsp;Perception\</i\>\</b\>\\\&nbsp;d\$(body.trait:perception)
                        \<b\>\<i\>\\\&nbsp;\\\&nbsp;\\\|\\\&nbsp;\\\&nbsp;Intelligence\</i\>\</b\>\\\&nbsp;d\$(body.trait:intelligence)
                        \<b\>\<i\>\\\&nbsp;\\\&nbsp;\\\|\\\&nbsp;\\\&nbsp;Charisma\</i\>\</b\>\\\&nbsp;d\$(body.trait:charisma)\<br/\>
                \<b\>Class:\</b\>
                        \$["";  
                           \$rstr = "";  
                                       \$rstr += "\<b\>\<i\>\\\&nbsp;\\\&nbsp;\\\&nbsp;\\\&nbsp;\$(body.temp:class)\</i\>\</b\>\\\&nbsp;d5";  
  
   
                           return ParseXML(\$rstr);]
                        \<br/\>
    \</zform\>
\</div\>
\<p style="text-align:justify"\>\$(body.trait:examine)\</p\>\<br/\>
\<form action="http://ironclaw.skotos.net/SAM/Prop/Ironclaw:Theatre:Theatre/Index" method="post"\>
 \<p style="text-align:justify"\>I'm ready to play!
 \<input type="submit" id="hidden-btn" value="Create Character" class="submit-button"/\>\</p\>
\</form\>
\<zform actbody="\$(body)"\>
\<p style="text-align:justify"\>I don't like this character. I want to start over.
\<input type="submit" value="Delete Character" class="submit-button"/\>\</p\>
  \<action\>
    \$[Slay(\$actbody);]
    \<redirect propob="\$(this)"/\>
  \</action\>
\</zform\>
\</p\>
      </Core:Property>
      <Core:Property property="export:xtra:state:end:goback">
         X[S] \$[\$actbody."chargen:state" = "attributes";]
\<redirect propob="\$(this)" characterref="\$(actbody)"/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:no-body">
         X[S] \<div class="error"\>
    \{? \| \$(error_class) \| You must select a class. \|
        \{? \| \$(error_weapon) \| You must select a weapon specialization. \}
    \}
    \{? \| \$(error_class_invalid) \| You must select a valid class. \}
    \{? \| \$(error_weapon_invalid) \| You must select a valid weapon. \}
\</div\>
\<div class="heading"\>
    \<img id="class" alt="Choose Your Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/class.png"/\>\<br/\>
\</div\>
\<div class="classes"\>
    \<div class="single-class" id="fighter" onclick="showDesc(this)"\>
        \<div class="class-image" id="fighter-image"\>\</div\>
        \<div class="class-title"\>
            \<img class="title-img" alt="Fighter Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/fighter.png"/\>
        \</div\>
    \</div\>
    \<div class="single-class" id="ranger" onclick="showDesc(this)"\>
        \<div class="class-image" id="ranger-image"\>\</div\>
        \<div class="class-title"\>
            \<img class="title-img" alt="Ranger Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/ranger.png"/\>
        \</div\>
    \</div\>
    \<div class="single-class" id="rogue" onclick="showDesc(this)"\>
        \<div class="class-image" id="rogue-image"\>\</div\>
        \<div class="class-title"\>
            \<img class="title-img" alt="Rogue Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/rogue.png"/\>
        \</div\>
    \</div\>
    \<div class="single-class" id="academic" onclick="showDesc(this)"\>
        \<div class="class-image" id="academic-image"\>\</div\>
        \<div class="class-title"\>
            \<img class="title-img" alt="Academic Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/academic.png"/\>
        \</div\>
    \</div\>
    \<div class="single-class" id="tradesman" onclick="showDesc(this)"\>
        \<div class="class-image" id="tradesman-image"\>\</div\>
        \<div class="class-title"\>
            \<img class="title-img" alt="Tradesman Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/tradesman.png"/\>
        \</div\>
    \</div\>
\</div\>
\<div id="classes-description" class="description"\>
Before embarking in the world of Allegory of Empires, choose the class that best describes the type of person your character is. Choose carefully, as this decision, like all others, will determine the path you take within this world.\<br/\>
\</div\>
\<zform\>
    \<div id="fighter-description" class="description"\>
        \<img class="class-title-two" style="position: relative; left: -8px;" alt="The Fighter Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/thefighterclass.png"/\>
        The clash of steel; sparks fly as the blades meet. Fighters are at home in the heat of battle, testing their mettle against foes both worthy and not. Do you yearn for the feel of a weapon in your hands or to fight for your cause?
        \<br/\>
        \<img class="subclass-title" alt="Subclasses" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/subclasses.png"/\>
        \<div class="subclasses"\>
            \<div id="one-handed-fighter" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>One-handed Fighter\</div\>\</div\>
                \<div class="subclass-content"\>
                    With artistry and grace, you are the master of your chosen weapons while defending against your foe with a shield in hand.\<br/\>
                    \<b\>Available Skills:\</b\> axe, club, dagger, dodge, parry, precision, shield, sword, whip\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td class="skill-cell"\>\<select id="one-handed-fighter-weapon" name="one-handed-fighter-weapon"\>
                            \<option value=""\>WEAPON\</option\>
                            \<option value="axe"\>axe\</option\>
                            \<option value="club"\>club\</option\>
                            \<option value="dagger"\>dagger\</option\>
                            \<option value="sword"\>sword\</option\>
                            \<option value="whip"\>whip\</option\>
                          \</select\>\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>dodge\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>parry\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="one-handed-fighter-class" name="one-handed-fighter-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="two-handed-fighter" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Two-handed Fighter\</div\>\</div\>
                \<div class="subclass-content"\>
                    Brawn is your specialty and the weapons you wield are just as mighty. You are the master of the most imposing of weapons.\<br/\>
                    \<b\>Available Skills:\</b\> axe, club, dodge, endurance, parry, polearm, sword\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td class="skill-cell"\>\<select id="two-handed-fighter-weapon" name="two-handed-fighter-weapon"\>
                            \<option value=""\>WEAPON\</option\>
                            \<option value="axe"\>axe\</option\>
                            \<option value="club"\>club\</option\>
                            \<option value="polearm"\>polearm\</option\>
                            \<option value="sword"\>sword\</option\>
                          \</select\>\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>dodge\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>parry\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="two-handed-fighter-class" name="two-handed-fighter-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="dual-wielding-fighter" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Dual-wielding Fighter\</div\>\</div\>
                \<div class="subclass-content"\>
                    If you can kill two birds with one stone, imagine what you could do with two. You strike at your foe with double the bite, wielding two weapons instead of one.\<br/\>
                    \<b\>Available Skills:\</b\> axe, club, dagger, dodge, parry, precision, sword\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td class="skill-cell"\>\<select id="dual-wielding-fighter-weapon" name="dual-wielding-fighter-weapon"\>
                            \<option value=""\>WEAPON\</option\>
                            \<option value="axe"\>axe\</option\>
                            \<option value="club"\>club\</option\>
                            \<option value="dagger"\>dagger\</option\>
                            \<option value="sword"\>sword\</option\>
                          \</select\>\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>dodge\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>parry\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="dual-wielding-fighter-class" name="dual-wielding-fighter-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="unarmed-fighter" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Unarmed Fighter\</div\>\</div\>
                \<div class="subclass-content"\>
                    Who needs a weapon when yours are part of your very essence. Unarmed fighters can fell any foe with nothing more than their body and skill.\<br/\>
                    \<b\>Available Skills:\</b\> dodge, endurance, parry, precision, unarmed\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>dodge\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>parry\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>unarmed\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="unarmed-fighter-class" name="unarmed-fighter-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
        \</div\>
    \</div\>
    \<div id="ranger-description" class="description"\>
        \<img class="class-title-two" style="position: relative; left: -8px;" alt="The Ranger Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/therangerclass.png"/\>
        A hush fills your mind, your senses keenly aware of your surroundings. With practiced grace, your prey falls and the sounds of the wilderness around you come alive once more. The wilds are your comfort and this setting fits like a glove.
        \<br/\>
        \<div class="subclasses"\>
            \<div id="ranger" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Ranger\</div\>\</div\>
                \<div class="subclass-content"\>
                    With cat-like grace and a keen eye, you're most at home where your prey roams wild. With your well-honed skills, the game of predator and prey thrills like no other.\<br/\>
                    \<b\>Available Skills:\</b\> archery, dagger, dodge, gun, polearm, skinning, tracking, trapping\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td class="skill-cell"\>\<select id="ranger-weapon" name="ranger-weapon"\>
                            \<option value=""\>WEAPON\</option\>
                            \<option value="archery"\>archery\</option\>
                            \<option value="dagger"\>dagger\</option\>
                            \<option value="gun"\>gun\</option\>
                            \<option value="polearm"\>polearm\</option\>
                          \</select\>\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>skinning\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>trapping\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="ranger-class" name="ranger-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
        \</div\>
    \</div\>
    \<div id="rogue-description" class="description"\>
        \<img style="position: relative; left: -15px;" class="class-title-two" alt="The Rogue Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/therogueclass.png"/\>
        Right and wrong is neither black nor white, but shades of grey as dark as the shadows that cloak your intentions. Perhaps the ends justify the means, but only you will ever really know the reasons for your choices. It is not only those who are free of sin that cast the first stone, so be sure to master your dark arts.
        \<br/\>
        \<img class="subclass-title" alt="Subclasses" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/subclasses.png"/\>
        \<div class="subclasses"\>
            \<div id="assassin" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Assassin\</div\>\</div\>
                \<div class="subclass-content"\>
                    With the target in your sights, you move like the whispers that brought you here. The deed is done and you slip away into the cloak of darkness with death as your wake.\<br/\>
                    \<b\>Available Skills:\</b\> dagger, dodge, endurance, parry, poison, precision, sneak\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>dagger\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>poison\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>sneak\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="assassin-class" name="assassin-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="spy" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Spy\</div\>\</div\>
                \<div class="subclass-content"\>
                    A tangled web you weave when you practice to deceive. Whispers are your currency and knowledge is your goal. How you trade them is up to you.\<br/\>
                    \<b\>Available Skills:\</b\> dagger, dodge, eavesdrop, endurance, lipread, parry, precision, sneak\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>dagger\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>lipread\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>sneak\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="spy-class" name="spy-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="thief" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Thief\</div\>\</div\>
                \<div class="subclass-content"\>
                    One will always find a way to survive, whether those methods are noble is another thing entirely. And those with the will can do more than survive; they can thrive.\<br/\>
                    \<b\>Available Skills:\</b\> dagger, dodge, endurance, parry, pickpocket, precision, sneak, steal\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>dagger\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>pickpocket\</td\>\<td\>[3]\</td\>\</tr\>
                          \<tr\>\<td\>sneak\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="thief-class" name="thief-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
        \</div\>
    \</div\>
    \<div id="academic-description" class="description"\>
        \<img class="class-title-two" style="position: relative; left: -7px;" alt="The Academic Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/theacademicclass.png"/\>
        Perhaps the most mysterious gift is that of the mind, and those who can wield it will find a wealth of resources to navigate this tricky world. How you choose to use it is up to you. Regardless of the goal, the power of knowledge is a wondrous one that can move mountains no sword will ever dent.
        \<br/\>
        \<img class="subclass-title" alt="Subclasses" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/subclasses.png"/\>
        \<div class="subclasses"\>
            \<div id="body-servant" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Body Servant\</div\>\</div\>
                \<div class="subclass-content"\>
                    Handmaid, valet, etc.\<br/\>
                    \<b\>Available Skills:\</b\> hairstyling, eavesdrop, lipread\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>hairstyling\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="body-servant-class" name="body-servant-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="healer" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Healer\</div\>\</div\>
                \<div class="subclass-content"\>
                    With tenderness and care, your hands can make miracles of someone's darkest day. Use your knowledge to bring hope to those who need such care.\<br/\>
                    \<b\>Available Skills:\</b\> healing, herbalism\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>healing\</td\>\<td\>[3]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="healer-class" name="healer-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="socialite" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Socialite\</div\>\</div\>
                \<div class="subclass-content"\>
                    In the twisted web of politics and promises, quick wit and a quicker tongue can pave the way faster than any blade. How will you wield this articulate weapon?\<br/\>
                    \<b\>Available Skills:\</b\> art, eavesdrop, lipread, music\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>art\</td\>\<td\>[5]\</td\>\</tr\>
                          \<tr\>\<td\>music\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="socialite-class" name="socialite-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
        \</div\>
    \</div\>
    \<div id="tradesman-description" class="description"\>
        \<img class="class-title-two" style="position: relative; left: -5px;" alt="The Tradesman Class" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/thetradesmanclass.png"/\>
        The reward of a hard day's work is the most fulfilling feeling in the world, and to see something crafted by your own hands is a joy unlike any other. Careful stitches, painstaking engravings or the heat of the forge are your lifeblood and the end results are treasures worth more than their weight in gold.
        \<br/\>
        \<img class="subclass-title" alt="Subclasses" src="http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/subclasses.png"/\>
        \<div class="subclasses"\>
            \<div id="blacksmith" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Blacksmith\</div\>\</div\>
                \<div class="subclass-content"\>
                    The heft of the hammer, the sizzle of hot metal releasing steam into the air. Sweat beads on the brow as you force the unyielding metal to your whim and craft masterpieces with might.\<br/\>
                    \<b\>Available Skills:\</b\> metalworking, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>metalworking\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="blacksmith-class" name="blacksmith-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="bookbinder" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Bookbinder\</div\>\</div\>
                \<div class="subclass-content"\>
                    The pen is mightier than the sword, they say. And there is no better place to hold those precious words and powerful words than a book crafted under your careful guidance.\<br/\>
                    \<b\>Available Skills:\</b\> bookbinding, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>bookbinding\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="bookbinder-class" name="bookbinder-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="carpenter" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Carpenter\</div\>\</div\>
                \<div class="subclass-content"\>
                    The smell of fresh lumber, the resistance of the grain as your chisel slowly pries something from nothing. With hammer and nails and creative spirit, you've created a treasure.\<br/\>
                    \<b\>Available Skills:\</b\> woodworking, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>woodworking\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="carpenter-class" name="carpenter-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="dyer" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Dyer\</div\>\</div\>
                \<div class="subclass-content"\>
                    Dyer\<br/\>
                    \<b\>Available Skills:\</b\> dyeing, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>dyeing\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="dyer-class" name="dyer-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="jeweler" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Jeweler\</div\>\</div\>
                \<div class="subclass-content"\>
                    Precious metals and treasured gems are your canvas. With careful and precise skill, you create the priceless pieces that mark the moments more priceless than the gems themselves.\<br/\>
                    \<b\>Available Skills:\</b\> jewelcrafting, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>jewelcrafting\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="jeweler-class" name="jeweler-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="miner" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Miner\</div\>\</div\>
                \<div class="subclass-content"\>
                    With brute force and tireless might, your skills in coaxing hidden materials from the earth keeps the cogs of business churning.\<br/\>
                    \<b\>Available Skills:\</b\> mining, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>mining\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="miner-class" name="miner-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="seamstress" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Seamstress\</div\>\</div\>
                \<div class="subclass-content"\>
                    The monotonous push and pull of needle and thread punctuates countless moments of the day, but your keen eye and creative soul breathes life into swaths of colored fabric.\<br/\>
                    \<b\>Available Skills:\</b\> tailoring, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>tailoring\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="seamstress-class" name="seamstress-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="stonemason" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Stonemason\</div\>\</div\>
                \<div class="subclass-content"\>
                    Only the most gifted of minds can see the life hidden in a block of stone, and yours can coax that breath into even the coldest monoliths of earth.\<br/\>
                    \<b\>Available Skills:\</b\> stonemasonry, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>stonemasonry\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="stonemason-class" name="stonemason-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="weaver" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Weaver\</div\>\</div\>
                \<div class="subclass-content"\>
                    Deft fingertips and patience beyond compare give you the power to turn even the roughest fibers into supple swaths of fabric.\<br/\>
                    \<b\>Available Skills:\</b\> weaving, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>weaving\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="weaver-class" name="weaver-class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
            \<div id="woodcutter" class="single-subclass"\>
                \<div class="subclass-header"\>\<div class="subclass-heading"\>Woodcutter\</div\>\</div\>
                \<div class="subclass-content"\>
                    With a masterful eye, you can see the forest through the trees. Your sights find the perfect specimen and with a hearty heft of the axe, the prize is yours.\<br/\>
                    \<b\>Available Skills:\</b\> woodcutting, appraise, trading\<br/\>
                    \<b\>Starting Skills:\</b\>
                        \<table class="skill-table"\>
                          \<tr\>\<td\>woodcutting\</td\>\<td\>[5]\</td\>\</tr\>
                        \</table\>
                \</div\>
                \<div class="checkbox-container"\>
                    \<label class="checkbox-label"\>
                        \<input type="checkbox" class="radio" id="woodcutter-class" name="class" onClick="chooseClass(this)"/\>
                        \<span class="checkbox-custom circular"\>\</span\>\<span class="input-title"\>\</span\>
                    \</label\>
                \</div\>
            \</div\>
        \</div\>
    \</div\>
    \<input type="submit" id="hidden-btn"/\>
    \<action\>
        \$["";             
          if(GetVar("one-handed-fighter-class") == "on") \$charclass = "one-handed-fighter";            
          if(GetVar("two-handed-fighter-class") == "on") \$charclass = "two-handed-fighter";            
          if(GetVar("dual-wielding-fighter-class") == "on") \$charclass = "dual-wielding-fighter";            
          if(GetVar("unarmed-fighter-class") == "on") \$charclass = "unarmed-fighter";            
          if(GetVar("ranger-class") == "on") \$charclass = "ranger";            
          if(GetVar("assassin-class") == "on") \$charclass = "assassin";            
          if(GetVar("spy-class") == "on") \$charclass = "spy";            
          if(GetVar("thief-class") == "on") \$charclass = "thief";            
          if(GetVar("healer-class") == "on") \$charclass = "healer";            
          if(GetVar("socialite-class") == "on") \$charclass = "socialite";            
          if(GetVar("blacksmith-class") == "on") \$charclass = "blacksmith";            
          if(GetVar("bookbinder-class") == "on") \$charclass = "bookbinder";            
          if(GetVar("carpenter-class") == "on") \$charclass = "carpenter";            
          if(GetVar("jeweler-class") == "on") \$charclass = "jeweler";            
          if(GetVar("miner-class") == "on") \$charclass = "miner";            
          if(GetVar("seamstress-class") == "on") \$charclass = "seamstress";            
          if(GetVar("stonemason-class") == "on") \$charclass = "stonemason";            
          if(GetVar("weaver-class") == "on") \$charclass = "weaver";            
          if(GetVar("woodcutter-class") == "on") \$charclass = "woodcutter";      
          if(!\$charclass) \{      
              \$error_class = 1;      
          \} else \{      
              if(member(\$charclass, (\{ "one-handed-fighter", "two-handed-fighter", "dual-wielding-fighter", "unarmed-fighter", "ranger" \}))) \{    
                  if(GetVar(\$charclass + "-weapon") == "") \{      
                      \$error_weapon = 1;      
                  \} else \{      
                      \$weapon = GetVar(\$charclass + "-weapon");      
                  \}      
              \}    
          \}]
        \{? \| \$[\$error_class \|\| \$error_weapon] \|
            \<redirect propob="\$(this)" error_class="\$(error_class)" error_weapon="\$(error_weapon)"/\>
        \|
            \<redirect propob="\$(this)" charclass="\$(charclass)" weapon="\$(weapon)"/\>
        \}
    \</action\>
\</zform\>
      </Core:Property>
      <Core:Property property="export:xtra:state:no-body:continue">
         X[S] \<redirect propob="\$(this)" class="\$(class)"/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:no-body:goback">
         X[S] \<redirect propob="\$(this)" prop="intro"/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:runscripts">
         X[S] \\\<!-- This is where any merry scripts we need to run are run --\\\>
\$[\$body."chargen:state" = "end";                                                         
                                                         
                                                         
/* If the player is trying to cheat */                                                         
if(\$body."chargen:finished") \{                                                         
  return FALSE;                                                         
\}                                                         
                                                         
\$body."chargen:finished" = 1;                                                         
                                                         
/* Update the character description */                                                         
Call(\$\{Allegory:Lib:UrPeople:Description\}, "updatedesc");                                                         
                                                         
/* Set the character starting room */                                                         
if(\$body."chargen:start_location") \{               
    \$location = \$body."chargen:start_location";               
\} else \{               
    \$location = "newtown";               
\}               
               
switch(\$location) \{               
    case "docktown":               
    \{               
        \$virtual_room = Spawn(\$\{Allegory:Setting:Rinascita:Buildings:Southeast:Tavern:SecondFloor:Room01\});               
        \$body."virtualhome:severedtail:virtualn" = \$virtual_room;               
        break;               
    \}               
               
    default:               
    \{               
        \$virtual_room = Spawn(\$\{Allegory:Setting:Rinascita:Buildings:Southwest:AnasetteApartments:FirstFloor:Virtual:ClosetOne\});               
        \$body."virtualhome:gildedbalance:firstfloor:closetone" = \$virtual_room;               
        break;               
    \}               
\}               
               
\$virtual_room.homeowner = \$body;               
\$body."virtualhome:home" = \$virtual_room;               
\$body."base:environment" = \$virtual_room;               
\$body."base:environment" = nil;             
               
               
/* Set starting language */               
if(\$body."chargen:lang") Set(\$body, "skill:lang:" + Str(\$body."chargen:lang"), 8);               
if(\$body."chargen:lang2") Set(\$body, "skill:lang:" + Str(\$body."chargen:lang2"), 8);               
               
               
/* Set the character attributes */               
\$strength1 = 4 + random(3);   
\$strength2 = 4 + random(3);   
if(\$strength1 \> \$strength2) \{    
    \$strength = \$strength1;   
\} else \{   
    \$strength = \$strength2;   
\}   
Set(\$body, "trait:strength", \$strength);  
   
\$speed1 = 4 + random(3);   
\$speed2 = 4 + random(3);   
if(\$speed1 \> \$speed2) \{   
    \$speed = \$speed1;   
\} else \{   
    \$speed = \$speed2;   
\}   
Set(\$body, "trait:speed", \$speed);  
   
\$resilience1 = 4 + random(3);   
\$resilience2 = 4 + random(3);   
if(\$resilience1 \> \$resilience2) \{   
    \$resilience = \$resilience1;   
\} else \{   
    \$resilience = \$resilience2;   
\}   
Set(\$body, "trait:resilience", \$resilience);  
   
\$perception1 = 4 + random(3);   
\$perception2 = 4 + random(3);   
if(\$perception1 \> \$perception2) \{   
    \$perception = \$perception1;   
\} else \{   
    \$perception = \$perception2;   
\}   
Set(\$body, "trait:perception", \$perception);  
   
\$charisma1 = 4 + random(3);   
\$charisma2 = 4 + random(3);   
if(\$charisma1 \> \$charisma2) \{   
    \$charisma = \$charisma1;   
\} else \{   
    \$charisma = \$charisma2;   
\}   
Set(\$body, "trait:charisma", \$charisma);  
   
\$intelligence1 = 4 + random(3);   
\$intelligence2 = 4 + random(3);   
if(\$intelligence1 \> \$intelligence2) \{   
    \$intelligence = \$intelligence1;   
\} else \{   
    \$intelligence = \$intelligence2;   
\}   
Set(\$body, "trait:intelligence", \$intelligence);  
   
/* Highest attribute 10-12 */                             
\$temp_attr1_bonus1 = GetVar(\$body."temp:attr1") + 4 + random(3);   
\$temp_attr1_bonus2 = GetVar(\$body."temp:attr1") + 4 + random(3);   
if(\$temp_attr1_bonus1 \> \$temp_attr1_bonus2) \{   
    Set(\$body, "trait:" + \$body."temp:attr1", \$temp_attr1_bonus1);   
\} else \{   
    Set(\$body, "trait:" + \$body."temp:attr1", \$temp_attr1_bonus2);   
\}   
                      
/* 2nd highest attribute 8-10 */                               
\$temp_attr2_bonus1 = GetVar(\$body."temp:attr2") + 2 + random(3);   
\$temp_attr2_bonus2 = GetVar(\$body."temp:attr2") + 2 + random(3);   
if(\$temp_attr2_bonus1 \> \$temp_attr2_bonus2) \{   
    Set(\$body, "trait:" + \$body."temp:attr2", \$temp_attr2_bonus1);   
\} else \{   
    Set(\$body, "trait:" + \$body."temp:attr2", \$temp_attr2_bonus2);   
\}   
   
/* 2nd lowest attribute 3-5 */   
\$temp_attr3_bonus1 = GetVar(\$body."temp:attr3") - random(2);   
\$temp_attr3_bonus2 = GetVar(\$body."temp:attr3") - random(2);   
if(\$temp_attr2_bonus1 \> \$temp_attr2_bonus2) \{   
    Set(\$body, "trait:" + \$body."temp:attr3", \$temp_attr3_bonus1);   
\} else \{   
    Set(\$body, "trait:" + \$body."temp:attr3", \$temp_attr3_bonus2);   
\}   
   
/* Lowest attribute 3-5 */   
\$temp_attr4_bonus1 = GetVar(\$body."temp:attr4") - random(2);   
\$temp_attr4_bonus2 = GetVar(\$body."temp:attr4") - random(2);   
if(\$temp_attr2_bonus1 \> \$temp_attr2_bonus2) \{   
    Set(\$body, "trait:" + \$body."temp:attr4", \$temp_attr4_bonus1);   
\} else \{   
    Set(\$body, "trait:" + \$body."temp:attr4", \$temp_attr4_bonus2);   
\}   
          
/* Set character class and skills */               
\$body."trait:class1" = \$body."chargen:class";   
   
switch(\$body."chargen:class") \{   
    case "one-handed-fighter":   
        Set(\$body, "skill:combat:" + \$body."chargen:weapon", 3);   
        \$body."skill:combat:dodge" = 3;   
        \$body."skill:combat:parry" = 3;   
        break;   
    case "two-handed-fighter":   
        Set(\$body, "skill:combat:" + \$body."chargen:weapon", 3);   
        \$body."skill:combat:dodge" = 3;   
        \$body."skill:combat:parry" = 3;   
        break;   
    case "dual-wielding-fighter":   
        Set(\$body, "skill:combat:" + \$body."chargen:weapon", 3);   
        \$body."skill:combat:dodge" = 3;   
        \$body."skill:combat:parry" = 3;   
        break;   
    case "unarmed-fighter":   
        \$body."skill:combat:unarmed" = 3;   
        \$body."skill:combat:dodge" = 3;   
        \$body."skill:combat:parry" = 3;   
        break;   
    case "ranger":   
        Set(\$body, "skill:combat:" + \$body."chargen:weapon", 3);   
        \$body."skill:hunting:skinning" = 3;   
        \$body."skill:hunting:trapping" = 3;   
        break;   
    case "assassin":   
        \$body."skill:combat:dagger" = 3;   
        \$body."skill:subterfuge:poison" = 3;   
        \$body."skill:subterfuge:sneak" = 3;   
        break;   
    case "spy":   
        \$body."skill:combat:dagger" = 3;   
        \$body."skill:subterfuge:lipread" = 3;   
        \$body."skill:subterfuge:sneak" = 3;   
        break;   
    case "thief":   
        \$body."skill:combat:dagger" = 3;   
        \$body."skill:subterfuge:pickpocket" = 3;   
        \$body."skill:subterfuge:sneak" = 3;   
        break;   
    case "healer":   
        \$body."skill:combat:healing" = 5;   
        \$body."skill:alteration:herbalism" = 5;   
        break;   
    case "socialite":   
        \$body."skill:social:art" = 5;   
        \$body."skill:social:music" = 5;   
        break;   
    case "blacksmith":   
        \$body."skill:alteration:metalworking" = 5;   
        break;   
    case "bookbinder":   
        \$body."skill:alteration:bookbinding" = 5;   
        break;   
    case "carpenter":   
        \$body."skill:alteration:woodworking" = 5;   
        break;   
    case "jeweler":   
        \$body."skill:alteration:jewelcrafting" = 5;   
        break;   
    case "miner":   
        \$body."skill:hunting:miner" = 5;   
        break;   
    case "seamstress":   
        \$body."skill:alteration:tailoring" = 5;   
        break;   
    case "stonemason":   
        \$body."skill:alteration:stonemasonry" = 5;   
        break;   
    case "weaver":   
        \$body."skill:alteration:weaving" = 5;   
        break;   
    case "woodcutter":   
        \$body."skill:hunting:woodcutting" = 5;   
        break;   
    case "dyer":   
        \$body."skill:alteration:dyeing" = 5;   
        break;   
    case "body-servant":   
        \$body."skill:alteration:hairstyling" = 5;   
        \$body."skill:subterfuge:lipread" = 3;   
        \$body."skill:subterfuge:eavesdrop" = 3;   
        break;   
\}            
 
/* Give the player any career props */               
\$itemsarrayMap = Call(this, "grabchoices", \$choice: "startitems", \$gender: \$body."base:genderstring", \$animaltype: \$body."chargen:class");    
           
if(\$body."chargen:weapon") \{   
    \$itemsarray = \$itemsarrayMap[\$body."chargen:weapon"];   
\} else \{   
    \$itemsarray = \$itemsarrayMap["all"];   
\}   
 
/* remove nil items from the array */               
if(\$itemsarray) \$itemsarray -= (\{ nil \});               
               
if(sizeof(\$itemsarray)) \{               
    \$index = random(sizeof(\$itemsarray));               
    \$item = Spawn(\$itemsarray[\$index][0]);               
    /* Set item properties */               
    if(sizeof(\$itemsarray[\$index]) \> 1) \{               
        for(\$i=1;\$i\<sizeof(\$itemsarray[\$index]);\$i++)\{               
            if(sizeof(\$itemsarray[\$index][\$i]) \> 1) \{               
                Set(\$item, \$itemsarray[\$index][\$i][0], \$itemsarray[\$index][\$i][random(sizeof(\$itemsarray[\$index][\$i])-1)+1]);               
            \}               
        \}               
    \}               
    \$item."base:environment" = \$body;               
    \$item."chargen:owner" = Str(\$body."skotos:charname");               
    \$item."chargen:owner:account" = Str(\$body."skotos:creator");               
\}                 
               
/* Give player starting garments */               
\$itemsarrayMap = Call(this, "grabchoices", \$choice: "startclothes", \$gender: \$body."base:genderstring", \$animaltype: \$body."chargen:clothing");          
\$itemsarray = \$itemsarrayMap["only"]; 
      
/* remove nil items from the array */               
\$itemsarray -= (\{ nil \});               
                  
if(sizeof(\$itemsarray)) \{               
    for(\$i = 0; \$i \< sizeof(\$itemsarray); \$i++) \{               
        \$item = Spawn(\$itemsarray[\$i][0]);               
            
        /* Set item properties */               
        if(sizeof(\$itemsarray[\$i]) \> 1) \{               
            for(\$j = 1; \$j \< sizeof(\$itemsarray[\$i]); \$j++)\{               
                if(sizeof(\$itemsarray[\$i][\$j]) \> 1) \{               
                    Set(\$item, \$itemsarray[\$i][\$j][0], \$itemsarray[\$i][\$j][random(sizeof(\$itemsarray[\$i][\$j]) - 1) + 1]);               
                \}               
            \}               
        \}               
        \$item."base:environment" = \$body;               
        \$item."base:worn-by" = \$body;            
        Act(\$body, "wear", \$articles: \$item);                 
        \$item."chargen:owner" = Str(\$body."skotos:charname");               
        \$item."chargen:owner:account" = Str(\$body."skotos:creator");            
    \}            
\}]
\<redirect propob="\$(this)" characterref="\$(body)"/\>
      </Core:Property>
      <Core:Property property="export:xtra:state:start_location">
         X[S]
      </Core:Property>
      <Core:Property property="export:xtra:stylesheet">
         X[S] \<style\>
html \\\{
    height: 100%;
    min-height: 100%;
    padding: 0;
    margin: 0;
    background-image: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/brown-background.png");
    background-size: 100% 100%;
    background-position: center center;
    background-attachment: fixed;
\\\}
body \\\{
    padding: 0;
    margin: 0;
    min-height: 100%;
\\\}
p \\\{
    font-size: 14pt;
    text-align: justify;
\\\}
.form \\\{
    border: 0;
    outline: 0;
    background: transparent;
    border-bottom: 1px solid black;
    text-align: center;
\\\}
.heading \\\{
    display: block;
    position: relative;
    margin: auto;
    width: 100%;
\\\}
#intro \\\{
    width: 200px;
\\\}
#class \\\{
    position: relative;
    display: block;
    width: 400px;
    margin: auto;
\\\}
.logo \\\{
    position: absolute;
    width: 300px;
    display: inline-block;
    margin: auto;
    left: 0;
    right: 0;
    z-index: 1000;
\\\}
.chargen \\\{
    position: relative;
    width: 250px;
    margin: auto;
    display: inline-block;
    padding-left: 5px;
\\\}
.main-wrapper \\\{
    display: flex;
    flex-direction: column;
    flex: 1;
    justify-content: space-between;
    position: absolute;
    top: 0;
    bottom: 0;
    height: 100%;
    min-height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    background-size: 100% 100%;
    background-position: center center;
    background-attachment: fixed;
\\\}
.main \\\{
    min-height: 100%;
    width: 100%;
    padding-top: 120px;
    padding-bottom: 120px;
    padding: 0;
    margin: 0;
\\\}
.content \\\{
    position: relative;
    min-height: 100%;
    padding: 0;
    padding-top: 120px;
    margin: 0;
    background-color: white;
    opacity: 0.75;
    background-size: 100% 100%;
    background-position: center center;
    background-attachment: fixed;
    width: 100%;
\\\}
.header \\\{
    display: block;
    position: fixed;
    width: 100%;
    margin: auto;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/bgtexture.png");
    background-size: contain;
    background-position: center center;
    box-shadow: 10px 10px 20px black;
    z-index: 999;
    border-bottom: 5px solid black;
\\\}
.footer \\\{
    position: fixed;
    display: flex;
    justify-content: space-between;
    bottom: 0;
    height: 50px;
    width: 100%;
    margin: auto;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/bgtexture.png");
    background-size: contain;
    background-position: center center;
    box-shadow: -10px -10px 20px black;
    z-index: 999;
    border-top: 5px solid black;
\\\}
.button \\\{
    display: inline-block;
    width: 100px;
    border: 2px solid black;
    margin: 5px;
    padding: 5px;
    padding-left: 20px;
    padding-right: 20px;
\\\}
.button:hover \\\{
    border: 2px solid red;
\\\}
#restart_btn \\\{
    float: left;
\\\}
#back_btn \\\{
    margin: auto;
    cursor: pointer;
\\\}
#cont_btn \\\{
    visibility: visible;
    float: right;
    cursor: pointer;
\\\}
.classes \\\{
    display: flex;
    flex-flow: row;
    justify-content: center;
    position: relative;
    margin: auto;
    width: 100%;
\\\}
.single-class \\\{
    position: relative;
    display: inline-block;
    margin-left: 20px;
    margin-right: 20px;
    cursor: pointer;
\\\}
#fighter-image \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-fighter-bw.png");
    background-position: center center;
    background-size: 100%;
\\\}
#fighter-image:hover \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-fighter-color.png");
    background-position: center center;
    background-size: 100%;
\\\}
#ranger-image \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-ranger-bw.png");
    background-position: center center;
    background-size: 100%;
\\\}
#ranger-image:hover \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-ranger-color.png");
    background-position: center center;
    background-size: 100%;
\\\}
#rogue-image \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-rogue-bw.png");
    background-position: center center;
    background-size: 100%;
\\\}
#rogue-image:hover \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-rogue-color.png");
    background-position: center center;
    background-size: 100%;
\\\}
#academic-image \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-academic-bw.png");
    background-position: center center;
    background-size: 100%;
\\\}
#academic-image:hover \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-academic-color.png");
    background-position: center center;
    background-size: 100%;
\\\}
#tradesman-image \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-tradesman-bw.png");
    background-position: center center;
    background-size: 100%;
\\\}
#tradesman-image:hover \\\{
    position: relative;
    display: inline-block;
    width: 120px;
    height: 120px;
    background: url("http://wp.skotos.net/ironclaw/wp-content/uploads/sites/2/Allegory/badge-tradesman-color.png");
    background-position: center center;
    background-size: 100%;
\\\}
#fighter-description \\\{
    display: none;
\\\}
#ranger-description \\\{
    display: none;
\\\}
#rogue-description \\\{
    display: none;
\\\}
#academic-description \\\{
    display: none;
\\\}
#tradesman-description \\\{
    display: none;
\\\}
#textarea \\\{
    width: 60%;
    margin: auto;
\\\}
.appearance \\\{
    width: 60%;
    margin: auto;
    padding-top: 20px;
    padding-bottom: 20px;
\\\}
.description \\\{
    width: 60%;
    margin: auto;
    min-height: 300px;
    border-top: 1px solid #c8c8c8;
    margin-top: 20px;
    margin-bottom: 40px;
    padding: 20px;
\\\}
.class-title \\\{
    width: 100%;
\\\}
.class-title-two \\\{
    display: block;
    height: 50px;
\\\}
.subclass-title \\\{
    display: block;
    width: 130px;
\\\}
.title-img \\\{
    display: block;
    width: 120px;
    margin: auto;
\\\}
.subclasses \\\{
    display: flex;
    flex-flow: row;
    flex-wrap: wrap;
    justify-content: space-around;
    position: relative;
    margin: auto;
    width: 100%;
\\\}
.single-subclass \\\{
    position: relative;
    display: inline-block;
    margin: 10px;
    width: 350px;
    height: 350px;
    border: 1px solid #5e5e5e;
    background: #e0e0e0;
\\\}
.subclass-header \\\{
    position: relative;
    display: block;
    width: 100%;
    background: #5e5e5e;
    font-weight: bolder;
    color: white;
\\\}
.subclass-heading \\\{
    font-size: 20px;
    width: 100%;
    padding: 5px;
\\\}
.subclass-content \\\{
    position: relative;
    display: inline-block;
    width: 100%;
    padding: 5px;
\\\}
/* Styling Checkbox Starts */
.checkbox-container \\\{
    position: absolute;
    bottom: 0px;
    margin: auto;
    background: #5e5e5e;
    font-color: white;
    width: 100%;
    padding-top: 10px;
    padding-bottom: 10px;
\\\}
.checkbox-label \\\{
    display: block;
    position: relative;
    margin: auto;
    cursor: pointer;
    font-size: 22px;
    line-height: 24px;
    height: 24px;
    width: 24px;
    clear: both;
\\\}
.checkbox-label input \\\{
    position: absolute;
    bottom: 0;
    left: 0;
    opacity: 0;
    cursor: pointer;
\\\}
.checkbox-label .checkbox-custom \\\{
    position: absolute;
    bottom: 0px;
    left: 0px;
    height: 24px;
    width: 24px;
    background-color: white;
    border-radius: 5px;
    transition: all 0.3s ease-out;
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -ms-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    border: 2px solid black;
\\\}
.checkbox-label input:checked ~ .checkbox-custom \\\{
    background-color: #FFFFFF;
    border-radius: 5px;
    -webkit-transform: rotate(0deg) scale(1);
    -ms-transform: rotate(0deg) scale(1);
    transform: rotate(0deg) scale(1);
    opacity:1;
    border: 2px solid black;
\\\}
.checkbox-label .checkbox-custom::after \\\{
    position: absolute;
    content: "";
    left: 12px;
    bottom: 12px;
    height: 0px;
    width: 0px;
    border-radius: 5px;
    border: solid black;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(0deg) scale(0);
    -ms-transform: rotate(0deg) scale(0);
    transform: rotate(0deg) scale(0);
    opacity:1;
    transition: all 0.3s ease-out;
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -ms-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
\\\}
.checkbox-label input:checked ~ .checkbox-custom::after \\\{
  -webkit-transform: rotate(45deg) scale(1);
  -ms-transform: rotate(45deg) scale(1);
  transform: rotate(45deg) scale(1);
  opacity:1;
  left: 8px;
  top: 3px;
  width: 6px;
  height: 12px;
  border: solid #009BFF;
  border-width: 0 2px 2px 0;
  background-color: white;
  border-radius: 0;
\\\}
/* For Ripple Effect */
.checkbox-label .checkbox-custom::before \\\{
    position: absolute;
    content: "";
    left: 10px;
    top: 10px;
    width: 0px;
    height: 0px;
    border-radius: 5px;
    border: 2px solid black;
    -webkit-transform: scale(0);
    -ms-transform: scale(0);
    transform: scale(0);
    z-index: 999;
\\\}
.checkbox-label input:checked ~ .checkbox-custom::before \\\{
    left: -3px;
    top: -3px;
    width: 24px;
    height: 24px;
    border-radius: 5px;
    -webkit-transform: scale(3);
    -ms-transform: scale(3);
    transform: scale(3);
    opacity:0;
    z-index: 999;
    transition: all 0.3s ease-out;
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -ms-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
\\\}
/* Style for Circular Checkbox */
.checkbox-label .checkbox-custom.circular \\\{
    border-radius: 50%;
    border: 2px solid black;
\\\}
.checkbox-label input:checked ~ .checkbox-custom.circular \\\{
    background-color: white;
    border-radius: 50%;
    border: 2px solid black;
\\\}
.checkbox-label input:checked ~ .checkbox-custom.circular::after \\\{
    border: solid #00a651;
    border-width: 0 2px 2px 0;
\\\}
.checkbox-label .checkbox-custom.circular::after \\\{
    border-radius: 50%;
\\\}
.checkbox-label .checkbox-custom.circular::before \\\{
    border-radius: 50%;
    border: 2px solid black;
\\\}
.checkbox-label input:checked ~ .checkbox-custom.circular::before \\\{
    border-radius: 50%;
\\\}
.input-title \\\{
    display: inline-block;
    position: relative;
    font-size: 16px;
    width: 100%;
    margin: auto;
    right: -30px;
    top: 0px;
\\\}
#hidden-btn \\\{
    visibility: hidden;
\\\}
.group \\\{
    width: 100%;
    display: flex;
    justify-content: center;
\\\}
.skill-cell \\\{
    width: 150px;
\\\}
.skill-table \\\{
    width: 200px;
    margin: auto;
\\\}
\</style\>
      </Core:Property>
      <Core:Property property="merry:lib:figurestate">
         X[M] /*    
  ** Now a bunch of code to figure out which state we're in; further    
  ** down the SAM will act on this information to include the right    
  ** sub-page.    
  */    
    
if(!\$body) return nil;    
    
  /* did we fail to show up in any previous stage on this server? */    
  if (\$dat."stage:no-show") \{    
     \$state = "noshow";    
     \$title = "You have been marked as a 'no-show' in some previous stage.";    
     return nil;    
  \}    
    
/* check that this is the first time we're setting the variables for the character */    
if(!Get(\$body, "CharGen:State"))    
\{    
  Set(\$body, "CharGen:State", Get(\$this, "startpage"));    
\}    
    
/* find which page we're at in the character creator */    
\$title = Get(\$this, "title");    
    
\$state = Get(\$body, "CharGen:State");    
    
return nil;
      </Core:Property>
      <Core:Property property="merry:lib:grabchoices">
         X[M] /*
Returns an array of start story choices, after being given a choice type, and possibly gender, animal type and animal breed
*/

if (!\$choice) return (\{\});

\$choicearray = (\{\});

\$accountType = general::getAccountType(\$udat: \$dat);
if(\$dat."testing:account-type") \$accountType = \$dat."testing:account-type";

if(\$animaltype) \{
    if(Get(\$this, "choices:" + \$choice + ":" + \$animaltype)) \{
        return Get(\$this, "choices:" + \$choice + ":" + \$animaltype);
    \}
\}

\$choice = "features:" + \$choice;
if(Get(\$this, "choices:" + \$choice)) \{
    \$free = (\{ \});
    \$standard = (\{ \});
    \$premium = (\{ \});

    if(Get(\$this, "choices:" + \$choice)["free"]) \$free = Get(\$this, "choices:" + \$choice)["free"];
    if(Get(\$this, "choices:" + \$choice)["standard"]) \$standard = Get(\$this, "choices:" + \$choice)["standard"];
    if(Get(\$this, "choices:" + \$choice)["premium"]) \$premium = Get(\$this, "choices:" + \$choice)["premium"];

    \$choicearray = \$free;

    if(\$accountType == "standard") \{
        \$choicearray \|= \$standard;
    \}

    if(\$accountType == "premium") \{
        \$choicearray \|= \$standard;
        \$choicearray \|= \$premium;
    \}

    if(Get(\$this, "choices:" + \$choice)["only"]) \{
        \$choicearray \|= Get(\$this, "choices:" + \$choice)["only"];
    \}

    if(Get(\$this, "choices:" + \$choice)["all"]) \{
        \$choicearray \|= Get(\$this, "choices:" + \$choice)["all"];
    \}

    if(Get(\$this, "choices:" + \$choice)[\$body."base:genderstring"]) \{
        \$choicearray \|= Get(\$this, "choices:" + \$choice)[\$body."base:genderstring"];
    \}
\}

\$choicearray = map_indices( arr_to_set( \$choicearray ));

return \$choicearray;
      </Core:Property>
      <Core:Property property="merry:lib:initialize">
         X[M] /* first basic sanity checks -- these should never happen */   
  if (\$dat == nil) \{   
     error("page reached without a udat");   
  \}   
  if (\$name == nil) \{   
     error("page reached without a name");   
  \}   
   
  if(\$body == nil \&\& \$characterref)   
  \{   
    \$body= Obj( \$characterref );   
  \}   
   
  if(\$body == nil \&\& \$thischaracter != nil)   
  \{   
    \$body = Obj( \$thischaracter[4..strlen(\$thischaracter)-2] );   
  \}   
  
  if (\$body == nil) \{ 
     \$classes = (\{ "one-handed-fighter", "two-handed-fighter", "dual-wielding-fighter", "unarmed-fighter", "ranger", "assassin", "spy", "thief", "healer", "socialite", "blacksmith", "bookbinder", "carpenter", "jeweler", "miner", "seamstress", "stonemason", "weaver", "woodcutter" \});
     \$weapons = ([ "one-handed-fighter":(\{ "axe", "club", "dagger", "sword", "whip" \}), "two-handed-fighter":(\{ "axe", "club", "polearm", "sword" \}), "dual-wielding-fighter":(\{ "axe", "club", "dagger", "sword" \}), "ranger":(\{ "archery", "dagger", "gun", "polearm" \}) ]);

     if(\$charclass) \{
         if(!member(\$charclass, \$classes)) \{
             \$error_class_invalid = 1;
             \$state = "no-body";
         \} else \{
             if(\$weapons[\$charclass]) \{
                 if(!\$weapon \|\| !member(Str(\$weapon), \$weapons[\$charclass])) \{
                     \$error_weapon_invalid = 1;
                     \$state = "no-body";
                 \} else \{
                     \$state = "char-bio";
                 \}
             \} else \{
                 \$state = "char-bio";
             \}
         \}
     \} else \{  
         \$state = "no-body";   
     \}
     \$title = "Allegory of the Empires: Character Creator";   
  \} else \{   
   
/* Check the player isn't trying to access someone elses body */   
/* Check if the players roster of characters */   
\$bodies = Udat::query_bodies_in_roster(\$user: \$name);   
   
for(\$i = 0; \$i \< sizeof(\$bodies);)   
\{   
  if(\$bodies[\$i]."theatre:id" != "IC")   
  \{   
    \$bodies -= (\{ \$bodies[\$i] \});   
  \} else \{   
    \$i++;   
  \}   
\}   
   
\$bodies \&= (\{ \$body \});   
   
if(sizeof(\$bodies) \< 1) \{   
  /* Body could be deleted but still owned by this player */   
  if(\$body.deleted) \{   
    \$count = 0;   
    while(Obj("Chatters:Backup"+\$body."core:objectname"[8..]+Str(\$count))) \$count++;   
    \$body."core:objectname" = "Chatters:Backup"+\$body."core:objectname"[8..]+Str(\$count);   
    error("Something went wrong, but we're fixing it up now! Please refresh this page, and try creating this character again.");   
  \}   
  error("Body not found in character roster");   
\}   
   
\}   
   
/* Need to check that this character is from the right theatre */   
   
/* find the body for this character */   
/*\$body = nil;   
\$bodies = Udat::query_bodies_in_roster(\$user: \$name);   
for(\$i = 0; \$i \< sizeof(\$bodies);)   
\{   
  if(\$bodies[\$i]."theatre:id" != Get(\$this, "theatre"))   
  \{   
    \$bodies -= (\{ \$bodies[\$i] \});   
  \} else \{   
    \$i++;   
  \}   
\}   
   
if (!\$bodies \|\| sizeof(\$bodies) \< 1) \{   
     error("Unknown character");   
\} else \{   
  \$body = \$bodies[0];   
\}   
*/
      </Core:Property>
      <Core:Property property="merry:lib:list-choices">
         X[M] /*    
This function will generate an array which has elements that contain a string, then the property for a character creation choice.    
an input of:    
You have a [noseshape] nose, and [haircolor] hair.    
would be returned as:    
(\{ (\{ "You have a", "noseshape" \}), (\{ "nose, and ", haircolor \}), (\{ "hair." \}) \})    
*/    
/*variables for this function*/    
string Head;    
string Tail;    
string Property;    
string *Properties_arr;    
    
Properties_arr = (\{\});    
if(!\$choices) return Properties_arr;    
\$choices = Str(UnSAM(\$choices));    
    
while(sscanf(\$choices, "%s[submit]%s", Head, Tail) == 2)    
\{    
  \$choices = Head+"\<input id=\\"hidden-btn\\" type=\\"submit\\" value=\\"SUBMIT\\" style='float:right' class=\\"submit-button\\"/\>"+Tail;    
\}    
    
    
while(sscanf(\$choices, "%s[%s]%s", Head, Property, Tail) == 3)    
\{    
  Head = "" + replace_strings(Head, "\\n", "\<sbr/\>");   
  Properties_arr += (\{ (\{ ParseXML(Head), Property \}) \});    
  \$choices = Tail;    
\}    
   
Tail = replace_strings(Tail, "\\n", "\<sbr/\>") + "";   
Properties_arr += (\{ (\{ ParseXML(Tail) \}) \});    
    
return Properties_arr;
      </Core:Property>
      <Core:Property property="revisions">
         (\{ 1565397569, "jominey", "E", 1565402004, "jominey", "E", 1565404816, "jominey", "E", 1565404911, "jominey", "P", 1565405424, "jominey", "E", 1565405602, "jominey", "E", 1565405637, "jominey", "E", 1565405888, "jominey", "E", 1565406230, "jominey", "E", 1565406467, "jominey", "E", 1565406554, "jominey", "E", 1565406648, "jominey", "E", 1565406797, "jominey", "E", 1565406959, "jominey", "E", 1565407036, "jominey", "E", 1565407115, "jominey", "E", 1565407165, "jominey", "E", 1565407315, "jominey", "E", 1565407543, "jominey", "E", 1565407692, "jominey", "E", 1565407707, "jominey", "E", 1565407976, "jominey", "E", 1565446612, "jominey", "E", 1565446658, "jominey", "E", 1565446734, "jominey", "E", 1566078876, "jominey", "R" \})
      </Core:Property>
    </Core:PCProperties>
    <Notes:Notes/>
  </Core:PropertyContainer>
</object>
