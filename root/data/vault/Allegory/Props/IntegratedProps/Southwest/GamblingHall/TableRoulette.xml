<object clone="/base/obj/thing" owner="SkotOS">
  <Base:Thing>
    <Ur:UrObject/>
    <Base:Bulk immobile="false" mass="1" density="1"/>
    <Base:Container flexible="false" transparent-container="false" public-container="false" tight="false" capacity="0" maxweight="0"/>
    <Base:Misc gender="neuter" volition="false" weapon="false" default_stance="none" combinable="false" discrete="false" by_weight="false" tight="false" scriptrunner="false">
      <Base:Edible value="false"/>
      <Base:Potable value="false"/>
      <Base:DrinkMessageFirst/>
      <Base:DrinkMessageThird/>
      <Base:Transparency value="false"/>
      <Base:Unsafe value="false"/>
      <Base:Safe value="false"/>
      <Base:ClothesExpected value="false"/>
      <Base:DieMessageFirst/>
      <Base:DieMessageThird/>
    </Base:Misc>
    <Base:Details>
      <Base:Detail id="default" prime="true" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="true" against="true" under="false" on="true" inside="false" near="true" over="true" behind="true" before="true" beside="true"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="table"/>
            <Base:SName sname="roulette"/>
            <Base:SName sname="game"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="games"/>
            <Base:PName pname="roulettes"/>
            <Base:PName pname="tables"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="mahogany"/>
          <Base:Adjective adjective="roulette"/>
        </Base:Adjectives>
        <Base:Descriptions>
          <Base:Description type="brief">
             $(this.trait:material) roulette table
          </Base:Description>
          <Base:Description type="examine">
             A $(this.trait:material) roulette table standing near the eastern wall. On one end of the table, there lies a red and black roulette wheel. The remaining surface of the table is covered with bright green felt. A rectangular grid divided into smaller black and red squares has been painted onto the felt, each square indicating a different bet. A brass plaque has been affixed to the front of the table.
          </Base:Description>
          <Base:Description type="look">
             A $(this.trait:material) roulette table standing near the eastern wall. A brass plaque has been affixed to the front of the table.
          </Base:Description>
        </Base:Descriptions>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="ball" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="ball"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="balls"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="ball"/>
          <Base:Adjective adjective="roulette"/>
          <Base:Adjective adjective="silver"/>
        </Base:Adjectives>
        <Base:Descriptions>
          <Base:Description type="brief">
             silver ball in the roulette wheel
          </Base:Description>
          <Base:Description type="examine">
             The silver ball in the roulette wheel. When the wheel is spun, the ball bounces around the perimeter of the wheel until it eventually loses its momentum and falls into a colored and numbered pocket.
          </Base:Description>
          <Base:Description type="look">
             The silver ball in the roulette wheel.
          </Base:Description>
        </Base:Descriptions>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="plaque" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="true" against="false" under="true" on="false" inside="false" near="true" over="true" behind="false" before="false" beside="true"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="plaque"/>
            <Base:SName sname="sign"/>
            <Base:SName sname="rule"/>
            <Base:SName sname="rules"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="plaques"/>
            <Base:PName pname="signs"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="brass"/>
          <Base:Adjective adjective="roulette"/>
        </Base:Adjectives>
        <Base:Descriptions>
          <Base:Description type="brief">
             brass plaque affixed to the front of the roulette table
          </Base:Description>
          <Base:Description type="examine">
             A brass plaque affixed to the front of the blackjack table dictating the rules for the game:<br></br> <br></br> * There are three betting options at this table: red or black, evens or odds, and by number.<br></br> * To begin, the player makes a bet. The dealer then spins the wheel.<br></br> * Once the wheel finishes spinning, the silver ball will fall into a pocket.<br></br> * If the player's bet matches this pocket, the player wins.<br></br> * If the player's bet does not match this pocket, the player loses.
          </Base:Description>
          <Base:Description type="look">
             A brass plaque affixed to the front of the roulette table dictating the rules for the game.
          </Base:Description>
        </Base:Descriptions>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="wheel" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="true" against="false" under="false" on="false" inside="false" near="true" over="false" behind="true" before="true" beside="true"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="wheel"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="wheels"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="roulette"/>
        </Base:Adjectives>
        <Base:Descriptions>
          <Base:Description type="brief">
             roulette wheel
          </Base:Description>
          <Base:Description type="examine">
             A roulette wheel is comprised of a series of thirty-eight pockets. The color of the pockets alternates between black and red so that no two adjacent pockets are the same color. Each pocket bears a number between one and thirty-eight. Outside of the circle of pockets is a smooth track which a small silver ball rolls around when the wheel is spun.
          </Base:Description>
          <Base:Description type="look">
             A roulette wheel divided into a series of alternating black and red pockets, each one bearing a number.
          </Base:Description>
        </Base:Descriptions>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
    </Base:Details>
    <Base:Combat>
      <Base:Strength value="1"/>
      <Base:MaxFatigue value="1"/>
    </Base:Combat>
    <Base:Clothing>
      <Base:SingleWear value="false"/>
    </Base:Clothing>
    <Base:Crafting see_level="0" do_level="0" time="0" attention="false" held="false">
      <Base:Ingredients/>
      <Base:Tools/>
      <Base:CraftVerbs/>
    </Base:Crafting>
    <Base:InitialContents/>
    <Base:InitialProperties/>
    <Core:Properties>
      <Core:Property property="export:html:table">
         X[S] \<z dat="\$(UDat.Dat)" name="\$(UDat.Name)"\>
\$[/* run some initial code */              
   ::popup_initialize();]
\<html lang="en"\>
\<head\>
  \<style type="text/css" media="all"\>
    \\\<!--
    body \\\{
        background-image: url("http://cache1.asset-cache.net/xc/467583755.jpg?v=2\\\&c=IWSAsset\\\&k=2\\\&d=6U2KS36hGB5Bik2KezP-xV2s58obutFiFhTg3BBMCf41");
    \\\}
    table \\\{
        align: center;
    \\\}
    .errors \\\{
        font-weight: bold;
        color: red;
    \\\}
    .game \\\{
        border: 1px solid white;
        text-align: center;
        color: white;
        font-weight: bold;
        font-size: 25;
        opacity: 0.8;
        filter: alpha(opacity=80); /* For IE8 and earlier */
    \\\}
    .rotate \\\{
        /* Safari */
        -webkit-transform: rotate(-90deg);
        /* Firefox */
        -moz-transform: rotate(-90deg);
        /* IE */
        -ms-transform: rotate(-90deg);
        /* Opera */
        -o-transform: rotate(-90deg);
        /* Internet Explorer */
        filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
        height:40px;
        width:40px;
    \\\}
    --\\\>
  \</style\>
\</head\>
\<body\>
  \{? \| \$(error) \| \$(error) \|\}
  \<center\>
   \<table style="text-align:center" align="center"\>
     \<tr\>
       \<td\>\<b\>\<u\>Rules:\</u\>\</b\>\</td\>
     \</tr\>
     \<tr\>
       \<td\>\<b\>Players must place a bet of at least 4 florins (and no more than 48 florins) on one of the squares.\</b\>\</td\>
     \</tr\>
     \<tr\>
       \<td\>\<b\>Once all the bets are placed, give the wheel a spin. Refer to payout chart for possible winnings.\</b\>\</td\>
     \</tr\>
     \<tr\>
       \<td\>\<b\>A result of 0 means the house wins and all betters lose.\</b\>\</td\>
     \</tr\>
   \</table\>
   \</center\>
   \<table align="center"\>
    \<tr\>
      \<td class="game" style="text-align:center" rowspan="3" id="0"\>\<div class="rotate"\>0\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 3"\>\<div class="rotate"\>3\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 6"\>\<div class="rotate"\>6\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 9"\>\<div class="rotate"\>9\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 12"\>\<div class="rotate"\>12\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 15"\>\<div class="rotate"\>15\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 18"\>\<div class="rotate"\>18\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 21"\>\<div class="rotate"\>21\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 24"\>\<div class="rotate"\>24\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 27"\>\<div class="rotate"\>27\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 30"\>\<div class="rotate"\>30\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 33"\>\<div class="rotate"\>33\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 36"\>\<div class="rotate"\>36\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" id="the first row of numbers"\>\<div class="rotate"\>\<font size="2"\>1st Row\</font\>\</div\>\</td\>
    \</tr\>
    \<tr\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 2"\>\<div class="rotate"\>2\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 5"\>\<div class="rotate"\>5\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 8"\>\<div class="rotate"\>8\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 11"\>\<div class="rotate"\>11\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 14"\>\<div class="rotate"\>14\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 17"\>\<div class="rotate"\>17\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 20"\>\<div class="rotate"\>20\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 23"\>\<div class="rotate"\>23\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 26"\>\<div class="rotate"\>26\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 29"\>\<div class="rotate"\>29\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 32"\>\<div class="rotate"\>32\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 35"\>\<div class="rotate"\>35\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" id="the second row of numbers"\>\<div class="rotate"\>\<font size="2"\>2nd Row\</font\>\</div\>\</td\>
    \</tr\>
    \<tr\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 1"\>\<div class="rotate"\>1\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 4"\>\<div class="rotate"\>4\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 7"\>\<div class="rotate"\>7\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 10"\>\<div class="rotate"\>10\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 13"\>\<div class="rotate"\>13\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 16"\>\<div class="rotate"\>16\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 19"\>\<div class="rotate"\>19\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 22"\>\<div class="rotate"\>22\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 25"\>\<div class="rotate"\>25\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 28"\>\<div class="rotate"\>28\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: black" id="the number 31"\>\<div class="rotate"\>31\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" style="background-color: red" id="the number 34"\>\<div class="rotate"\>34\</div\>\</td\>
      \<td class="game" onclick="document.getElementById('bet').value = this.id" id="the third row of numbers" width="40px"\>\<div class="rotate"\>\<font size="2"\>3rd Row\</font\>\</div\>\</td\>
    \</tr\>
      \<td\>\</td\>
      \<td class="game" colspan="4" onclick="document.getElementById('bet').value = this.id" id="the first dozen numbers"\>1st 12\</td\>
      \<td class="game" colspan="4" onclick="document.getElementById('bet').value = this.id" id="the second dozen numbers"\>2nd 12\</td\>
      \<td class="game" colspan="4" onclick="document.getElementById('bet').value = this.id" id="the third dozen numbers"\>3rd 12\</td\>
      \<td\>\</td\>
    \<tr\>
      \<td\>\</td\>
      \<td class="game" colspan="2" onclick="document.getElementById('bet').value = this.id" id="low numbers"\>1 to 18\</td\>
      \<td class="game" colspan="2" onclick="document.getElementById('bet').value = this.id" id="even numbers"\>EVEN\</td\>
      \<td class="game" colspan="2" onclick="document.getElementById('bet').value = this.id" style="color:red" id="red numbers"\>RED\</td\>
      \<td class="game" colspan="2" onclick="document.getElementById('bet').value = this.id" style="color:black" id="black numbers"\>BLACK\</td\>
      \<td class="game" colspan="2" onclick="document.getElementById('bet').value = this.id" id="odd numbers"\>ODD\</td\>
      \<td class="game" colspan="2" onclick="document.getElementById('bet').value = this.id" id="high numbers"\>19 to 36\</td\>
      \<td\>\</td\>
    \</tr\>
    \<tr\>
    \</tr\>
   \</table\>
   \<br/\>
   \<hr/\>
   \<div style="background-color: white;"\>
     \<font color="red"\>\<b\>\$[::show_current_bets()]\</b\>\</font\>\<br/\>
     \<zform\>
       \<input type="hidden" name="actor" value="\$(actor)"/\>
       \<input type="hidden" name="id" value="\$(id)"/\>
       \<center\>\<b\>I want to bet \<input type="text" name="amount" id="amount" value="10"/\> florins on \<input type="text" name="bet" id="bet" value="even numbers" style="width:200px"/\>\</b\>\<input type="submit" value="Place Bet"/\>\</center\>
       \<action\>
           \$["";         
              \$actor = Obj(replace_strings(\$actor, "OBJ(", "", ")", ""));         
              \$error = ::validate_bet(\$amount: \$amount, \$bet: \$bet);]
           \<redirect propob="\$(this)" prop="table" actor="\$(actor)" id="\$(id)" error="\$(error)"/\>
       \</action\>
     \</zform\>
     \<br/\>
   \</div\>
   \<hr/\>
   \<center\>
   \<table\>
    \<tr\>\<td class="game" bgcolor="black" colspan="6"\>\<font size="2"\>Payouts\</font\>\</td\>\</tr\>
    \<tr\>
     \<td class="game"\>\<font size="2"\>Individual Numbers\</font\>\</td\>\<td class="game" bgcolor=""\>\<font size="2"\>35:1\</font\>\</td\>
     \<td class="game"\>\<font size="2"\>Rows\</font\>\</td\>\<td class="game" bgcolor=""\>\<font size="2"\>2:1\</font\>\</td\>
     \<td class="game"\>\<font size="2"\>Dozens\</font\>\</td\>\<td class="game" bgcolor=""\>\<font size="2"\>2:1\</font\>\</td\>
    \</tr\>
    \<tr\>
     \<td class="game"\>\<font size="2"\>Low or High\</font\>\</td\>\<td class="game" bgcolor=""\>\<font size="2"\>1:1\</font\>\</td\>
     \<td class="game"\>\<font size="2"\>Red or Black\</font\>\</td\>\<td class="game" bgcolor=""\>\<font size="2"\>1:1\</font\>\</td\>
     \<td class="game"\>\<font size="2"\>Even or Odd\</font\>\</td\>\<td class="game" bgcolor=""\>\<font size="2"\>1:1\</font\>\</td\>
    \</tr\>
   \</table\>
   \</center\>
\</body\>
\</html\>
\</z\>
      </Core:Property>
      <Core:Property property="export:trait:material">
         "mahogany"
      </Core:Property>
      <Core:Property property="merry:lib:make_payouts">
         X[M] \$winner = Int(\$winner); 
 
\$allBets = ([ ]); 
if(\$this.bets) \$allBets = \$this.bets; 
\$betters = map_indices(\$allBets); 
 
\$numStr = "the number " + Str(\$winner); 
 
\$firstRow = (\{ 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36 \}); 
\$secondRow = (\{ 2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32, 34 \}); 
\$thirdRow = (\{ 1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 33 \}); 
if(member(\$winner, \$firstRow)) \{ 
    \$rowStr = "the first row of numbers"; 
\} else if(member(\$winner, \$secondRow)) \{ 
    \$rowStr = "the second row of numbers"; 
\} else \{ 
    \$rowStr = "the third row of numbers"; 
\} 
 
\$firstDozen = (\{ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 \}); 
\$secondDozen = (\{ 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24 \}); 
\$thirdDozen = (\{ 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36 \}); 
if(member(\$winner, \$firstDozen)) \{ 
    \$dozenStr = "the first dozen numbers"; 
\} else if(member(\$winner, \$secondDozen)) \{ 
    \$dozenStr = "the second dozen numbers"; 
\} else \{ 
    \$dozenStr = "the third dozen numbers"; 
\} 
 
\$low = (\{ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18 \}); 
\$high = (\{ 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36 \}); 
if(member(\$winner, \$low)) \{ 
    \$lowHighStr = "low numbers"; 
\} else \{ 
    \$lowHighStr = "high  numbers"; 
\} 
 
\$even = (\{ 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36 \}); 
\$odd = (\{ 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35 \}); 
if(member(\$winner, \$even)) \{ 
    \$evenOddStr = "even numbers"; 
\} else \{ 
    \$evenOddStr = "odd numbers"; 
\} 
 
\$red = (\{ 3, 9, 12, 18, 21, 27, 30, 36, 5, 14, 23, 32, 1, 7, 10, 16, 19, 25, 28, 34 \});  
if(member(\$winner, \$red)) \{ 
    \$redBlackStr = "red numbers"; 
\} else \{ 
    \$redBlackStr = "black numbers"; 
\} 
 
for(\$i = 0; \$i \< sizeof(\$betters); \$i++) \{ 
  \$bets = \$allBets[\$betters[\$i]]; 
 
  if(\$winner != 0) \{ 
    \$payout = 0; 
    if(\$bets[\$numStr]) \{ 
        /* They chose the winning number! */ 
        \$payout += Int(\$bets[\$numStr]) * 36 * 100; 
    \} 
 
    if(\$bets[\$rowStr]) \{ 
        \$payout += Int(\$bets[\$rowStr]) * 3 * 100; 
    \} 
 
    if(\$bets[\$dozenStr]) \{ 
        \$payout += Int(\$bets[\$dozenStr]) * 3 * 100; 
    \}  
 
    if(\$bets[\$lowHighStr]) \{ 
        \$payout += Int(\$bets[\$lowHighStr]) * 2 * 100; 
    \} 
 
    if(\$bets[\$evenOddStr]) \{ 
        \$payout += Int(\$bets[\$evenOddStr]) * 2 * 100; 
    \} 
 
    if(\$bets[\$redBlackStr]) \{ 
        \$payout += Int(\$bets[\$redBlackStr]) * 2 * 100; 
    \} 
 
    if(\$payout \> 0) \{ 
        EmitTo(\$betters[\$i], "You win " + Str(\$payout/100) + " florins!"); 
        \$betters[\$i]."trait:money" += Int(\$payout); 
        EmitIn(\$this."base:environment", Describe(\$betters[\$i]) + " wins " + Str(\$payout/100) + " florins!", \$betters[\$i]); 
 
        if(!\$this."betting:history:payouts") \$this."betting:history:payouts" = ([ ]); 
 
        if(\$this."betting:history:payouts"[\$betters[\$i]]) \{  
            \$this."betting:history:payouts"[\$betters[\$i]] += Int(\$payout/100); 
        \} else \{ 
            \$this."betting:history:payouts" += ([ \$betters[\$i]:Int(\$payout/100) ]); 
        \} 
 
        \$this."bet:payouts" = Int(\$this."bet:payouts") + Int(\$payout/100); 
    \} else \{ 
        EmitTo(\$betters[\$i], "You lose."); 
        EmitIn(\$this."base:environment", Describe(\$betters[\$i]) + " loses.", \$betters[\$i]); 
    \} 
  \} 
  \$betters[\$i]."roulette:bets:total" = nil; 
 
\} 
 
if(\$winner == 0) \{ 
    EmitIn(\$this."base:environment", "House wins."); 
\} 
 
\$this.bets = nil; 
     
return TRUE;
      </Core:Property>
      <Core:Property property="merry:lib:popup_initialize">
         X[M] /* checks the player isn't trying anything funny, and that we have all the information we need */ 
/* returns the page we should look up */ 
object *bodies; 
int i, sz; 
 
/* first basic sanity checks -- these should never happen */ 
if (\$dat == nil) \{ 
    error("page reached without a udat"); 
\} 
if (\$name == nil) \{ 
    error("page reached without a name"); 
\} 
 
/* what is the character? */ 
if(\$actor \&\& typeof(\$actor) == 3) \{ 
    /* \$actor is a string. make it an object */ 
    if(Obj(\$actor)) \{ 
        \$actor = Obj(\$actor); 
    \} else \{ 
        \$actor = Obj("Chatters:IC:"+\$actor[0..1]+":"+\$actor); 
    \} 
\} 
 
if(\$char \&\& typeof(\$char) == 3) \{ 
    /* \$char is a string. make it an object */ 
    if(Obj(\$char)) \{ 
        \$char = Obj(\$char); 
    \} else \{ 
        \$char = Obj("Chatters:IC:"+\$char[0..1]+":"+\$char); 
    \} 
\} 
 
if(!\$char \&\& \$actor) \$char = \$actor; 
if(!\$actor \&\& \$char) \$actor = \$char; 
if (!\$char) error("No character specified"); 
 
\$charname = name(\$char)[15..strlen(name(\$char))-1]; 
 
/* Check the player isn't trying to access someone elses body */ 
/* Check if the players roster of characters */ 
bodies = Udat::query_bodies_in_roster(\$user: \$name); 
 
for(i = 0; i \< sizeof(bodies);) \{ 
    if(bodies[i]."theatre:id" != "IC") \{ 
        bodies -= (\{ \$bodies[i] \}); 
    \} else \{ 
        i++; 
    \} 
\} 
 
bodies \&= (\{ \$char \}); 
 
if(sizeof(bodies) \< 1 \&\& (\$name != "tonyd")) \{ 
  error("Body not found in character roster"); 
\} 
 
if(!\$id \|\| Int(\$id) != \$actor."roulette:id") \{ 
  error("Invalid token. Examine the table again to generate a new one."); 
\} 
 
return TRUE;
      </Core:Property>
      <Core:Property property="merry:lib:show_current_bets">
         X[M] \$bets = \$this.bets; 
if(!\$bets) return nil; 
 
\$str = "\<table\>"; 
if(!\$bets[\$actor]) \{ 
    \$str += "\<tr\>\<td\>You have not placed any bets yet.\</td\>\</tr\>"; 
\} else \{ 
    \$str += "\<tr\>\<td\>You have placed the following bets:\</td\>\</tr\>"; 
    \$allBets = map_indices(\$bets[\$actor]); 
     
    for(\$i = 0; \$i \< sizeof(\$allBets); \$i++) \{ 
        \$str += "\<tr\>\<td\>*" + Int(\$bets[\$actor][\$allBets[\$i]]) + " florins on " + Str(\$allBets[\$i]) + ".\</td\>\</tr\>"; 
    \} 
\} 
\$str += "\</table\>"; 
 
return ParseXML(\$str);
      </Core:Property>
      <Core:Property property="merry:lib:validate_bet">
         X[M] \$str = "\<table class='errors'\>"; 
\$amount = replace_strings(\$amount, "a", "", "b", "", "c", "", "d", "", "e", "", "f", "", "g", "", "h", "", "i", "", "j", "", "k", "", "l", "", "m", "", "n", "", "o", "", "p", "", "q", "", "r", "", "s", "", "t", "", "u", "", "v", "", "w", "", "x", "", "y", "", "z", ""); 
if(!Int(\$amount) \|\| Int(\$amount) \< 4 \|\| Int(\$amount) \> 48) \{ 
    \$str += "\<tr\>\<td\>Not a valid bet amount. Bets must be at least 4 florins and cannot exceed 48 florins.\</td\>\</tr\>"; 
\} 
 
\$balance = \$actor."trait:money"; 
if(\$balance \< (Int(\$amount)*100)) \{ 
    \$str += "\<tr\>\<td\>You can't afford to place a bet of that amount.\</td\>\</tr\>"; 
\} 
 
\$betTotals = Int(\$actor."roulette:bets:total"); 
if((Int(\$amount) + \$betTotals) \> 48) \{ 
    \$str += "\<tr\>\<td\>You cannot bet more than 48 florins total. You currently have " + Str(\$betTotals) + " florins worth of bets.\</td\>\</tr\>"; 
\} 
 
\$valid_bets = (\{ "the number 1", "the number 2", "the number 3", "the number 4", "the number 5", "the number 6", "the number 7", "the number 8", "the number 9", "the number 10", "the number 11", "the number 12", "the number 13", "the number 14", "the number 15", "the number 16", "the number 17", "the number 18", "the number 19", "the number 20", "the number 21", "the number 22", "the number 23", "the number 24", "the number 25", "the number 26", "the number 27", "the number 28", "the number 29", "the number 30", "the number 31", "the number 32", "the number 33", "the number 34", "the number 35", "the number 36", "the first row of numbers", "the second row of numbers", "the third row of numbers", "the first dozen numbers", "the second dozen numbers", "the third dozen numbers", "low numbers", "high numbers", "even numbers", "odd numbers", "red numbers", "black numbers" \}); 
 
if(!member(\$bet, \$valid_bets)) \{ 
    \$str += "\<tr\>\<td\>Not a valid bet. Try again. [OOC: Click on one of the boxes if you aren't sure what to do!]\</td\>\</tr\>"; 
\} 
 
if(\$str == "\<table class='errors'\>") \{ 
    /* A valid bet was placed. Make note of it. */ 
 
    if(!\$this.bets) \$this.bets = ([ ]); 
 
    /* Have we already placed a bet? */ 
    if(\$this.bets[\$actor]) \{ 
        /* Have we already placed a bet of this type? */ 
        if(\$this.bets[\$actor][\$bet]) \{ 
            \$this.bets[\$actor][\$bet] = Int(\$this.bets[\$actor][\$bet]) + Int(\$amount); 
        \} else \{ 
            \$this.bets[\$actor][\$bet] = \$amount; 
        \} 
    \} else \{ 
        \$this.bets[\$actor] = ([ \$bet:\$amount ]); 
    \} 
 
    \$actor."trait:money" -= Int(\$amount)*100; 
    \$actor."roulette:bets:total" = Int(\$actor."roulette:bets:total") + Int(\$amount); 
 
    \$this."bet:payins" = Int(\$this."bet:payins") + Int(\$amount); 
 
    if(!\$this."betting:history:payins") \$this."betting:history:payins" = ([ ]); 
 
    if(\$this."betting:history:payins"[\$actor]) \{  
        \$this."betting:history:payins"[\$actor] += Int(\$amount); 
    \} else \{ 
        \$this."betting:history:payins" += ([ \$actor:Int(\$amount) ]); 
    \} 
 
    EmitIn(\$actor."base:environment", TAG(Describe(\$actor) + " places " + Str(\$amount) + " florins on " + Str(\$bet) + ".", "social:third"), \$actor); 
    EmitTo(\$actor, TAG("You place " + Str(\$amount) + " florins on " + Str(\$bet) + ".", "social:first")); 
 
    return nil; 
\} 
 
\$str += "\</table\>"; 
return UnSAM(ParseXML(\$str));
      </Core:Property>
      <Core:Property property="merry:react-post:bet-iob">
         X[M] EmitTo(\$actor, "You place a bet on the roulette.");  
  EmitIn(\$actor."base:environment", Describe(\$actor)+" places a bet on the spinning wheel.", \$actor);     
     
return TRUE;
      </Core:Property>
      <Core:Property property="merry:react:play-dob">
         X[M] /* Create ID so player can't cheat */ 
\$id = random(9999999); 
\$actor."roulette:id" = \$id; 
 
Popup(\$actor, \$this, "html:table", \$actor: \$actor, \$id: \$id);  
     
return TRUE;
      </Core:Property>
      <Core:Property property="merry:react:spin-dob">
         X[M] EmitIn(\$actor."base:environment", "The wheel spins. Woo!");     
\$delay(3, TRUE, "32e4");     
EmitIn(\$actor."base:environment", "Still spinning...");     
\$delay(3, TRUE, "0179");     
EmitIn(\$actor."base:environment", "Slowing down...");     
\$delay(3, TRUE, "87fc");     
EmitIn(\$actor."base:environment", "The suspense is painful...");     
\$delay(3, TRUE, "3683");     
\$winner = Str(random(37)); 


EmitIn(\$actor."base:environment", "The wheel comes to a stop on the number " + Str(\$winner) + "."); 
 
::make_payouts(\$winner: \$winner); 
     
return TRUE;
      </Core:Property>
      <Core:Property property="revisions">
         (\{ 1550116095, "jominey", "E", 1550781136, "jominey", "E", 1550781163, "jominey", "E", 1572478153, "sendnoodlez", "R", 1572487276, "sendnoodlez", "K", 1572487279, "sendnoodlez", "E", 1572487281, "sendnoodlez", "E", 1572487282, "sendnoodlez", "E", 1572487284, "sendnoodlez", "E", 1572835898, "jominey", "E", 1572835909, "jominey", "E", 1572836032, "jominey", "E", 1572836041, "jominey", "E", 1572892289, "jominey", "E", 1587175377, "sendnoodlez", "K", 1587175397, "sendnoodlez", "X", 1600652404, "jominey", "E", 1600652423, "jominey", "E", 1600998901, "jominey", "E", 1600999031, "jominey", "E" \})
      </Core:Property>
      <Core:Property property="skill:fatigue">1.0</Core:Property>
    </Core:Properties>
    <Notes:Notes/>
  </Base:Thing>
</object>
