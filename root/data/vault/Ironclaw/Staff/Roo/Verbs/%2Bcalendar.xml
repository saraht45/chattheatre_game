<object clone="/usr/SkotOS/obj/verb" owner="jominey">
  <Socials:Verb imp="+calendar" evoke="optional" audible="false" private="true" secret="false" obscured="false" target-abstracts="false" disabled="false" ooc="true" raw_verb="false">
    <Ur:UrObject/>
    <Socials:SocialObjects/>
    <Socials:VerbActions/>
    <Core:Properties>
      <Core:Property property="html:edit">
         X[S] \<html\>
\$["";      
  if(!\$month) \{ \$month = ""; \}      
  if(!\$day) \{ \$day = ""; \}      
  if(!\$year) \{ \$year = ""; \}      
  if(!\$title) \{ \$title = ""; \}      
  if(!\$description) \{ \$description = ""; \}      
  if(!\$hours) \{ \$hours = ""; \}      
  if(!\$minutes) \{ \$minutes = ""; \}      
  if(!\$location) \{ \$location = ""; \}      
  if(!\$type) \{ \$type1 = "Adding"; \} else \{ \$type1 = \$type; \}]
\$["";  
    \$eventDB = \$\{Ironclaw:Data:Events\};  
  
    \$access = (\{ \});  
    if(\$eventDB.access) \{  
        \$access = \$eventDB.access;  
    \}  
  
    if(!\$actor \|\| \$actor == "" \|\| !Obj(\$actor) \|\| !member(Obj(\$actor), \$access)) \{ error("You are not authorized to view this page."); \}]
\<body background="http://www.skotos.net/IronclawGame/images/skin/parch-d2.jpg"\>
\$[ParseXML("\<zact\>\&lt;\&lt; Go back\<action\>\$[\\"\\";]\<redirect propob=\\"\$(this)\\" prop=\\"showevents\\" actor=\\"" + Str(\$actor) + "\\" day=\\"" + Str(\$day) + "\\" month=\\"" + Str(\$month) + "\\" year=\\"" + Str(\$year) + "\\" icoday1=\\"" + Str(\$icoday1) + "\\" icoday2=\\"" + Str(\$icoday2) + "\\" weekday=\\"" + Str(\$weekday) + "\\" dayselector=\\"" + Str(\$dayselector) + "\\" input=\\"" + Str(\$input) + "\\"/\>\</action\>\</zact\>")]
\<zform\>
  \<input type="hidden" name="actor" value="\$(actor)"/\>
  \<input type="hidden" name="month" value="\$(month)"/\>
  \<input type="hidden" name="day" value="\$(day)"/\>
  \<input type="hidden" name="year" value="\$(year)"/\>
  \<input type="hidden" name="title" value="\$(title)"/\>
  \<input type="hidden" name="description" value="\$(description)"/\>
  \<input type="hidden" name="hours" value="\$(hours)"/\>
  \<input type="hidden" name="oldhours" value="\$(hours)"/\>
  \<input type="hidden" name="minutes" value="\$(minutes)"/\>
  \<input type="hidden" name="oldminutes" value="\$(minutes)"/\>
  \<input type="hidden" name="location" value="\$(location)"/\>
  \<input type="hidden" name="type1" value="\$(type1)"/\>
  \<input type="hidden" name="index" value="\$(index)"/\>
  \<input type="hidden" name="icoday1" value="\$(icoday1)"/\>
  \<input type="hidden" name="icoday2" value="\$(icoday2)"/\>
  \<input type="hidden" name="weekday" value="\$(weekday)"/\>
  \<input type="hidden" name="dayselector" value="\$(dayselector)"/\>
  \<input type="hidden" name="input" value="\$(input)"/\>
  \<table width="650px" bgcolor="white" align="center" style="border: 1px solid black"\>
    \<tr\>
      \<td colspan="2"\>\$(type1) Event\</td\>
    \</tr\>
    \<tr\>
      \<td\>\<b\>OOC Date: \</b\>\</td\>\<td\>\$[(\{ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" \})[Int(\$weekday)-1]] \$[::get_month_name(\$month: Int(\$month))] \$[Str(\$day)] \$(year)\</td\>
    \</tr\>
    \<tr\>
      \<td\>\<b\>Title: \</b\>\</td\>\<td\>\<input type="text" name="title" value="\$(title)" size="100"/\>\</td\>
    \</tr\>
    \$["";      
       \$hourOptions = "";      
       \$hourArr = (\{ "00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23" \});      
       if(\$hours == "") \{ \$hours = \$hourArr[0]; \}      
       for(\$i = 0; \$i \< 24; \$i++) \{      
         if(Int(\$hours) == \$i) \{      
             \$hourOptions += "\<option value='" + Str(\$hourArr[\$i]) + "' selected='selected'\>" + Str(\$hourArr[\$i]) + "\</option\>";      
         \} else \{      
             \$hourOptions += "\<option value='" + Str(\$hourArr[\$i]) + "'\>" + Str(\$hourArr[\$i]) + "\</option\>";      
         \}      
       \}      
      
       \$minuteOptions = "";      
       \$minuteArr = (\{ "00", "15", "30", "45" \});      
       if(\$minutes == "") \{ \$minutes = \$minuteArr[0]; \}      
       for(\$i = 0; \$i \< 4; \$i++) \{      
         if(Int(\$minutes) == \$minuteArr[\$i]) \{      
             \$minuteOptions += "\<option value='" + Str(\$minuteArr[\$i]) + "' selected='selected'\>" + Str(\$minuteArr[\$i]) + "\</option\>";      
         \} else \{      
             \$minuteOptions += "\<option value='" + Str(\$minuteArr[\$i]) + "'\>" + Str(\$minuteArr[\$i]) + "\</option\>";      
         \}      
       \}]
    \<tr\>
      \<td\>\<b\>Time: \</b\>\</td\>\<td\>\<select name="hours"\>\$(hourOptions)\</select\>:\<select name="minutes"\>\$(minuteOptions)\</select\> Skotos Time\</td\>
    \</tr\>
    \<tr\>
      \<td\>\<b\>Location: \</b\>\</td\>\<td\>\<input type="text" name="location" value="\$(location)" size="100"/\>\</td\>
    \</tr\>
    \<tr\>
      \<td valign="top"\>\<b\>Description: \</b\>\</td\>\<td\>\<textarea name="description" cols="75" rows="5"\>\$(description)\</textarea\>\</td\>
    \</tr\>
    \<tr\>
      \<td colspan="2"\>\<center\>\<input type="submit" value="Save"/\>\</center\>\</td\>
    \</tr\>
  \</table\>
  \<action\>
    \$["";      
      \$db = \$\{Ironclaw:Data:Events\};    
  
      \$monthlyListing = ([ ]);    
      if(Get(\$db, "event:" + lower_case(::get_month_name(\$month: Int(\$month))))) \{    
        \$monthlyListing = Get(\$db, "event:" + lower_case(::get_month_name(\$month: Int(\$month))));    
      \}      
  
      if(\$type1 == "Adding") \{  
        if(map_sizeof(\$monthlyListing)) \{    
          if(\$monthlyListing[Str(\$day)]) \{    
              if(\$monthlyListing[Str(\$day)][Str(\$hours) + Str(\$minutes)]) \{    
                  \$monthlyListing[Str(\$day)][Str(\$hours) + Str(\$minutes)] += (\{ (\{ \$title, \$description, \$location, \$year \}) \});    
              \} else \{    
                  \$monthlyListing[Str(\$day)] += ([ Str(\$hours) + Str(\$minutes):(\{ (\{ \$title, \$description, \$location, \$year \}) \}) ]);    
              \}    
           \} else \{    
               \$monthlyListing += ([ Str(\$day):([ Str(\$hours) + Str(\$minutes):(\{ (\{ \$title, \$description, \$location, \$year \}) \}) ]) ]);    
           \}    
        \} else \{    
          \$monthlyListing = ([ Str(\$day):([ Str(\$hours) + Str(\$minutes):(\{ (\{ \$title, \$description, \$location, \$year \}) \}) ]) ]);    
        \}   
        \$result = "Event added to " + ::get_month_name(\$month: Int(\$month)) + " " + Str(\$day) + " @ " + Str(\$hours) + ":" + Str(\$minutes) + ".";  
      \} else \{  
        \$monthlyListing[Str(\$day)][Str(\$oldhours) + Str(\$oldminutes)][Int(\$index)] = nil;  
        \$monthlyListing[Str(\$day)][Str(\$oldhours) + Str(\$oldminutes)] -= (\{ nil \});  
  
        if(!sizeof(\$monthlyListing[Str(\$day)][Str(\$oldhours) + Str(\$oldminutes)])) \{  
            \$monthlyListing[Str(\$day)][Str(\$oldhours) + Str(\$oldminutes)] = nil;  
        \}  
  
        if(\$monthlyListing[Str(\$day)][Str(\$hours) + Str(\$minutes)]) \{    
            \$monthlyListing[Str(\$day)][Str(\$hours) + Str(\$minutes)] += (\{ (\{ \$title, \$description, \$location, \$year \}) \});    
        \} else \{    
            \$monthlyListing[Str(\$day)] += ([ Str(\$hours) + Str(\$minutes):(\{ (\{ \$title, \$description, \$location, \$year \}) \}) ]);    
        \}    
  
        \$result = "Event modified for " + ::get_month_name(\$month: Int(\$month)) + " " + Str(\$day) + " @ " + Str(\$hours) + ":" + Str(\$minutes) + ".";  
      \}   
      
      Set(\$db, "event:" + lower_case(::get_month_name(\$month: Int(\$month))), \$monthlyListing);]
    \<redirect propob="\$(this)" prop="showevents" actor="\$(actor)" day="\$(day)" month="\$(month)" year="\$(year)" icoday1="\$(icoday1)" icoday2="\$(icoday2)" weekday="\$(weekday)" dayselector="\$(dayselector)" result="\$(result)" input="\$(input)"/\>
  \</action\>
\</zform\>
\</body\>
\</html\>
      </Core:Property>
      <Core:Property property="html:index">
         X[S] \<html\>
\$[::output(\$input: \$input, \$result: \$result, \$actor: \$actor)]
\</html\>
      </Core:Property>
      <Core:Property property="html:showevents">
         X[S] \<html\>
\$[::show_events(\$actor: \$actor, \$day: \$day, \$month: \$month, \$year: \$year)]
\</html\>
      </Core:Property>
      <Core:Property property="merry:global:command">
         X[M] int input;
input = 0;

if(\$evoke) \{
    if(!sscanf(\$evoke, "\\"%d\\"", input)) \{
        EmitTo(\$actor, "Invalid input.");
        return FALSE;
    \}

    if(input \<= 0 \|\| input \> 12) \{
        EmitTo(\$actor, "Please input a number between 1 and 12");
        return FALSE;
    \}
\}

EmitTo(\$actor, "1");
EmitTo(\$actor, "If you do not see the Calendar popup window, please visit http://ironclaw.skotos.net/SAM/Prop/Ironclaw%3ANeoct%3AVerbs%3AOOC%3AC%3A%40calendar/index?actor=" + replace_strings(Str(\$actor), ":", "%3A") + "\&input=" + Str(\$input));

Popup(\$actor, \$this, "index", \$input: input, \$actor: \$actor);
      </Core:Property>
      <Core:Property property="merry:lib:conversion">
         X[M] /* 
**
** \$month (int)
** \$day (int)
** \$year (int)
**
*/

string sallmonth, dolmonth;
int sallday, dolday;

sallmonth = (\{ "Yule", "Snow", "Sap", "Grass", "Flower", "Strawberry", "Thunder", "Green", "Harvest", "Hunter's", "Frost", "Night" \})[Int(\$month) - 1];
sallday = Int(\$day);

if(\$religion == "sallaumer") \{
    return (\{ sallmonth, sallday \});
\}

/* JANUARY/YULE */
if(sallmonth == "Yule") \{
    if(sallday \> 0 \&\& sallday \<= 20) \{
        dolmonth = "Elder";
        dolday = sallday + 8;
    \} else if(sallday \>= 21) \{
        dolmonth = "Birch";
        dolday = sallday - 20;
    \}
\} 

/* FEBRUARY/SNOW */
if(sallmonth == "Snow") \{
    if(sallday \> 0 \&\& sallday \<= 17) \{
        dolmonth = "Rowan";
        dolday = sallday + 11;
    \} else if(sallday \>= 18) \{
        dolmonth = "Ash";
        dolday = sallday - 17;
    \}
\}

/* MARCH/SAP */
if(sallmonth == "Sap") \{
    if(sallday \> 0 \&\& sallday \<= 17) \{
        \$dolmonth = "Ash";

        /* Adjust for leap year */
        if(Int(\$year)%4 == 0) \{      
            dolday = sallday + 12;
        \} else \{    
            dolday = sallday + 11; 
        \}
        if(sallday \>= 18) \{
            dolmonth = "Alder";
            dolday = sallday - 17;
        \}
    \}
\} 

/* APRIL/GRASS */
if(sallmonth == "April") \{
    if(sallday \> 0 \&\& sallday \<= 14) \{
        dolmonth = "Alder";
        dolday = sallday + 14;
    \} else if(sallday \>= 15) \{
        dolmonth = "Willow";
        dolday = sallday - 14;
    \}
\}

/* MAY/FLOWER */
if(sallmonth == "May") \{
    if(sallday \> 0 \&\& sallday \<= 12) \{
        dolmonth = "Willow";
        dolday = sallday + 16;
    \} else if(sallday \>= 13) \{
        dolmonth = "Hawthorn";
        dolday = sallday - 12;
    \}
\}

/* JUNE/STRAWBERRY */
if(sallmonth == "June") \{
    if(sallday \> 0 \&\& sallday \<= 9) \{
        dolmonth = "Hawthorn";
  
        dolday = sallday + 19;
    \} else if(sallday \>= 10) \{
        dolmonth = "Oak";
        dolday = sallday - 9;
    \}
\}

/* JULY/THUNDER */
if(sallmonth == "Thunder") \{
    if(sallday \> 0 \&\& sallday \<= 7) \{
        dolmonth = "Oak";
        dolday = sallday + 11;
    \} else if(\$month == "July" \&\& \$day \>= 8) \{
        dolmonth = "Holly";
        dolday = sallday - 7;
    \}
\}

/* AUGUST/GREEN */
if(sallmonth == "Green") \{
    if(sallday \> 0 \&\& sallday \<= 4) \{
        dolmonth = "Holly";
        dolday = sallday + 24;
    \} else if(\$month == "August" \&\& \$day \>= 5) \{
        dolmonth = "Hazel";
        dolday = sallday - 4;
    \}
\}

/* SEPTEMBER/HARVEST */
if(sallmonth == "Harvest") \{
    if(sallday == 1) \{
        dolmonth = "Hazel";
        dolday = sallday + 27;
    \} else if(sallday \>= 2 \&\& sallday \<= 29) \{
        dolmonth = "Vine";
        dolday = sallday - 1;
    \} else if(sallday == 30) \{
        dolmonth = "Ivy";
        dolday = sallday - 29;
    \}
\}

/* OCTOBER/HUNTER'S */
if(sallmonth == "Hunter's") \{
    if(sallday \> 0 \&\& sallday \<= 27) \{
        dolmonth = "Ivy";
        dolday = \$day + 1;
    \} else if(sallday \>= 28) \{
        dolmonth = "Reed";
        dolday = sallday - 27;
    \}
\}

/* NOVEMBER/FROST */
if(sallmonth == "Frost") \{    
    if(sallday \> 0 \&\& sallday \<= 24) \{
        dolmonth = "Reed";
        dolday = sallday + 4;
    \} else if(sallday \>= 25) \{
        dolmonth = "Elder";
        dolday = sallday - 24;
    \} 
\}

/* DECEMBER/NIGHT */
if(sallmonth == "Night") \{
    if(sallday \> 0 \&\& sallday \< 22) \{
        dolmonth = "Elder";
        dolday = sallday + 6;
    \} else if(\$day == 23) \{
        dolmonth = "Secret of the Unhewn Stone";
        dolday = sallday - 22;
    \} else if(\$day \>= 24) \{
        dolmonth = "Birch";
        dolday = sallday - 23;
    \}
\}

return (\{ dolmonth, dolday \});
      </Core:Property>
      <Core:Property property="merry:lib:get_days">
         X[M] /*
** \$month (as integer), \$year (as integer)
** returns # of days in inputted month
*/

int days;

switch(\$month) \{
    case 1:
    \{
        days = 31;
 break;
    \}
    case 2:
    \{
      days = 28;
      if(Int(\$year)%4 == 0) \{
          days = 29;
      \}
      break;
    \}
    case 3:
    \{
 days = 31;
 break;
    \}
    case 4:
    \{
 days = 30;
 break;
    \}
    case 5:
    \{
 days = 31;
 break;
    \}
    case 6:
    \{
 days = 30;
 break;
    \}
    case 7:
    \{
 days = 31;
 break;
    \}
    case 8:
    \{
     days = 31;
 break;
    \}
    case 9:
    \{
 days = 30;
        break;
    \}
    case 10:
    \{
     days = 31;
        break;
    \}
    case 11:
    \{
 days = 30;
        break;
    \}
    case 12:
    \{
 days = 31;
        break;
    \}
    default:
    \{
        days = 0;
        break;
    \}
\}

return days;
      </Core:Property>
      <Core:Property property="merry:lib:get_month_name">
         X[M] /* 
** \$month (as integer) 
** returns # of month in inputted month 
*/ 
 
string month; 
 
switch(\$month) \{ 
    case 1: 
    \{ 
        month = "January"; 
 break; 
    \} 
    case 2: 
    \{ 
 month = "February"; 
 break; 
    \} 
    case 3: 
    \{ 
 month = "March"; 
 break; 
    \} 
    case 4: 
    \{ 
 month = "April"; 
 break; 
    \} 
    case 5: 
    \{ 
 month = "May"; 
 break; 
    \} 
    case 6: 
    \{ 
 month = "June"; 
 break; 
    \} 
    case 7: 
    \{ 
 month = "July"; 
 break; 
    \} 
    case 8: 
    \{ 
     month = "August"; 
 break; 
    \} 
    case 9: 
    \{ 
 month = "September"; 
        break; 
    \} 
    case 10: 
    \{ 
     month = "October"; 
        break; 
    \} 
    case 11: 
    \{ 
 month = "November"; 
        break; 
    \} 
    case 12: 
    \{ 
 month = "December"; 
        break; 
    \} 
    default: 
    \{ 
        month = "Unknown"; 
        break; 
    \} 
\} 
 
return month;
      </Core:Property>
      <Core:Property property="merry:lib:output">
         X[M] int today, numDays, i, counter, firstOfMonth, counter2, todayMonth, todayDay, todayYear, lastMonth, lastofPreviousMonth, lastMonthYear;
mixed *firstOfMonthArr, *weekdaysall, *daynames, *daycolors, *daynames2;
string month, output, firstOfMonthWeekday, icomonth, icoday1, icoday2, icoday12, icoday22, dolmonth;

today = time();
if(Int(\$input) == 0) \{
    todayMonth = get_month(today);
    todayDay = get_day(today);
    todayYear = get_year(today);

    month = ::get_month_name(\$month: todayMonth);

    lastofPreviousMonth = time() - ((Int(todayDay)) * 24 * 60 * 60);
    lastMonth = get_month(lastofPreviousMonth);
    lastMonthYear = get_year(lastofPreviousMonth);

    firstOfMonth = time() - ((Int(todayDay) - 1) * 24 * 60 * 60);
    firstOfMonthArr = explode(ctime(firstOfMonth), " ") - (\{ "" \});
    firstOfMonthWeekday = firstOfMonthArr[0];
\} else \{
    todayMonth = Int(\$input);
    todayDay = 1;

    if(todayMonth \< get_month(today)) \{
        todayYear = get_year(today) + 1;
    \} else \{
        todayYear = get_year(today);
    \}

    month = ::get_month_name(\$month: todayMonth);

    lastMonth = todayMonth - 1;
    lastMonthYear = todayYear;

    if(lastMonth == 0) \{ lastMonth = 12; lastMonthYear = todayYear - 1; \}

    firstOfMonth = calculate_stamp(todayYear, todayMonth, todayDay);
    firstOfMonthArr = explode(ctime(firstOfMonth), " ") - (\{ "" \});
    firstOfMonthWeekday = firstOfMonthArr[0];
\}

weekdaysall = (\{ "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" \});
daynames = (\{ "Dimache", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi" \});
daynames2 = (\{ "De Domhnaigh", "De Luan", "De Mairt", "De Ceadaoin", "Deardaoin", "De Haoine", "De Sathairn" \});
daycolors = (\{ "yellow", "red", "blue", "green", "orange", "purple", "gray" \});
numDays = ::get_days(\$month: todayMonth, \$year: todayYear);
i = 1;
counter = 0;
counter2 = 0;
icomonth = replace_strings(month[0..2], "Jan", "Yule", "Feb", "Snow", "Mar", "Sap", "Apr", "Grass", "May", "Flower", "Jun", "Strawberry", "Jul", "Thunder", "Aug", "Green", "Sep", "Harvest", "Oct", "Hunter's", "Nov", "Frost", "Dec", "Night" );
dolmonth = replace_strings(month[0..2], "Jan", "6 Birch - 8 Rowan", "Feb", "9 Rowan - 8 Ash", "Mar", "9 Ash - 11 Alder", "Apr", "12 Alder - 13 Willow", "May", "14 Willow - 16 Hawthorn", "Jun", "17 Hawthorn - 18 Oak", "Jul", "19 Oak - 21 Holly", "Aug", "22 Holly - 24 Hazel", "Sep", "25 Hazel - 26 Vine", "Oct", "27 Vine - 1 Reed", "Nov", "2 Reed - 3 Elder", "Dec", "4 Elder - 5 Birch" );

output = "\<head\>\<style\>td \\\\\{ border-width: 1px; border-style: solid none solid none; border-color: black; \\\\\}\</style\>\</head\>\<body background='http://www.skotos.net/IronclawGame/images/skin/parch-d2.jpg'\>";

\$allMonths = (\{ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" \});
\$output2 = "\<zform\>";
\$output2 += "\<select name='month' style='position:relative; top:7;'\>\<option value='" + Str(Int(todayMonth)) + "'\>--select month--\</option\>";
for(i = 0; i \< sizeof(\$allMonths); i++) \{
    if((i+1) \>= Int(get_month(time()))) \{
        \$output2 += "\<option value='" + Str(i+1) + "'\>" + \$allMonths[i] + " " + Str(Int(get_year(time()))) + "\</option\>";
    \} else \{
        \$output2 += "\<option value='" + Str(i+1) + "'\>" + \$allMonths[i] + " " + Str(Int(get_year(time()))+1) + "\</option\>";
    \}
\}
\$output2 += "\</select\>";
\$output2 += "\<input type='submit' value='Go' style='position:relative; top:7'/\>";
\$output2 += "\<action\>";
\$output2 += "\<redirect propob='\$(this)' prop='index' actor='" + Str(\$actor) + "' input='\$(month)'/\>";
\$output2 += "\</action\>";
\$output2 += "\</zform\>";

output += "\<table border='0' align='center' cellpadding='0' cellspacing='0' style='border-width:1px 2px 1px 2px; border-style: solid; border-color:black'\>";
output += "\<tr\>\<td bgcolor='black' colspan=7 style='filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;'\>\<center\>\<table cellspacing=0 cellpadding=0 border=0 width='100%'\>\<tr\>\<td\>\</td\>\<td align='center'\>\<font color='white' size='5'\>\<center\>\<b\>";

if(\$religion == "sallumer") \{
    output += "The Month of "  + icomonth + ", year " + Str(todayYear - 1119);
\} else \{
    output += dolmonth;
\}

output += "\</b\>\</center\>\</font\>\</td\>\<td\>\</td\>\</tr\>\</table\>\<table width='100%'\>\<tr\>\<td width='30%'\>\</td\>\<td align='center'\>\<font color='white' size='4'\>\<b\>(" + month + " " + todayYear + ")" + "\</b\>\</font\>\</td\>\<td width='30%'\>" + \$output2 + "\</td\>\</tr\>\</table\>\</center\>\</td\>\</tr\>";
output += "\<tr\>";
output += "\<td width='100px' style='border: 0px ridge black; filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;' bgcolor='white'\>\<center\>\<b\>Sunday\</b\>\</center\>\</td\>";
output += "\<td width='100px' style='border: 0px ridge black; filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;' bgcolor='white'\>\<center\>\<b\>Monday\</b\>\</center\>\</td\>";
output += "\<td width='100px' style='border: 0px ridge black; filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;' bgcolor='white'\>\<center\>\<b\>Tuesday\</b\>\</center\>\</td\>";
output += "\<td width='100px' style='border: 0px ridge black; filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;' bgcolor='white'\>\<center\>\<b\>Wednesday\</b\>\</center\>\</td\>";
output += "\<td width='100px' style='border: 0px ridge black; filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;' bgcolor='white'\>\<center\>\<b\>Thursday\</b\>\</center\>\</td\>";
output += "\<td width='100px' style='border: 0px ridge black; filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;' bgcolor='white'\>\<center\>\<b\>Friday\</b\>\</center\>\</td\>";
output += "\<td width='100px' style='border: 0px ridge black; filter:alpha(opacity=70); -moz-opacity:0.7; -khtml-opacity: 0.7; opacity: 0.7;' bgcolor='white'\>\<center\>\<b\>Saturday\</b\>\</center\>\</td\>";
output += "\</tr\>";

\$temp = index(firstOfMonthWeekday, weekdaysall);
\$temp2 = ::get_days(\$month: lastMonth);

\$late = 33;
\$early = 67;

for(i = 0; i \< 42; i++) \{
    counter++;

    if(counter == 1) \{
        output += "\<tr\>";
    \}

    if(\$color == "ffffee") \{
        \$color = "ffffff";
    \} else \{
        \$color = "ffffee";
    \}

    output += "\<td height='100px'\>";

    if(\$temp \> 0) \{
        \$timestamp = calculate_stamp(lastMonthYear, lastMonth, \$temp2 - \$temp + 1);
        if(\$religion == "sallumer") \{
            icoday1 = daynames[\$timestamp/(60*60*16)%7];
        \} else \{
            icoday1 = daynames2[\$timestamp/(60*60*16)%7];
        \}
        \$daycolor1 = daycolors[\$timestamp/(60*60*16)%7];
	if(((\$timestamp/(60*60))%16) \>= 12)
	\{
          if(\$religion == "sallumer") \{
	      icoday2 = daynames[((\$timestamp/(60*60*16+1))+1)%7];
          \} else \{
              icoday2 = daynames2[((\$timestamp/(60*60*16+1))+1)%7];
          \}
          \$daycolor2 = daycolors[((\$timestamp/(60*60*16+1))+1)%7];
          \$when = \$late;
          \$dayselector = "8";
          \$border1 = "solid solid solid none";
          \$border2 = "solid solid solid solid";
          \$num4 = Int(strlen(icoday1));
          \$num5 = (\$num4/2);
          \$num6 = \$num4 - \$num5;
          icoday12 = icoday1[\$num6..(\$num4-1)];
          icoday22 = icoday2;
          \$align1 = "left";
          \$align2 = "center";
	\} else \{
          if(\$religion == "sallumer") \{
	      icoday2 = daynames[((\$timestamp/(60*60*16))+1)%7];
          \} else \{
 	      icoday2 = daynames2[((\$timestamp/(60*60*16))+1)%7];
          \}
          \$daycolor2 = daycolors[((\$timestamp/(60*60*16))+1)%7];
          \$when = \$early;
          \$dayselector = "16";
          \$border1 = "solid solid solid solid";
          \$border2 = "solid none solid solid";
          \$num = Int(ceil(Flt(strlen(icoday2))/2.0));
          icoday22 = icoday2[0..(\$num-1)];
          icoday12 = icoday1;
          \$align1 = "center";
          \$align2 = "right";
	\}
                \$finalDay = Str(::conversion(\$month: lastMonth, \$day: \$temp2 - \$temp + 1, \$year: todayYear, \$religion: "sallumer")[1]);
                \$finalMonth = Str(::conversion(\$month: lastMonth, \$day: \$temp2 - \$temp + 1, \$year: todayYear, \$religion: "sallumer")[0]);

        output += "\<div style='height:100%; width:100%; filter:alpha(opacity=25); -moz-opacity:0.25; -khtml-opacity: 0.25; opacity: 0.25; background-color:#" + \$color + "'\>\<table cellspacing='0' cellpadding='0' width='100%' height='100%'\>\<tr\>\<td valign='top' colspan='2' align='right' style='border-width:1px; border-color:black; border-style: solid;'\>" + Str(\$finalDay) + "(" + Str(\$temp2-\$temp+1) + ")" + "\</td\>\</tr\>\<tr\>\<td valign='middle' align='" + \$align1 + "' height='20px' style='background-color:" + \$daycolor1 + "; border-width:1px; border-color:black; border-style:" + \$border1 + ";' width='" + Str(\$when) + "px'\>\<font size='1'\>" + icoday12 + "\</font\>\</td\>\<td valign='middle' align='" + \$align2 + "' style='background-color:" + \$daycolor2 + "; border-width:1px; border-color:black; border-style:" + \$border2 + ";' width='" + Str(100-\$when) + "px'\>\<font size='1'\>" + icoday22 + "\</font\>\</td\>\</tr\>\</table\>\</div\>";
    \}

    if(counter2 \<= numDays) \{
        if(counter2 == 0 \&\& firstOfMonthWeekday == weekdaysall[counter - 1]) \{
            counter2 = 1;
        \}

        if(counter2 \> 0) \{
            \$timestamp = calculate_stamp(todayYear, todayMonth, counter2);
            if(\$religion == "sallumer") \{
                icoday1 = daynames[\$timestamp/(60*60*16)%7];
            \} else \{
                icoday1 = daynames2[\$timestamp/(60*60*16)%7];
            \}
            \$daycolor1 = daycolors[\$timestamp/(60*60*16)%7];

	    if(((\$timestamp/(60*60))%16) \>= 12)
	    \{
              if(\$religion == "sallumer") \{
	          icoday2 = daynames[((\$timestamp/(60*60*16+1))+1)%7];
              \} else \{
                  icoday2 = daynames2[((\$timestamp/(60*60*16+1))+1)%7];
              \}
              \$daycolor2 = daycolors[((\$timestamp/(60*60*16+1))+1)%7];
              \$when = \$late;
              \$dayselector = "8";
              \$border1 = "solid solid solid none";
              \$border2 = "solid solid solid solid";
              \$num4 = Int(strlen(icoday1));
              \$num5 = (\$num4/2);
              \$num6 = \$num4 - \$num5;
              icoday12 = icoday1[\$num6..(\$num4-1)];
              icoday22 = icoday2;
              \$align1 = "left";
              \$align2 = "center";
	    \} else \{
              if(\$religion == "sallumer") \{
	          icoday2 = daynames[((\$timestamp/(60*60*16))+1)%7];
              \} else \{
 	          icoday2 = daynames2[((\$timestamp/(60*60*16))+1)%7];
              \}
              \$dayselector = "16";
              \$daycolor2 = daycolors[((\$timestamp/(60*60*16))+1)%7];
              \$when = \$early;
              \$border1 = "solid solid solid solid";
              \$border2 = "solid none solid solid";
              \$num = Int(ceil(Flt(strlen(icoday2))/2.0));
              icoday22 = icoday2[0..(\$num-1)];
              icoday12 = icoday1;
              \$align1 = "center";
              \$align2 = "right";
	    \}
            if(counter2 == todayDay) \{
                \$finalDay = Str(::conversion(\$month: todayMonth, \$day: counter2, \$year: todayYear, \$religion: \$religion)[1]);
                \$finalMonth = Str(::conversion(\$month: todayMonth, \$day: counter2, \$year: todayYear, \$religion: \$religion)[0]);
                output += "\<div ";
                output += "    title='The " + Str(capitalize(desc_ordinal(Int(\$finalDay)))) + " day of " + Str(replace_strings(\$finalMonth, "'", "\\\\'")) + "'";
                output += "    style='height:100%; width:100%;'";
                output += "\>";
                output += "\<table  cellspacing='0' cellpadding='0' width='100%' height='100%'\>";
                output += "  \<tr\>";
                output += "    \<td colspan='2' align='right' valign='top'";
                output += "      style='filter:alpha(opacity=70); -moz-opacity:0.70; -khtml-opacity: 0.70; opacity: 0.70;";
                output += "             border-width:5px 5px 1px 5px; border-color:red red black red; border-style:outset outset solid outset;";
                output += "             background-color:#" + \$color + "'";
                output += "      onmouseover='this.style.opacity=0.90; this.filters.alpha.opacity=90;'";
                output += "      onmouseout='this.style.opacity=0.70; this.filters.alpha.opacity=70'";
                output += "    \>";
                output += "     \<zact\>";
                output += "       \<font size='5'\>\<b\>" + Str(\$finalDay) + "(" + Str(counter2) + ")" + "\</b\>\</font\>";
                output += "       \<action\>\$[\\"\\";";
                output += "                ]";
                output += "       \<redirect propob=\\"\$(this)\\" prop=\\"showevents\\" actor=\\"" + Str(\$actor) + "\\" day=\\"" + Str(counter2) + "\\" month=\\"" + todayMonth + "\\" year=\\"" + todayYear + "\\" icoday1=\\"" + icoday1 + "\\" icoday2=\\"" + icoday2 + "\\" weekday=\\"" + Str(counter) + "\\" dayselector=\\"" + Str(\$dayselector) + "\\" output=\\"" + Str(\$input) + "\\"/\>";
                output += "       \</action\>";
                output += "     \</zact\>";

                if(::query_events(\$month: todayMonth, \$day: counter2)) \{
		    output += "   \<br/\>\<span title='An event has been scheduled'\>\<center\>\<b\>E\</b\>\</center\>\</span\>";
                \}

                output += "    \</td\>";
                output += "  \</tr\>";
                output += "  \<tr\>";
                output += "    \<td align='" + \$align1 + "' valign='middle' height='20px' width='" + Str(\$when) + "px'";
                output += "      style='border-width:1px 1px 5px 5px; border-color:black black red red; border-style: solid solid outset outset;";
                output += "             filter:alpha(opacity=65); -moz-opacity:0.65; -khtml-opacity: 0.65; opacity:0.65;";
                output += "             background-color:" + Str(\$daycolor1) + "'";
                output += "      onmouseover='this.style.opacity=0.85; this.filters.alpha.opacity=85;'";
                output += "      onmouseout='this.style.opacity=0.65; this.filters.alpha.opacity=65'";
                output += "    \>";
                output += "     \<div title='" + Str(icoday1) + ", the " + Str(capitalize(desc_ordinal(Int(\$finalDay)))) + " day of " + Str(replace_strings(\$finalMonth, "'", "\\\\'")) + "'\>";
                output += "       \<font size='2'\>" + icoday12 + "\</font\>";
                output += "     \</div\>";
                output += "    \</td\>";
                output += "    \<td align='" + \$align2 + "' valign='middle' width='" + Str(100-\$when) + "px'";
                output += "      style='border-width:1px 5px 5px 1px; border-color:black red red black; border-style: solid outset outset solid;";
                output += "             filter:alpha(opacity=65); -moz-opacity:0.65; -khtml-opacity: 0.65; opacity: 0.65;";
                output += "             background-color:" + Str(\$daycolor2) + "'";
                output += "      onmouseover='this.style.opacity=0.85; this.filters.alpha.opacity=85;'";
                output += "      onmouseout='this.style.opacity=0.65; this.filters.alpha.opacity=65'";
                output += "    \>";
                output += "     \<div title='" + Str(icoday2) + ", the " + Str(capitalize(desc_ordinal(Int(\$finalDay)))) + " day of " + Str(replace_strings(\$finalMonth, "'", "\\\\'")) + "'\>";
                output += "       \<font size='2'\>" + icoday22 + "\</font\>";
                output += "     \</div\>";
                output += "    \</td\>";
                output += "  \</tr\>";
                output += "\</table\>";
                output += "\</div\>";
            \} else \{
                \$finalDay = Str(::conversion(\$month: todayMonth, \$day: counter2, \$year: todayYear, \$religion: \$religion)[1]);
                \$finalMonth = Str(::conversion(\$month: todayMonth, \$day: counter2, \$year: todayYear, \$religion: \$religion)[0]);
                output += "\<div ";
                output += "    title='The " + Str(capitalize(desc_ordinal(Int(\$finalDay)))) + " day of " + Str(replace_strings(\$finalMonth, "'", "\\\\'")) + "'";
                output += "    style='height:100%; width:100%;'";
                output += "\>";
                output += "\<table cellspacing='0' cellpadding='0' width='100%' height='100%'\>";
                output += "  \<tr\>";
                output += "    \<td colspan='2' align='right' valign='top'";
                output += "      style='filter:alpha(opacity=50); -moz-opacity:0.5; -khtml-opacity: 0.5; opacity: 0.5;";
                output += "             border-width:1px; border-color:black; border-style:solid;";
                output += "             background-color:#" + \$color + "'";
                output += "      onmouseover='this.style.opacity=0.7; this.filters.alpha.opacity=70;'";
                output += "      onmouseout='this.style.opacity=0.5; this.filters.alpha.opacity=50'";
                output += "    \>";
                output += "     \<zact\>";
                output += "       \<font size='5'\>\<b\>" + \$finalDay + "(" + Str(counter2) + ")" + "\</b\>\</font\>";
                output += "       \<action\>\$[\\"\\";";
                output += "                ]";
                output += "       \<redirect propob=\\"\$(this)\\" prop=\\"showevents\\" actor=\\"" + Str(\$actor) + "\\" day=\\"" + Str(counter2) + "\\" month=\\"" + todayMonth + "\\" year=\\"" + todayYear + "\\" icoday1=\\"" + icoday1 + "\\" icoday2=\\"" + icoday2 + "\\" weekday=\\"" + Str(counter) + "\\" dayselector=\\"" + Str(\$dayselector) + "\\" input=\\"" + Str(\$input) + "\\"/\>";
                output += "       \</action\>";
                output += "     \</zact\>";

                if(::query_events(\$month: todayMonth, \$day: counter2)) \{
		    output += "   \<br/\>\<span title='An event has been scheduled'\>\<center\>\<b\>E\</b\>\</center\>\</span\>";
                \}

                output += "    \</td\>";
                output += "  \</tr\>";
                output += "  \<tr\>";
                output += "    \<td align='" + \$align1 + "' valign='middle' height='20px' width='" + Str(\$when) + "px'";
                output += "      style='border-width:1px; border-color:black; border-style:" + \$border1 + ";";
                output += "             filter:alpha(opacity=50); -moz-opacity:0.5; -khtml-opacity: 0.5; opacity:0.5;";
                output += "             background-color:" + \$daycolor1 + "'";
                output += "      onmouseover='this.style.opacity=0.7; this.filters.alpha.opacity=70;'";
                output += "      onmouseout='this.style.opacity=0.5; this.filters.alpha.opacity=50'";
                output += "    \>";
                output += "     \<div title='" + Str(icoday1) + ", the " + Str(capitalize(desc_ordinal(Int(\$finalDay)))) + " day of " + Str(replace_strings(\$finalMonth, "'", "\\\\'")) + "'\>";
                output += "       \<font size='1'\>" + icoday12 + "\</font\>";
                output += "     \</div\>";
                output += "    \</td\>";
                output += "    \<td align='" + \$align2 + "' valign='middle' width='" + Str(100-\$when) + "px'";
                output += "      style='border-width:1px; border-color:black; border-style:" + \$border2 + ";";
                output += "             filter:alpha(opacity=50); -moz-opacity:0.5; -khtml-opacity: 0.5; opacity: 0.5;";
                output += "             background-color:" + \$daycolor2 + "'";
                output += "      onmouseover='this.style.opacity=0.7; this.filters.alpha.opacity=70;'";
                output += "      onmouseout='this.style.opacity=0.5; this.filters.alpha.opacity=50'";
                output += "    \>";
                output += "     \<div title='" + Str(icoday2) + ", the " + Str(capitalize(desc_ordinal(Int(\$finalDay)))) + " day of " + Str(replace_strings(\$finalMonth, "'", "\\\\'")) + "'\>";
                output += "       \<font size='1'\>" + icoday22 + "\</font\>";
                output += "     \</div\>";
                output += "    \</td\>";
                output += "  \</tr\>";
                output += "\</table\>";
                output += "\</div\>";
            \}
            counter2++;
        \}
    \} else \{

        if(todayMonth == 12) \{
            \$timestamp = calculate_stamp(todayYear+1, 1, counter2 - numDays);
        \} else \{
            \$timestamp = calculate_stamp(todayYear, todayMonth+1, counter2 - numDays);
        \}
	icoday1 = daynames[\$timestamp/(60*60*16)%7];
        \$daycolor1 = daycolors[\$timestamp/(60*60*16)%7];
        if(\$religion == "sallumer") \{
            icoday1 = daynames[\$timestamp/(60*60*16)%7];
        \} else \{
            icoday1 = daynames2[\$timestamp/(60*60*16)%7];
        \}
	if(((\$timestamp/(60*60))%16) \>= 12)
	\{
          if(\$religion == "sallumer") \{
	      icoday2 = daynames[((\$timestamp/(60*60*16+1))+1)%7];
          \} else \{
              icoday2 = daynames2[((\$timestamp/(60*60*16+1))+1)%7];
          \}
          \$daycolor2 = daycolors[((\$timestamp/(60*60*16+1))+1)%7];
	  \$when = \$late;
          \$border1 = "solid solid solid none";
          \$border2 = "solid solid solid solid";
          \$num4 = Int(strlen(icoday1));
          \$num5 = (\$num4/2);
          \$num6 = \$num4 - \$num5;
          icoday12 = icoday1[\$num6..(\$num4-1)];
          icoday22 = icoday2;
          \$align1 = "left";
          \$align2 = "center";
	\} else \{
          if(\$religion == "sallumer") \{
	      icoday2 = daynames[((\$timestamp/(60*60*16))+1)%7];
          \} else \{
 	      icoday2 = daynames2[((\$timestamp/(60*60*16))+1)%7];
          \}
          \$daycolor2 = daycolors[((\$timestamp/(60*60*16))+1)%7];
          \$when = \$early;
          \$border1 = "solid solid solid solid";
          \$border2 = "solid none solid solid";
          \$num = Int(ceil(Flt(strlen(icoday2))/2.0));
          icoday22 = icoday2[0..(\$num-1)];
          icoday12 = icoday1;
          \$align1 = "center";
          \$align2 = "right";
	\}
                if(todayMonth == 12) \{ \$nextMonth = 1; \$nextYear = todayYear + 1; \} else \{ \$nextMonth = todayMonth + 1; \$nextYear = todayYear; \}
                \$finalDay = Str(::conversion(\$month: \$nextMonth, \$day: counter2 - numDays, \$year: \$nextYear, \$religion: \$religion)[1]);
                \$finalMonth = Str(::conversion(\$month: \$nextMonth, \$day: counter2 - numDays, \$year: \$nextYear, \$religion: \$religion)[0]);

        output += "\<div style='height:100%; width:100%; filter:alpha(opacity=25); -moz-opacity:0.25; -khtml-opacity: 0.25; opacity: 0.25; background-color:#" + \$color + "'\>\<table cellspacing='0' cellpadding='0' width='100%' height='100%'\>\<tr\>\<td valign='top' colspan='2' align='right' style='border-width:1px; border-color:black; border-style: solid;'\>" + Str(\$finalDay) + "(" + Str(counter2 - numDays) + ")" +  + "\</td\>\</tr\>\<tr\>\<td valign='middle' align='" + \$align1 + "' height='20px' style='background-color:" + \$daycolor1 + "; border-width:1px; border-color:black; border-style:" + \$border1 + ";' width='" + Str(\$when) + "px'\>\<font size='1'\>" + icoday12 + "\</font\>\</td\>\<td valign='middle' align='" + \$align2 + "' style='background-color:" + \$daycolor2 + "; border-width:1px; border-color:black; border-style:" + \$border2 + ";' width='" + Str(100-\$when) + "px'\>\<font size='1'\>" + icoday22 + "\</font\>\</td\>\</tr\>\</table\>\</div\>";
        counter2++;
    \}

    output += "\</td\>";

    /* End of week */
    if(counter == 7) \{
        output += "\</tr\>";
        counter = 0;
    \}

    \$temp--;
\}
output += "\</table\>\</body\>";
return ParseXML(output);
      </Core:Property>
      <Core:Property property="merry:lib:query_events">
         X[M] /*
** \$month
** \$day
*/
string month;
int i;

\$db = \$\{Ironclaw:Data:Events\};

month = ::get_month_name(\$month: \$month);

if(!Get(\$db, "event:" + lower_case(month))) \{
    return FALSE;
\}

if(!Get(\$db, "event:" + lower_case(month))[Str(\$day)]) \{
    return FALSE;
\}

\$listing = Get(\$db, "event:" + lower_case(month))[Str(\$day)];

if(!map_sizeof(\$listing)) \{
    return FALSE;
\}

\$times = map_indices(\$listing);

for(i = 0; i \< sizeof(\$times); i++) \{
    if(sizeof(\$listing[\$times[i]])) \{
        return TRUE;
    \}
\}

return TRUE;
      </Core:Property>
      <Core:Property property="merry:lib:show_events">
         X[M] string month, icomonth, output;
mapping monthlyListing, listing;
mixed *times, *entry, *entries;
int i, j;

\$eventDB = \$\{Ironclaw:Data:Events\};

\$access = (\{ \});
if(\$eventDB.access) \{
    \$access = \$eventDB.access;
\}

if(!sscanf(\$month + " " + \$day + " " + \$year, "%d %d %d", \$month, \$day, \$year)) \{
    return "Invalid Input!";
\}

\$other = ([ ]);
/*
if(\$icoday1 == "Dimache" \&\& \$dayselector == "8") \{
    \$other += ([ "0000":(\{ (\{ "Holy Day", "Holy Day Description", "--", \$year \}) \}) ]);
\} else if(\$icoday1 == "Dimache" \&\& \$dayselector == "16") \{
    \$other += ([ "0000":(\{ (\{ "Holy Day", "Holy Day Description", "--", \$year \}) \}) ]);
\} else if(\$icoday2 == "Dimache" \&\& \$dayselector == "8") \{
    \$other += ([ "0800":(\{ (\{ "Holy Day", "Holy Day Description", "--", \$year \}) \}) ]);
\} else if(\$icoday2 == "Dimache" \&\& \$dayselector == "16") \{
    \$other += ([ "1600":(\{ (\{ "Holy Day", "Holy Day Description", "--", \$year \}) \}) ]);
\}
*/

\$weekdays = (\{ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" \});
\$weekday1 = \$weekdays[Int(\$weekday)-1];

month = ::get_month_name(\$month: \$month);
icomonth = replace_strings(month[0..2], "Jan", "Yule", "Feb", "Snow", "Mar", "Sap", "Apr", "Grass", "May", "Flower", "Jun", "Strawberry", "Jul", "Thunder", "Aug", "Green", "Sep", "Harvest", "Oct", "Hunter's", "Nov", "Frost", "Dec", "Night" );

output = "";
output += "\<body background='http://www.skotos.net/IronclawGame/images/skin/parch-d2.jpg'\>";

output += "\<zact\>" + "\&lt;\&lt; Go back" +
          "\<action\>\$[\\"\\";]" +
          "\<redirect propob=\\"\$(this)\\" prop=\\"index\\" actor=\\"" + Str(\$actor) + "\\" input=\\"" + Str(\$input) + "\\"/\>" +
          "\</action\>" +
          "\</zact\>";

if(\$result) \{
    output += "\<font color='red'\>\<b\>" + \$result + "\</b\>\</font\>";
\}

output += "\<br/\>\<table width='650px' bgcolor='#330000' align='center' style='padding:20px; border: 1px dotted white; padding:10px 20px 10px 20px; filter:alpha(opacity=60); -moz-opacity:0.6; -khtml-opacity: 0.6; opacity: 0.6;'\>";
output += "\<tr\>";
output += "  \<td\>";
output += "    \<center\>\<font color='#ffffee' size='5'\>\<b\>Events for the " + Str(desc_ordinal(Int(\$day))) + " day of " + Str(icomonth) + ", year " + Str(\$year - 1119) + "\</b\>\</font\>\</center\>";
output += "  \</td\>";
output += "\</tr\>";
output += "\<tr\>";
output += "  \<td\>";
output += "    \<center\>\<font color='#ffffcc' size='4'\>\<b\>(" + \$weekday1 + " " + month + " " + Str(\$day) + ", " + Str(\$year) + ")\</b\>\</font\>\</center\>";
output += "  \</td\>";
output += "\</tr\>";
output += "\</table\>\<br/\>";

monthlyListing = ([ ]);
if(Get(\$eventDB, "event:" + Str(lower_case(month)))) \{
    monthlyListing = Get(\$eventDB, "event:" + Str(lower_case(month)));
\}

listing = ([ ]);
if(!map_sizeof(monthlyListing) \&\& !map_sizeof(\$other)) \{
    output += "\<center\>No scheduled events.\<br/\>\</center\>";
\} else \{
    if(!monthlyListing[Str(\$day)] \&\& !map_sizeof(\$other)) \{
        output += "\<center\>No scheduled events.\<br/\>\</center\>";
    \} else if(monthlyListing[Str(\$day)])\{
        if(!map_sizeof(monthlyListing[Str(\$day)])) \{
            monthlyListing[Str(\$day)] = nil;
            output += "\<center\>No scheduled events.\<br/\>\</center\>";
        \} else \{
            listing = monthlyListing[Str(\$day)];
        \}
    \}
\}

\$othertimes = (\{ \});
if(map_sizeof(\$other)) \{
    \$othertimes = map_indices(\$other);
\}

for(i = 0; i \< sizeof(\$othertimes); i++) \{
    if(listing[\$othertimes[i]]) \{
        listing[\$othertimes[i]] += \$other[\$othertimes[i]];
    \} else \{
        listing += \$other;
    \}
\}

times = (\{ \});
if(map_sizeof(listing)) \{
    times = map_indices(listing);
\}

if(sizeof(times)) \{
    for(i = 0; i \< sizeof(times); i++) \{
        \$t = times[i];
        \$t1 = \$t[0..1];
        \$t2 = \$t[2..3];

        \$icoday = \$icoday1;
        if(Int(\$t1) \>= Int(\$dayselector)) \{
            \$icoday = \$icoday2;
        \}

        \$ampm = "am";
        if(Int(\$t1) \>= 12 \&\& Int(\$t1) \< 24) \{
            \$ampm = "pm";
        \}

        entries = listing[times[i]] -= (\{ nil \});

        for(j = 0; j \< sizeof(entries); j++) \{
          entry = entries[j];
          if(sizeof(entry) == 4) \{

            if(\$color=="#ffffff") \{
                \$color = "#ffffee";
            \} else \{
                \$color = "#ffffff";
            \}

            if(entry[0] == "Holy Day") \{
                \$color = "#ffff99";
            \}

            output += "\<table width='650px' bgcolor='" + \$color + "' align='center' style='border: 1px dotted #660000; padding:10px 20px 10px 20px; filter:alpha(opacity=60); -moz-opacity:0.6; -khtml-opacity: 0.6; opacity: 0.6;'\>";
            output += "\<tr\>";
            output += "  \<td\>";
            output += "    \<font color='#330000' size='5'\>\<b\>" + entry[0] + "\</b\>\</font\>\</td\>\<td align='right'\>";

    if(\$actor \&\& \$actor != "" \&\& Obj(\$actor) \&\& member(Obj(\$actor), \$access)) \{

            output += "    \<zact\>" + "(edit)" +
                      "      \<action\>\$[\\"\\";]" +
          	      "       \<redirect propob=\\"\$(this)\\" prop=\\"edit\\" actor=\\"" + Str(\$actor) + "\\" month=\\"" + Str(\$month) + "\\" day=\\"" + Str(\$day) + "\\" year=\\"" + Str(\$year) + "\\" title=\\"" + Str(entry[0]) + "\\" description=\\"" + Str(entry[1]) + "\\" hours=\\"" + Str(\$t1) + "\\" minutes=\\"" + Str(\$t2) + "\\" location=\\"" + Str(entry[2]) + "\\" type=\\"Modifying\\" index=\\"" + Str(j) + "\\" icoday1=\\"" + \$icoday1 + "\\" icoday2=\\"" + \$icoday2 + "\\" weekday=\\"" + Str(\$weekday) + "\\" dayselector=\\"" + Str(\$dayselector) + "\\" input=\\"" + Str(\$input) + "\\"/\>" +
                      "      \</action\>" +
                      "    \</zact\> \&nbsp;";
            output += "    \<zact\>" + "(delete)" +
                      "      \<action\>\$[\\"\\"; Obj(\\"" + Str(\$eventDB) + "\\").\\"event:" + lower_case(::get_month_name(\$month: Int(\$month))) + "\\"[\\"" + Str(\$day) + "\\"][\\"" + Str(\$t1) + Str(\$t2) + "\\"][Int(\\"" + Str(j) + "\\")] = nil;]" +
          	      "       \<redirect propob=\\"\$(this)\\" prop=\\"showevents\\" actor=\\"" + Str(\$actor) + "\\" month=\\"" + Str(\$month) + "\\" day=\\"" + Str(\$day) + "\\" year=\\"" + Str(\$year) + "\\" icoday1=\\"" + \$icoday1 + "\\" icoday2=\\"" + \$icoday2 + "\\" weekday=\\"" + Str(\$weekday) + "\\" dayselector=\\"" + Str(\$dayselector) + "\\" input=\\"" + Str(\$input) + "\\" result=\\"" + "Event deleted for " + ::get_month_name(\$month: Int(\$month)) + Str(\$day) + " @ " + Str(\$t1) + ":" + Str(\$t2) + ".\\"/\>" +
                      "      \</action\>" +
                      "    \</zact\>";
     \}
            output += "  \</td\>";
            output += "\</tr\>";
            output += "\<tr\>";
            output += "  \<td colspan='2'\>";
            output += "    \<hr style='border:1px dotted #660000'/\>";
            output += "  \</td\>";
            output += "\</tr\>";
            output += "\<tr\>";
            output += "  \<td valign='top' width='70px'\>";
            output += "    \<font color='#660000' size='3'\>\<b\>\&nbsp;\&nbsp;Description \</b\>\</font\>";
            output += "  \</td\>";
            output += "  \<td style='text-align: justify'\>";
            output += "    \<font size='3'\>" + entry[1] + "\</font\>";
            output += "  \</td\>";
            output += "\</tr\>";
            output += "\<tr\>";
            output += "  \<td valign='top' width='70px'\>";
            output += "    \<font color='#660000' size='3'\>\<b\>\&nbsp;\&nbsp;Date \</b\>\</font\>";
            output += "  \</td\>";
            output += "  \<td\>";
            output += "    \<font size='3'\>" + \$icoday + ", the " + Str(desc_ordinal(Int(\$day))) + " day of " + Str(icomonth) + ", year " + Str(\$year - 1119) + "\</font\>";
            output += "  \</td\>";
            output += "\</tr\>";
            output += "\<tr\>";
            output += "  \<td valign='top' width='70px'\>";
            output += "    \<font color='#660000' size='3'\>\<b\>\&nbsp;\&nbsp;Time \</b\>\</font\>";
            output += "  \</td\>";
            output += "  \<td\>";
            output += "    \<font size='3'\>" + \$t1 + ":" + \$t2 + \$ampm + " Skotos Time\</font\>";
            output += "  \</td\>";
            output += "\</tr\>";
            output += "\<tr\>";
            output += "  \<td valign='top' width='70px'\>";
            output += "    \<font color='#660000' size='3'\>\<b\>\&nbsp;\&nbsp;Location \</b\>\</font\>";
            output += "  \</td\>";
            output += "  \<td\>";
            output += "    \<font size='3'\>" + entry[2] + "\</font\>";
            output += "  \</td\>";
            output += "\</tr\>";
            output += "\<tr\>";
            output += "  \<td colspan='2'\>";
            output += "    \<hr style='border:1px dotted #660000'/\>";
            output += "  \</td\>";
            output += "\</tr\>";

            output += "\</table\>\<br/\>";
          \} else \{
            output += "\<font color='red'\>Error displaying event.\</font\>";
          \}
        \}
        if(!sizeof(entries)) \{
          monthlyListing[Str(\$day)][Str(\$t1) + Str(\$t2)] = nil;
          Set(\$eventDB, "event:" + lower_case(Str(month)), monthlyListing);
        \}
    \}
\}

    if(\$actor \&\& \$actor != "" \&\& Obj(\$actor) \&\& member(Obj(\$actor), \$access)) \{

output += "\<center\>\<hr width='650px' style='border:1px dotted black'/\>\<table width='650px'\>\<tr\>\<td align='right'\>\<zact\>" + "(add event)" +
          "\<action\>\$[\\"\\";]" +
          "\<redirect propob=\\"\$(this)\\" prop=\\"edit\\" actor=\\"" + Str(\$actor) + "\\" month=\\"" + Str(\$month) + "\\" day=\\"" + Str(\$day) + "\\" year=\\"" + Str(\$year) + "\\" title=\\"" + "" + "\\" description=\\"" + "" + "\\" hours=\\"" + "" + "\\" minutes=\\"" + "" + "\\" location=\\"" + "" + "\\" type=\\"Adding\\" icoday1=\\"" + \$icoday1 + "\\" icoday2=\\"" + \$icoday2 + "\\" weekday=\\"" + Str(\$weekday) + "\\" dayselector=\\"" + Str(\$dayselector) + "\\" input=\\"" + Str(\$input) + "\\"/\>" +
          "\</action\>" +
          "\</zact\>\</td\>\</tr\>\</table\>\</center\>";

    \}


output += "\</body\>";

return ParseXML(output);
      </Core:Property>
      <Core:Property property="revisions">
         (\{ 1286788160, "jominey", "E", 1286788197, "jominey", "E", 1286788441, "jominey", "E", 1286788466, "jominey", "E", 1286788501, "jominey", "E", 1286788561, "jominey", "E", 1286788587, "jominey", "E", 1286788604, "jominey", "E", 1286832271, "jominey", "E", 1286833129, "jominey", "E", 1286833155, "jominey", "E", 1286833293, "jominey", "E", 1286833337, "jominey", "E", 1286833785, "jominey", "E", 1286833848, "jominey", "E", 1286833965, "jominey", "E", 1286834912, "jominey", "E", 1286835232, "jominey", "E", 1286835558, "jominey", "E", 1286835646, "jominey", "E", 1286835799, "jominey", "E", 1286836279, "jominey", "E", 1308675319, "jominey", "R" \})
      </Core:Property>
      <Core:Property property="theatre:id">"IC"</Core:Property>
    </Core:Properties>
    <Notes:Notes/>
  </Socials:Verb>
</object>
