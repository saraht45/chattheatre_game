<object clone="/base/obj/thing" owner="slurpeeslurp">
  <Base:Thing>
    <Ur:UrObject urobject="OBJ(Ironclaw:NPC:UrNPC)"/>
    <Base:Bulk immobile="false" mass="1" density="1"/>
    <Base:Container flexible="false" transparent-container="false" public-container="false" tight="false" capacity="1" maxweight="1"/>
    <Base:Misc gender="male" volition="false" weapon="false" default_stance="none" combinable="false" discrete="false" by_weight="false" tight="false" scriptrunner="true">
      <Base:Edible value="false"/>
      <Base:Potable value="false"/>
      <Base:DrinkMessageFirst></Base:DrinkMessageFirst>
      <Base:DrinkMessageThird></Base:DrinkMessageThird>
      <Base:Transparency value="false"/>
      <Base:Unsafe value="false"/>
      <Base:Safe value="false"/>
      <Base:ClothesExpected value="false"/>
      <Base:DieMessageFirst></Base:DieMessageFirst>
      <Base:DieMessageThird></Base:DieMessageThird>
    </Base:Misc>
    <Base:Details>
      <Base:Detail id="default" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="clothier"/>
            <Base:SName sname="cat"/>
            <Base:SName sname="tailor"/>
            <Base:SName sname="murphy"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="tailors"/>
            <Base:PName pname="clothiers"/>
            <Base:PName pname="cats"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="pencil-thin"/>
          <Base:Adjective adjective="tall"/>
        </Base:Adjectives>
        <Base:Descriptions>
          <Base:Description type="examine">
             $(this.trait:examine) You notice he is wheeling a cart behind him.
          </Base:Description>
          <Base:Description type="look">
             $(this.trait:look) You notice he is wheeling a cart behind him.
          </Base:Description>
        </Base:Descriptions>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="facialhair" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="facialhair"/>
          </Base:SNames>
          <Base:PNames/>
        </Base:Names>
        <Base:Adjectives/>
        <Base:Descriptions/>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="fur" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames/>
          <Base:PNames/>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="mottled"/>
          <Base:Adjective adjective="patchwork"/>
          <Base:Adjective adjective="short"/>
        </Base:Adjectives>
        <Base:Descriptions/>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="garments" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="garment"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="garments"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="starter"/>
        </Base:Adjectives>
        <Base:Descriptions>
          <Base:Description type="brief">
             the starter garments in the simple oak wagon
          </Base:Description>
          <Base:Description type="examine">
             A variety of basic garments ranging from pants to skirts to dresses lie within. You can ask Murphy what he has to offer and he'll give you a list.
          </Base:Description>
          <Base:Description type="look">
             A variety of basic garments ranging from pants to skirts to dresses lie within. You can ask Murphy what he has to offer and he'll give you a list.
          </Base:Description>
        </Base:Descriptions>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="hair" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="dreadlocks"/>
          </Base:SNames>
          <Base:PNames/>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="dishwater blonde"/>
          <Base:Adjective adjective="dreadlocks"/>
          <Base:Adjective adjective="long"/>
          <Base:Adjective adjective="wild"/>
        </Base:Adjectives>
        <Base:Descriptions/>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="tail" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="tail"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="tails"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="frazzled"/>
        </Base:Adjectives>
        <Base:Descriptions/>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
      <Base:Detail id="wagon" prime="false" def="false" abstract="false" hidden="false" luminosity="0" targetable_in_dark="false" plural="false">
        <Base:Preposition close="false" against="false" under="false" on="false" inside="false" near="false" over="false" behind="false" before="false" beside="false"/>
        <Base:Names>
          <Base:SNames>
            <Base:SName sname="cart"/>
            <Base:SName sname="wagon"/>
          </Base:SNames>
          <Base:PNames>
            <Base:PName pname="carts"/>
            <Base:PName pname="wagons"/>
          </Base:PNames>
        </Base:Names>
        <Base:Adjectives>
          <Base:Adjective adjective="oak"/>
        </Base:Adjectives>
        <Base:Descriptions>
          <Base:Description type="brief">
             simple cargo wagon
          </Base:Description>
          <Base:Description type="examine">
             A simple wagon made out of oak and filled to the brim with starter garments. Along the sides the words 'Welcome to Triskellian' have been engraved in bold print.
          </Base:Description>
          <Base:Description type="look">
             A simple wagon made of oak and filled to the brim with starter garments.
          </Base:Description>
        </Base:Descriptions>
        <Base:Exit door="false" never_obvious="false" obvious_when_open="false" hidden_when_closed="false" separate="false" self-locking="false" deadbolt="false"/>
        <Base:Climbable/>
      </Base:Detail>
    </Base:Details>
    <Base:Combat>
      <Base:Strength value="1"/>
      <Base:MaxFatigue value="1"/>
    </Base:Combat>
    <Base:Clothing>
      <Base:SingleWear value="false"/>
    </Base:Clothing>
    <Base:Crafting see_level="0" do_level="0" time="0" attention="false" held="false">
      <Base:Ingredients/>
      <Base:Tools/>
      <Base:CraftVerbs/>
    </Base:Crafting>
    <Base:InitialContents/>
    <Base:InitialProperties/>
    <Core:Properties>
      <Core:Property property="appearance:anterlength">
         (\{ "short" \})
      </Core:Property>
      <Core:Property property="appearance:antlertype">
         (\{ "curved" \})
      </Core:Property>
      <Core:Property property="appearance:build">
         "pencil-thin"
      </Core:Property>
      <Core:Property property="appearance:cheeks">
         "sunken"
      </Core:Property>
      <Core:Property property="appearance:chin">
         "protruding"
      </Core:Property>
      <Core:Property property="appearance:clawapp">
         "tattered"
      </Core:Property>
      <Core:Property property="appearance:clawlength">
         "broken"
      </Core:Property>
      <Core:Property property="appearance:earshape">
         "scarred"
      </Core:Property>
      <Core:Property property="appearance:eyebrows">
         "bushy"
      </Core:Property>
      <Core:Property property="appearance:eyecolor">
         "cool blue"
      </Core:Property>
      <Core:Property property="appearance:eyeshape">
         "weary"
      </Core:Property>
      <Core:Property property="appearance:feet">
         "worn"
      </Core:Property>
      <Core:Property property="appearance:furcolor">
         "patchwork"
      </Core:Property>
      <Core:Property property="appearance:furlength">
         "short"
      </Core:Property>
      <Core:Property property="appearance:furtexture">
         "mottled"
      </Core:Property>
      <Core:Property property="appearance:haircolor">
         "dishwater blonde"
      </Core:Property>
      <Core:Property property="appearance:hairlength">
         "long"
      </Core:Property>
      <Core:Property property="appearance:hairstyle">
         "dreadlocks"
      </Core:Property>
      <Core:Property property="appearance:hairstyle_examinedescription">
         "A style in which the hair is either twisted into rope-like locks or consists of long, thin braids radiating from the scalp. "
      </Core:Property>
      <Core:Property property="appearance:hairstyle_examinestring">
         ", worn in dreadlocks"
      </Core:Property>
      <Core:Property property="appearance:hairstyle_lookdescription">
         "A style in which the hair is either twisted into rope-like locks or consists of long, thin braids radiating from the scalp. "
      </Core:Property>
      <Core:Property property="appearance:hairstyle_string">
         ", worn in dreadlocks"
      </Core:Property>
      <Core:Property property="appearance:hairtexture">
         "wild"
      </Core:Property>
      <Core:Property property="appearance:hairtype">
         "wild"
      </Core:Property>
      <Core:Property property="appearance:hands">
         "bony"
      </Core:Property>
      <Core:Property property="appearance:height">
         "tall"
      </Core:Property>
      <Core:Property property="appearance:left-cheek">
         "sunken"
      </Core:Property>
      <Core:Property property="appearance:lipshape">
         "unremarkable"
      </Core:Property>
      <Core:Property property="appearance:mouth"/>
      <Core:Property property="appearance:mouthshape">
         "ordinary"
      </Core:Property>
      <Core:Property property="appearance:muzzleshape">
         "ordinary"
      </Core:Property>
      <Core:Property property="appearance:noseshape">
         "active"
      </Core:Property>
      <Core:Property property="appearance:right-cheek">
         "sunken"
      </Core:Property>
      <Core:Property property="appearance:stomach">
         "unnoticeable"
      </Core:Property>
      <Core:Property property="appearance:taillength">
         "long"
      </Core:Property>
      <Core:Property property="appearance:tailtexture">
         "frazzled"
      </Core:Property>
      <Core:Property property="export:global_stock">
         25
      </Core:Property>
      <Core:Property property="export:nip-core:hooks">
         ([ "decide":\<Lib:NIP:base:hooks:decide\>, "delay":\<Lib:NIP:base:hooks:delay\>, "internal":\<Lib:NIP:base:hooks:internal\>, "resource-control":\<Lib:NIP:lib:resource-control\> ])
      </Core:Property>
      <Core:Property property="export:nip-core:inherits">
         ([ \<Shared:Systems:Quest:NIP:lib:quest-giver\>:(\{ "react-post:evoke-iob%quest_giver", "react-post:evoke-dob%quest_giver", "lib:check_dest", "lib:quest_query", "lib:quest_init", "lib:do_quest_yes", "lib:do_quest_no", "lib:do_quest_expire", "lib:modify_quests", "setprop-post:addquest", "setprop-post:delquest", "lib:quest_config", "lib:quest_show_emits" \}), \<Lib:NIP:base:lib:hooks\>:(\{ "lib:core:find-hook", "lib:core:register-hook", "lib:core:unregister-hook", "lib:modify:hooks", "setprop-post:hook" \}), \<Lib:NIP:base:lib:signals\>:(\{ "lib:modify:signals", "setprop-post:signal", "lib:calc_sighookpath" \}), \<Lib:NIP:base:lib:stream\>:(\{ "setprop-post:sigexecptr", "setprop-post:sigstream" \}), \<Lib:NIP:base:signals:DECIDE\>:(\{ "setprop-post:decide" \}), \<Lib:NIP:lib:resource-control\>:(\{ "witness-post:login%nip:resource-control", "witness:enter-from%nip:resource-control", "witness:teleport%resource-control", "lib:entering" \}) ])
      </Core:Property>
      <Core:Property property="export:nip-core:libraries">
         (\{ \<Lib:NIP:base:lib:signals\>, \<Lib:NIP:base:lib:hooks\>, \<Lib:NIP:base:lib:stream\>, \<Lib:NIP:lib:resource-control\>, \<Kalle:renamed-to-restore-MOVED-nip-object:Lib:NIP:core\>, \<Lib:NIP:base:signals:DELAY\>, \<Lib:NIP:base:signals:DECIDE\>, \<Lib:NIP:base:signals:INTERNAL\>, \<Shared:Systems:Quest:NIP:lib:quest-giver\> \})
      </Core:Property>
      <Core:Property property="export:nip-core:prop:nip:trait:resource-control:ttl">
         ([ 1:1 ])
      </Core:Property>
      <Core:Property property="export:nip-core:prop:nip:trait:resource-control:ttl_increase">
         ([ 1:1 ])
      </Core:Property>
      <Core:Property property="export:nip-core:sighookpath">
         (\{ "delay:DELAY-init", "delay:DELAY-exec", "internal:INTERNAL-exec", "decide:DECIDE-init", "decide:DECIDE-exec", "decide:DECIDE-post" \})
      </Core:Property>
      <Core:Property property="export:nip-core:signals">
         ([ 10:"DELAY", 500:"INTERNAL", 1000:"DECIDE" ])
      </Core:Property>
      <Core:Property property="export:nip-core:system:revision">
         44
      </Core:Property>
      <Core:Property property="export:nip:quest:list">
         (\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \})
      </Core:Property>
      <Core:Property property="export:nip:trait:resource-control:ttl">
         1800
      </Core:Property>
      <Core:Property property="export:nip:trait:resource-control:ttl_increase">
         600
      </Core:Property>
      <Core:Property property="export:trading:lists">
         (\{ \<Ironclaw:NPCs:Traders:TradingLists:HomelessClothier\> \})
      </Core:Property>
      <Core:Property property="export:trait:brief">
         "clothier named Murphy"
      </Core:Property>
      <Core:Property property="export:trait:examine">
         "This clothier is a tall pencil-thin cat, with short, mottled patchwork fur, and long wild dishwater blonde hair, worn in dreadlocks. Weary cool blue eyes are set above a active nose and unremarkable lips. Broken tattered nails, on bony hands, and worn feet are also visible. You also note his scarred  ears."
      </Core:Property>
      <Core:Property property="export:trait:global_stock">
         25
      </Core:Property>
      <Core:Property property="export:trait:look">
         "This clothier is a tall pencil-thin cat, with short, mottled patchwork fur, and long wild dishwater blonde hair, worn in dreadlocks."
      </Core:Property>
      <Core:Property property="export:trait:nominative">
         "he"
      </Core:Property>
      <Core:Property property="export:trait:objective">
         "his"
      </Core:Property>
      <Core:Property property="export:trait:possessive">
         "his"
      </Core:Property>
      <Core:Property property="export:trait:sex">
         "man"
      </Core:Property>
      <Core:Property property="loading">1</Core:Property>
      <Core:Property property="merry:inherit:act:start">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:calc_sighookpath">
         \<Lib:NIP:base:lib:signals\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:check_dest">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:core:find-hook">
         \<Lib:NIP:base:lib:hooks\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:core:merry_add">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:core:merry_delete">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:core:register-hook">
         \<Lib:NIP:base:lib:hooks\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:core:sysupdate">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:core:unregister-hook">
         \<Lib:NIP:base:lib:hooks\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:decide:decide-exec">
         \<Lib:NIP:base:hooks:decide\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:decide:decide-init">
         \<Lib:NIP:base:hooks:decide\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:decide:decide-post">
         \<Lib:NIP:base:hooks:decide\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:delay:delay-exec">
         \<Lib:NIP:base:hooks:delay\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:delay:delay-init">
         \<Lib:NIP:base:hooks:delay\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:do_quest_expire">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:do_quest_no">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:do_quest_yes">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:entering">
         \<Lib:NIP:lib:resource-control\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:find_nip_object">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:heartbeat">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:internal:internal-exec">
         \<Lib:NIP:base:hooks:internal\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:log">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:modify:hooks">
         \<Lib:NIP:base:lib:hooks\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:modify:libraries">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:modify:signals">
         \<Lib:NIP:base:lib:signals\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:modify_quests">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:ncs:handler">
         \<Lib:NIP:NCS\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:quest_config">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:quest_init">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:quest_query">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:quest_show_emits">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:lib:shutdown">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:react-post:evoke-dob%quest_giver">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:react-post:evoke-iob%quest_giver">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:react:ask-dob%trading">
         \<Allegory:Lib:Economy:TradingLib\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:add">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:addquest">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:decide">
         \<Lib:NIP:base:signals:DECIDE\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:del">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:delete">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:delquest">
         \<Shared:Systems:Quest:NIP:lib:quest-giver\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:error">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:hook">
         \<Lib:NIP:base:lib:hooks\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:nip">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:nip-core">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:sigexecptr">
         \<Lib:NIP:base:lib:stream\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:signal">
         \<Lib:NIP:base:lib:signals\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:sigstream">
         \<Lib:NIP:base:lib:stream\>
      </Core:Property>
      <Core:Property property="merry:inherit:setprop-post:sub">
         \<Lib:NIP:core\>
      </Core:Property>
      <Core:Property property="merry:inherit:witness-post:login%nip:resource-control">
         \<Lib:NIP:lib:resource-control\>
      </Core:Property>
      <Core:Property property="merry:inherit:witness:enter-from%nip:resource-control">
         \<Lib:NIP:lib:resource-control\>
      </Core:Property>
      <Core:Property property="merry:inherit:witness:teleport%resource-control">
         \<Lib:NIP:lib:resource-control\>
      </Core:Property>
      <Core:Property property="merry:lib:get_paid">
         X[M] /* For every 5 denarii the server is paid, he will restock 1 item in his inventory list */

/* Check how much change he is holding */
\$funds = Int(\$this."trait:money");

/* For every five denarii, restock a garment*/
/* Find out how many garments we can restock with current funds */
\$num = Int(floor(Flt(\$funds/500)));

/* Restock the garments */
\$garmentsRestocked = 0;
for(\$i = 0; \$i \< \$num; \$i++) \{
    \$lowest = ([ ]);
    /* Scan through all the trading lists */
    \$lists = \$this."trading:lists";
    for(\$j = 0; \$j \< sizeof(\$lists); \$j++) \{
        \$items = Get(\$lists[\$j], "*");
        \$items = map_indices(prefixed_map(\$items, "tradingitem"));
        for(\$k = 0; \$k \< sizeof(\$items); \$k++) \{
            \$stock = Get(\$lists[\$j], \$items[\$k])["stock"];
            if(\$stock \> -1 \&\& \$stock \< 30) \{
                if(!map_sizeof(\$lowest) \|\| \$stock \< map_values(\$lowest)[0][1]) \{
                    \$lowest = ([ \$items[\$k]:(\{ \$lists[\$j], \$stock \}) ]);
                \} else if(\$stock == map_values(\$lowest)[0][1])\{
                    if(map_sizeof(\$lowest) \&\& map_values(\$lowest)[0][1]) \{
                        if(!\$lowest[\$items[\$k]]) \{
                            \$lowest += ([ \$items[\$k]:(\{ \$lists[\$j], \$stock \}) ]);
                        \}
                    \}
                \}
            \}
        \}
    \}
    if(map_sizeof(\$lowest)) \{
        if(map_sizeof(\$lowest) \> 1) \{
            \$itemToStock = map_indices(\$lowest)[random(sizeof(map_indices(\$lowest)))];
        \} else \{
            \$itemToStock = map_indices(\$lowest)[0];
        \}

        \$stockList = \$lowest[\$itemToStock][0];
        \$stockNum = Int(\$lowest[\$itemToStock][1]) + 1;

        \$temp = Get(\$stockList, \$itemToStock);
        \$temp["stock"] = \$stockNum;

        Set(\$stockList, \$itemToStock, \$temp);

        \$garmentsRestocked++;
    \}
\}

if(\$garmentsRestocked == \$num \&\& \$num \> 0) \{
    /* We were able to use all the money */
    Social(\$this, "praise", "gratefully", "When we give cheerfully and accept gratefully, everyone is blessed. Thank you for your donation!", "nil", \$actor );

    /* Give remaining change back to the server */
    \$this."trait:money" = \$funds - (\$num*500);
\}

if(\$garmentsRestocked == 0 \&\& \$total \> 0) \{
    /* We were not able to use any money */
    /* Nothing else to stock. Give the money back because we don't need it. */
    Social(\$this, "smile", "appreciatively", "Our cabinets overflow with love at present, but we thank you for your generous and thoughtful heart.", "at", \$actor );
    EmitTo(\$actor, TAG(Describe(\$this) + " pays you " + Str(\$total/100) + " denarii.", "imp"));
    \$this."trait:money" -= \$total;
    \$actor."trait:money" += \$total;
    return FALSE;
\}

if(\$garmentsRestocked \> 0 \&\& \$garmentsRestocked \< \$num) \{
    /* We were able to use some of the money but not all */
    /* Return any money that can't be used */
    \$refund = (\$num - \$garmentsRestocked) * 500;
    Social(\$this, "exhale", "contentedly", "Your benevolence is appreciated, but we only need " + desc_cardinal(\$garmentsRestocked*5) + " denarii to restock our supplies at present. Please keep the overflow with our thanks.", "at", \$actor );
    \$actor."trait:money" += \$refund;
    \$this."trait:money" -= \$refund;
    \$this."trait:money" = \$funds - (\$num*500);
\}

return FALSE;
      </Core:Property>
      <Core:Property property="ndp">
         " *** FINISHED ADDITION *** "
      </Core:Property>
      <Core:Property property="new property name">
         "New Property Value"
      </Core:Property>
      <Core:Property property="nip-core:hooks">
         ([ "decide":\<Lib:NIP:base:hooks:decide\>, "delay":\<Lib:NIP:base:hooks:delay\>, "internal":\<Lib:NIP:base:hooks:internal\>, "resource-control":\<Lib:NIP:lib:resource-control\> ])
      </Core:Property>
      <Core:Property property="nip-core:inherits">
         ([ \<Shared:Systems:Quest:NIP:lib:quest-giver\>:(\{ "react-post:evoke-iob%quest_giver", "react-post:evoke-dob%quest_giver", "lib:check_dest", "lib:quest_query", "lib:quest_init", "lib:do_quest_yes", "lib:do_quest_no", "lib:do_quest_expire", "lib:modify_quests", "setprop-post:addquest", "setprop-post:delquest", "lib:quest_config", "lib:quest_show_emits" \}), \<Lib:NIP:base:lib:hooks\>:(\{ "lib:core:find-hook", "lib:core:register-hook", "lib:core:unregister-hook", "lib:modify:hooks", "setprop-post:hook" \}), \<Lib:NIP:base:lib:signals\>:(\{ "lib:modify:signals", "setprop-post:signal", "lib:calc_sighookpath" \}), \<Lib:NIP:base:lib:stream\>:(\{ "setprop-post:sigexecptr", "setprop-post:sigstream" \}), \<Lib:NIP:base:signals:DECIDE\>:(\{ "setprop-post:decide" \}), \<Lib:NIP:lib:resource-control\>:(\{ "witness-post:login%nip:resource-control", "witness:enter-from%nip:resource-control", "witness:teleport%resource-control", "lib:entering" \}) ])
      </Core:Property>
      <Core:Property property="nip-core:libraries">
         (\{ \<Lib:NIP:base:lib:signals\>, \<Lib:NIP:base:lib:hooks\>, \<Lib:NIP:base:lib:stream\>, \<Lib:NIP:lib:resource-control\>, \<Kalle:renamed-to-restore-MOVED-nip-object:Lib:NIP:core\>, \<Lib:NIP:base:signals:DELAY\>, \<Lib:NIP:base:signals:DECIDE\>, \<Lib:NIP:base:signals:INTERNAL\>, \<Shared:Systems:Quest:NIP:lib:quest-giver\> \})
      </Core:Property>
      <Core:Property property="nip-core:prop:nip:trait:resource-control:ttl">
         ([ 1:1 ])
      </Core:Property>
      <Core:Property property="nip-core:prop:nip:trait:resource-control:ttl_increase">
         ([ 1:1 ])
      </Core:Property>
      <Core:Property property="nip-core:sighookpath">
         (\{ "delay:DELAY-init", "delay:DELAY-exec", "internal:INTERNAL-exec", "decide:DECIDE-init", "decide:DECIDE-exec", "decide:DECIDE-post" \})
      </Core:Property>
      <Core:Property property="nip-core:signals">
         ([ 10:"DELAY", 500:"INTERNAL", 1000:"DECIDE" ])
      </Core:Property>
      <Core:Property property="nip-core:system:revision">
         44
      </Core:Property>
      <Core:Property property="nip:quest:list">
         (\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \})
      </Core:Property>
      <Core:Property property="nip:trait:resource-control:ttl">
         1800
      </Core:Property>
      <Core:Property property="nip:trait:resource-control:ttl_increase">
         600
      </Core:Property>
      <Core:Property property="npc:resource-control:live_time">
         1410897980
      </Core:Property>
      <Core:Property property="npc:status:spawndate">
         1421988015
      </Core:Property>
      <Core:Property property="npc:sys:sighookpath">
         (\{ "delay:DELAY-init", "delay:DELAY-exec", "internal:INTERNAL-exec", "decide:DECIDE-init", "decide:DECIDE-exec", "decide:DECIDE-post" \})
      </Core:Property>
      <Core:Property property="quest:pending">
         ([ \<Chatters:AE:ta:tara\>:(\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \}), \<Chatters:Backup:AE:pi:pier0\>:(\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \}), \<Chatters:Backup:IC:un:una0\>:(\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \}), \<Chatters:IC:si:sirazad\>:(\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \}), \<Chatters:IC:vi:virendra\>:(\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \}), \<Chatters:IC:na:nan\>:(\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \}), \<Chatters:IC:hu:hush\>:(\{ \<Ironclaw:Quest:Quests:MarshandMellowsoup\> \}) ])
      </Core:Property>
      <Core:Property property="revisions">
         (\{ 1319073687, "meandmine", "X", 1389635335, "vandringar", "E", 1389635425, "vandringar", "E", 1389635531, "vandringar", "E", 1389635691, "vandringar", "E", 1389635808, "vandringar", "E", 1389635912, "vandringar", "E", 1389637588, "vandringar", "E", 1389640924, "vandringar", "K", 1389641141, "vandringar", "E", 1389641901, "vandringar", "E", 1411741612, "slurpeeslurp", "K", 1411741623, "slurpeeslurp", "E", 1411741738, "slurpeeslurp", "E", 1411742180, "slurpeeslurp", "E", 1411742462, "slurpeeslurp", "E", 1411742511, "slurpeeslurp", "K", 1411742548, "slurpeeslurp", "E", 1411742565, "slurpeeslurp", "E", 1411742669, "slurpeeslurp", "E", 1411742731, "slurpeeslurp", "E", 1411742788, "slurpeeslurp", "E", 1411742829, "slurpeeslurp", "K", 1411743134, "slurpeeslurp", "K", 1411743143, "slurpeeslurp", "E", 1411743233, "slurpeeslurp", "K", 1411743311, "slurpeeslurp", "E", 1411743415, "slurpeeslurp", "E", 1411743470, "slurpeeslurp", "E", 1413556660, "slurpeeslurp", "E", 1413556698, "slurpeeslurp", "E", 1413556763, "slurpeeslurp", "E", 1413557864, "slurpeeslurp", "E", 1421207721, "jominey", "K", 1421207730, "jominey", "K", 1421988287, "slurpeeslurp", "K", 1421988294, "slurpeeslurp", "E", 1421988296, "slurpeeslurp", "E", 1421988310, "slurpeeslurp", "E", 1421988697, "slurpeeslurp", "E", 1421988719, "slurpeeslurp", "K", 1421989611, "slurpeeslurp", "E", 1422545681, "abigail", "E", 1422545709, "abigail", "E", 1422545743, "abigail", "E", 1422545755, "abigail", "E", 1422546735, "abigail", "E", 1427600812, "jominey", "E", 1427600881, "jominey", "E", 1427940866, "slurpeeslurp", "E", 1427941706, "slurpeeslurp", "E", 1427981064, "slurpeeslurp", "E", 1430189311, "slurpeeslurp", "E", 1430189419, "slurpeeslurp", "E", 1430364671, "jominey", "E" \})
      </Core:Property>
      <Core:Property property="skill:fatigue">1.0</Core:Property>
      <Core:Property property="spawn:creator">
         (\{ "slurpeeslurp", 1251961367 \})
      </Core:Property>
      <Core:Property property="student:learningpoints">
         32
      </Core:Property>
      <Core:Property property="student:todayspoints">
         2
      </Core:Property>
      <Core:Property property="theatre:notwhobody">1</Core:Property>
      <Core:Property property="trait:animal">"cat"</Core:Property>
      <Core:Property property="trait:brief">
         "clothier"
      </Core:Property>
      <Core:Property property="trait:examine">
         "This clothier is a tall pencil-thin cat, with short, mottled patchwork fur, and long wild dishwater blonde hair, worn in dreadlocks. Weary cool blue eyes are set above a active nose and unremarkable lips. Broken tattered nails, on bony hands, and worn feet are also visible. You also note his scarred  ears."
      </Core:Property>
      <Core:Property property="trait:look">
         "This clothier is a tall pencil-thin cat, with short, mottled patchwork fur, and long wild dishwater blonde hair, worn in dreadlocks."
      </Core:Property>
      <Core:Property property="trait:nominative">
         "he"
      </Core:Property>
      <Core:Property property="trait:objective">
         "his"
      </Core:Property>
      <Core:Property property="trait:possessive">
         "his"
      </Core:Property>
      <Core:Property property="trait:sex">"man"</Core:Property>
      <Core:Property property="trait:smell">
         "clothing dye and clean linen"
      </Core:Property>
      <Core:Property property="trait:smells:lastchecked">
         1341077963
      </Core:Property>
      <Core:Property property="trait:title">
         "Clothier"
      </Core:Property>
    </Core:Properties>
    <Notes:Notes/>
  </Base:Thing>
</object>
